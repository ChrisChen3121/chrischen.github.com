#+TITLE: 策略
#+KEYWORDS: Futures
#+OPTIONS: H:3 toc:2 num:3 ^:nil
#+LANGUAGE: zh-CN
#+AUTHOR: ChrisChen
#+EMAIL: ChrisChen3121@gmail.com
#+SELECT_TAGS: export
#+EXCLUDE_TAGS: noexport
#+SETUPFILE: ../../org-templates/level-1.org

* 回测
** 数据查错
   - 简单方法：算日收益，对偏离均值 4 个标准差的收益需要仔细检查；一般而言，极端收益与消息发布或市场指数异动有关，否则就是数据本身问题
   - 另外还可以算一下不同价格组合的日收益(比如昨天的最高价和今天的收盘价)

** 回测价格选择
   - 最高，最低价的噪声远大于开收盘价，故一般选用收盘价

** 回测陷阱
*** 前视偏差
    验证是否有前视偏差：全数据产生策略持仓数据，然后删除最近 N 天再次生成，再比较两者是否一致

*** 数据迁就偏差
    - 策略 *规则* 越多、 *参数* 越多，因为条件更难以达到，所以更容易产生过拟合。
    - 能经得住时间考验的往往是简单的模型(奥卡姆剃刀原理)
    - K 线独立数据量有限，很容易产生数据迁就偏差
    - 如发生金融系统的状态转变，近几年的旧数据也无法使用
    - 独立数据的量越少，交易模型中用到的调整参数就应该越少

**** 优化样本数量
     根据经验法则，优化参数所需的数据点个数是模型中自由参数个数的 252 倍。
     - 参数包括如建仓清仓阈值、持有期限等定量指标
     - 回测三个参数的日交易模型，至少要用三年(252 个交易日)的日价格数据

**** 样本外数据
     历史数据根据时间先后分为两段，前一段数据为训练集，后一段数据为测试集，两段数据大小要大致相等
     - 数据量不够，则至少用三分之一的数据做测试
     - 训练集训练出的参数在测试集上的业绩起码要合理，否则存在数据迁就偏差，需要进一步优化并减少参数
     - 动态参数优化：移动窗口

* 策略表现评估
** 平均年化收益率
   需关注分母的说明
   - 多空策略中，分母用一个方向的资本还是两个方向的
   - 收益率是杠杆收益率(分母账户净值)还是无杠杆收益率(分母投资组合的市场价值)

** 回撤
   - t 时刻回撤定义：当前净值与 t 时刻或之前的净值曲线最大值之差
   - 最大回撤：是指净值曲线最大值与之后的净值曲线最小值之差

** 夏普比率
   - 信息比率：（组合收益率 - 基准收益率）/ 超额收益率的标准差
   - 夏普比率是信息比率的一个特例，基准取无风险利率，多种策略比较时更适用
   - 仅当策略有资金成本时才需要减掉无风险利率。例如无隔夜头寸的纯多头当日交易策略就没有资金成本
   - 货币中性策略无需计算无风险利率，卖空的现金买入另一腿证券，换言之其是自融资的

*** 年化夏普比率计算
    sharpe = sqrt(T) * 基于 T 的夏普比率。例如：策略只在纽交所交易时间(6.5h)内持仓，每小时收益率 R，每小时标准差 s，则年化夏普比率为 sqrt(252*6.5)*R/s
    - 日收益算夏普：sqrt(252) * ret_mean / ret_std


** 业绩随时间而变化
   - 市场流动性随时间而变化，策略交易成本需根据当时情况预估
   - 金融市场的“状态转换”，金融时间序列是非平稳的

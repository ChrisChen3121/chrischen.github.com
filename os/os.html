<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<!-- 2018-05-02 Wed 14:00 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Operating Systems</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="ChrisChen" />
<meta name="keywords" content="OS" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../styles/demo/css/demo.css"/>
<link href="https://fonts.proxy.ustclug.org/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "left",
        displayIndent: "5em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "left",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Operating Systems</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8516c06">1. Represeting Infomation</a>
<ul>
<li><a href="#org491e631">1.1. Integer</a></li>
<li><a href="#orgac89dd8">1.2. Floating Point</a></li>
</ul>
</li>
<li><a href="#orga4e74fd">2. Manipulating Infomation</a>
<ul>
<li><a href="#org2737cb5">2.1. Integer arithmatic</a></li>
<li><a href="#org38b40fb">2.2. Floating Operation</a></li>
</ul>
</li>
<li><a href="#org860a929">3. Program Structure</a>
<ul>
<li><a href="#orgbe2a90c">3.1. Processor State</a></li>
<li><a href="#orga65518f">3.2. Asm</a></li>
<li><a href="#org989320d">3.3. Data Formats</a></li>
<li><a href="#orgc179377">3.4. Interger Registers</a></li>
<li><a href="#org101d708">3.5. Operand Specifiers</a></li>
<li><a href="#org0c14404">3.6. Basic Operations</a></li>
<li><a href="#org5cb42f3">3.7. Control</a></li>
<li><a href="#org66a7787">3.8. Procedure</a></li>
<li><a href="#orgee7acff">3.9. Array Allocation</a></li>
<li><a href="#org4f7bb04">3.10. Float Operations</a></li>
</ul>
</li>
<li><a href="#org2df7119">4. Optimizing Program Performance</a>
<ul>
<li><a href="#org42e3063">4.1. Limits of Optimizing Compilers</a></li>
<li><a href="#orgb3df4c6">4.2. Expressing Program Performance</a></li>
<li><a href="#orga768c7b">4.3. Optimizing Performance</a></li>
<li><a href="#orgba74267">4.4. CPU related Optimization</a></li>
<li><a href="#org6ee909b">4.5. Basic strategies for Optimization in the Real World</a></li>
<li><a href="#org7154bbd">4.6. Profiling</a></li>
</ul>
</li>
<li><a href="#org7e9fac8">5. Storage</a>
<ul>
<li><a href="#org306632c">5.1. Storage Hierarchy</a></li>
<li><a href="#org80e77f5">5.2. BUS</a></li>
<li><a href="#org805cd60">5.3. Locality</a></li>
<li><a href="#orgd58d42b">5.4. Cache Memories</a></li>
</ul>
</li>
<li><a href="#org6d33b70">6. Link</a>
<ul>
<li><a href="#orge5ccad0">6.1. Object Files</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org8516c06" class="outline-2">
<h2 id="org8516c06"><span class="section-number-2">1</span> Represeting Infomation</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org491e631" class="outline-3">
<h3 id="org491e631"><span class="section-number-3">1.1</span> Integer</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org2f2979b" class="outline-4">
<h4 id="org2f2979b"><span class="section-number-4">1.1.1</span> Integer Limits</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
\[TMax_w = 2^{w-1}-1\quad TMin_w = - 2^{w-1}\quad UMax_w = 2^w-1\quad UMin_w = 0\]
</p>
</div>
</div>
<div id="outline-container-orge9e04d0" class="outline-4">
<h4 id="orge9e04d0"><span class="section-number-4">1.1.2</span> Binary2Integer</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
\[B2U_w(\overrightarrow{x})\doteq\sum_{i=0}^{w-1}x_i2^i\]
</p>
</div>
<ul class="org-ul">
<li><a id="org51cd710"></a>Twos' Complement<br />
<div class="outline-text-5" id="text-org51cd710">
<p>
\[B2T_w(\overrightarrow{x})\doteq-x_{w-1}2^{w-1}+\sum_{i=0}^{w-2}x_i2^i\]
</p>
</div>
</li>
<li><a id="orgddb0e49"></a>Sign-Magnitude<br />
<div class="outline-text-5" id="text-orgddb0e49">
<ul class="org-ul">
<li>used in floating number</li>
</ul>
<p>
\[B2S_w(\overrightarrow{x})\doteq(-1)^{x_{w-1}}\cdot(\sum_{i=0}^{w-2}x_i2^i)\]
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgb83fd7a" class="outline-4">
<h4 id="orgb83fd7a"><span class="section-number-4">1.1.3</span> Transform between signed and unsigned</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<ul class="org-ul">
<li><a id="org5a9cd08"></a>\(T2U_w(x)\)<br />
<div class="outline-text-5" id="text-org5a9cd08">
<p>
\[B2U_w(\overrightarrow{x})-B2T_w(\overrightarrow{x})=x_{w-1}(2^{w-1}+2^{w-1})=x_{w-1}2^w\]
\[B2U_w(\overrightarrow{x})=x_{w-1}2^w + B2T_w(\overrightarrow{x})\]
Let \(\overrightarrow{x}=T2B_w(x)\) , Then：
\[T2U_w(x)=B2U_w(T2B_w(x)) = x_{w-1}2^w + B2T_w(T2B_w(x)) = x_{w-1}2^w + x\]
bit \(x_{w-1}\) is the sign bit, giving:
\[T2U_w(x) = \begin{cases}
     x+2^w, & x\le 0 \\
     x, & x>0 \\
     \end{cases}\]
</p>
</div>
</li>
<li><a id="org2c95edf"></a>\(U2T_w(x)\)<br />
<div class="outline-text-5" id="text-org2c95edf">
<p>
\[U2T_w(u)=B2T_w(U2B_w(u))=-u_{w-1}2^w+u\]
\[U2T_w(u) = \begin{cases}
     u, & u<2^{w-1} \\
     u - 2^w, & u\ge2^{w-1} \\
     \end{cases}\]
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org69c03cf" class="outline-4">
<h4 id="org69c03cf"><span class="section-number-4">1.1.4</span> Small size to big size</h4>
<div class="outline-text-4" id="text-1-1-4">
<ol class="org-ol">
<li>Change the size(fill 0 or 1 depends on signed/unsigned)</li>
<li>Convert signed/unsigned</li>
</ol>
</div>
</div>

<div id="outline-container-org2caf6a1" class="outline-4">
<h4 id="org2caf6a1"><span class="section-number-4">1.1.5</span> Big size to small size</h4>
<div class="outline-text-4" id="text-1-1-5">
<ul class="org-ul">
<li>Unsigned big2small：\(B2U_k([x_{k-1},x_{k-2},\cdots,x_0])=B2U_w([x_{w-1},x_{w-2},\cdots,x_0])\mod 2^k\)</li>
<li>Signed big2small：\(B2T_k([x_{k-1}, x_{k-2}, \cdots, x_0])=U2T_k(B2U_k([x_{k-1},x_{k-2},\cdots,x_0])\)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgac89dd8" class="outline-3">
<h3 id="orgac89dd8"><span class="section-number-3">1.2</span> Floating Point</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org4ac31fd" class="outline-4">
<h4 id="org4ac31fd"><span class="section-number-4">1.2.1</span> Fractional Binary Numbers</h4>
<div class="outline-text-4" id="text-1-2-1">
</div>
<ul class="org-ul">
<li><a id="orgbbe71ab"></a>Fractional Decimal<br />
<div class="outline-text-5" id="text-orgbbe71ab">
<p>
\[d=\sum_{i=-n}^m10^i\times{d_i}\]
Consider Fractional decimal \(12.34_{10}\)
\[ 1\times{10^1} + 2\times{10^0} + 3\times{10^{-1}} + 4\times{10^{-2}}=12\frac{34}{100}\]
</p>
</div>
</li>
<li><a id="org530c038"></a>Fractional Binary<br />
<div class="outline-text-5" id="text-org530c038">
<p>
\[b=\sum_{i=-n}^m2^i\times{b_i}\]
eg:  \(101.11_2\)
\[ 1\times{2^2} + 0\times{2^1} + 1\times{2^0} + 1\times{2^{-1}} + 1\times{2^{-2}} = 5\frac{3}{4}\]
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgeec5cef" class="outline-4">
<h4 id="orgeec5cef"><span class="section-number-4">1.2.2</span> IEEE Floating-Point</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
\[V=(-1)^{s}\times{M}\times{2^E}\]
</p>
<ul class="org-ul">
<li>sign s: negative(s=1) positive(s=0), Sign-Magnitude</li>
<li>significand M: a fractional binary number, <i>n</i> bits</li>
<li>exponent E: weights the value by a power of 2, <i>k</i> bits</li>
<li>\(Bias = 2^{k-1} -1\)</li>
</ul>
</div>
<ul class="org-ul">
<li><a id="orgb974e6a"></a>float(single-precision)<br />
<div class="outline-text-5" id="text-orgb974e6a">
<p>
s=1, k=8, n=23 yielding a 32-bit representation, Bias = 127
</p>
</div>
</li>
<li><a id="org661128b"></a>double(double-precision)<br />
<div class="outline-text-5" id="text-org661128b">
<p>
s=1, k=11, n=52, yielding a 64-bit representation, Bias = 1023
</p>
</div>
</li>
<li><a id="org58cce40"></a>Nomalized Values<br />
<div class="outline-text-5" id="text-org58cce40">
<p>
Condition: exp is not all zeros(0) &amp; not all ones(255 for single, 2047 for double)
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">s</td>
<td class="org-left">exp neither all 1 nor all 0</td>
<td class="org-left">frac</td>
</tr>
</tbody>
</table>
<p>
\(E = e - Bias\), e is the unsigned number, Hance, the range of \(E\) is
</p>
<ul class="org-ul">
<li>\(-126\leq{E}\leq{+127}\) for single</li>
<li>\(-1022\leq{E}\leq{+1023}\) for double</li>
</ul>

<p>
\(M=1+f\) where \(0\leq{f}<1\) having binary representation \(0.f_{n-1}...f_1f_0\)
so that, M is in the range \(1\leq{M}<2\) This implied leading 1 is a trick
for getting an additional bit of precision for free.
</p>
</div>
</li>
<li><a id="org23f577b"></a>Denormalized Values<br />
<div class="outline-text-5" id="text-org23f577b">
<p>
Condition: exp is all zeros
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">s</td>
<td class="org-left">all 0</td>
<td class="org-left">frac</td>
</tr>
</tbody>
</table>
<p>
Serve two purposes:
</p>
<ul class="org-ul">
<li>represent 0 (all bits are zero)</li>
<li>represent numbers that are very close to 0.0</li>
</ul>
</div>
</li>

<li><a id="org7afba39"></a>Spacial Values<br />
<div class="outline-text-5" id="text-org7afba39">
<p>
Condition: exp is all ones
</p>
<ul class="org-ul">
<li><p>
infinity
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">s</td>
<td class="org-left">all 1</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table></li>
<li><p>
NaN
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">s</td>
<td class="org-left">all 1</td>
<td class="org-left">\(\ne 0\)</td>
</tr>
</tbody>
</table></li>
</ul>
</div>
</li>

<li><a id="orgb2903db"></a>Examples<br />
<div class="outline-text-5" id="text-orgb2903db">
<p>
8-bit floating-point format
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-left">bits</th>
<th scope="col" class="org-right">e</th>
<th scope="col" class="org-right">E</th>
<th scope="col" class="org-left">\(2^E\)</th>
<th scope="col" class="org-left">f</th>
<th scope="col" class="org-left">M</th>
<th scope="col" class="org-left">\(2^E\times{M}\)</th>
<th scope="col" class="org-left">V</th>
<th scope="col" class="org-right">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Zero</td>
<td class="org-left">0 0000 000</td>
<td class="org-right">0</td>
<td class="org-right">-6</td>
<td class="org-left">\(\frac{1}{64}\)</td>
<td class="org-left">\(\frac{0}{8}\)</td>
<td class="org-left">\(\frac{0}{8}\)</td>
<td class="org-left">\(\frac{0}{512}\)</td>
<td class="org-left">0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-left">Smallest pos.</td>
<td class="org-left">0 0000 001</td>
<td class="org-right">0</td>
<td class="org-right">-6</td>
<td class="org-left">\(\frac{1}{64}\)</td>
<td class="org-left">\(\frac{1}{8}\)</td>
<td class="org-left">\(\frac{1}{8}\)</td>
<td class="org-left">\(\frac{1}{512}\)</td>
<td class="org-left">\(\frac{1}{512}\)</td>
<td class="org-right">0.001953</td>
</tr>

<tr>
<td class="org-left">Largest denorm.</td>
<td class="org-left">0 0000 111</td>
<td class="org-right">0</td>
<td class="org-right">-6</td>
<td class="org-left">\(\frac{1}{64}\)</td>
<td class="org-left">\(\frac{7}{8}\)</td>
<td class="org-left">\(\frac{7}{8}\)</td>
<td class="org-left">\(\frac{7}{512}\)</td>
<td class="org-left">\(\frac{7}{512}\)</td>
<td class="org-right">0.005859</td>
</tr>

<tr>
<td class="org-left">Smallest norm.</td>
<td class="org-left">0 0001 000</td>
<td class="org-right">1</td>
<td class="org-right">-6</td>
<td class="org-left">\(\frac{1}{64}\)</td>
<td class="org-left">\(\frac{0}{8}\)</td>
<td class="org-left">\(\frac{8}{8}\)</td>
<td class="org-left">\(\frac{8}{512}\)</td>
<td class="org-left">\(\frac{1}{64}\)</td>
<td class="org-right">0.013672</td>
</tr>

<tr>
<td class="org-left">One</td>
<td class="org-left">0 0111 000</td>
<td class="org-right">7</td>
<td class="org-right">0</td>
<td class="org-left">1</td>
<td class="org-left">\(\frac{0}{8}\)</td>
<td class="org-left">\(\frac{8}{8}\)</td>
<td class="org-left">\(\frac{8}{8}\)</td>
<td class="org-left">1</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">Largest norm.</td>
<td class="org-left">0 1110 111</td>
<td class="org-right">14</td>
<td class="org-right">7</td>
<td class="org-left">128</td>
<td class="org-left">\(\frac{7}{8}\)</td>
<td class="org-left">\(\frac{15}{8}\)</td>
<td class="org-left">\(\frac{1920}{8}\)</td>
<td class="org-left">240</td>
<td class="org-right">240.0</td>
</tr>

<tr>
<td class="org-left">Infinity</td>
<td class="org-left">0 1111 000</td>
<td class="org-right">-</td>
<td class="org-right">-</td>
<td class="org-left">-</td>
<td class="org-left">-</td>
<td class="org-left">-</td>
<td class="org-left">-</td>
<td class="org-left">\(\infty\)</td>
<td class="org-right">-</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orga4e74fd" class="outline-2">
<h2 id="orga4e74fd"><span class="section-number-2">2</span> Manipulating Infomation</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org2737cb5" class="outline-3">
<h3 id="org2737cb5"><span class="section-number-3">2.1</span> Integer arithmatic</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgbd04db5" class="outline-4">
<h4 id="orgbd04db5"><span class="section-number-4">2.1.1</span> Unsigned Addition</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
\[ x+^u_wy= \left\{
  \begin{array}{l l}
    x+y & \quad x+y<2^w\\
    x+y-2^w & \quad 2^w\le x+y<2^{w-1}
   \end{array} \right.\]
Same as  \(x+^u_wy=(x+y) \mod 2^w\)
</p>
<p class="verse">
When overflow occured, \(sum=x+y-2^w\)<br />
Because \(y < 2^w\)<br />
We have \(sum = x +(y-2^w) < x\)<br />
sum &lt; x means it did overflow.<br />
</p>
</div>
</div>
<div id="outline-container-orge5a6269" class="outline-4">
<h4 id="orge5a6269"><span class="section-number-4">2.1.2</span> Unsigned Negation</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
\[ -^u_wx= \left\{
  \begin{array}{l l}
    x & \quad x=0\\
    2^w-x & \quad x>0
   \end{array} \right.\]
</p>
</div>
</div>
<div id="outline-container-orgf658e7b" class="outline-4">
<h4 id="orgf658e7b"><span class="section-number-4">2.1.3</span> Two's Complement Addition</h4>
<div class="outline-text-4" id="text-2-1-3">
<ol class="org-ol">
<li>from signed operand to unsigned</li>
<li>excute unsigned addition(truncate the overflow)</li>
</ol>
<p>
\[x+^t_wy\doteq U2T_w(T2U_w(x)+^u_wT2U_w(y))\]
\[=U2T_w[(x_{w-1}2^w+x+y_{w-1}2^w+y) \mod 2^w]\]
\[ x+^t_wy= \left\{
  \begin{array}{l l}
    x+y-2^w & \qquad x+y\ge 2^{w-1} \quad Positive \ overflow\\
    x+y & \qquad -2^{w-1}\le x+y<2^{w-1} \quad Normal\\
    x+y+2^w & \qquad x+y<-2^{w-1} \quad Negative \ overflow
   \end{array} \right.\]
Example:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">\(x\)</th>
<th scope="col" class="org-right">\(y\)</th>
<th scope="col" class="org-right">\(x+y\)</th>
<th scope="col" class="org-right">\(x+^t_4y\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">-8(1000)</td>
<td class="org-right">-5(1011)</td>
<td class="org-right">-13(10011)</td>
<td class="org-right">3(0011)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org84a52cd" class="outline-4">
<h4 id="org84a52cd"><span class="section-number-4">2.1.4</span> Two's Complement Negation</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
\[ -^t_wx= \left\{
  \begin{array}{l l}
    -2^{w-1} & \qquad x=-2^{w-1} \\
    -x & \qquad x>-2^{w-1} \\
   \end{array} \right.\]
Two Clever Ways:
</p>
</div>
<ul class="org-ul">
<li><a id="org0e052b2"></a>One Way<br />
<div class="outline-text-5" id="text-org0e052b2">
<ol class="org-ol">
<li>complement the bits</li>
<li>increment by 1</li>
</ol>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">~x</th>
<th scope="col" class="org-right">incr(~x)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0101(5)</td>
<td class="org-right">1010(-6)</td>
<td class="org-right">1011(-5)</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="org9c82074"></a>Another Way<br />
<div class="outline-text-5" id="text-org9c82074">
<p>
Condition: \(x\neq 0\)
</p>
<ol class="org-ol">
<li>Split the bit vector into two parts.(the boundary is the rightmost 1)</li>
<li>Complement each bit on the left part.</li>
</ol>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">x</th>
<th scope="col" class="org-left">-x</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><i>101</i> 1 (-5)</td>
<td class="org-left"><i>010</i> 1 (5)</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</div>
<div id="outline-container-org87366e5" class="outline-4">
<h4 id="org87366e5"><span class="section-number-4">2.1.5</span> Unsigned Mutliplication</h4>
<div class="outline-text-4" id="text-2-1-5">
<p>
\(0\le x,y\le 2^{w}-1\) Hence,
\[0\le x\cdot y\le2^{2w}-2^{w+1}+1\]
This could require as many as 2w bits to represent.
\[ x \times ^u_wy=(x\cdot y)\ mod\ 2^w\]
</p>
</div>
</div>
<div id="outline-container-org3b1f87c" class="outline-4">
<h4 id="org3b1f87c"><span class="section-number-4">2.1.6</span> Two's Complement Multiplication</h4>
<div class="outline-text-4" id="text-2-1-6">
<p>
\(-2^{w-1}\le x,y \le 2^{w-1}-1\) Hence,
\[ -2^{2w-2}+2^{w-1} \le x\cdot y \le 2^{2w-2}\]
Also need 2w bits to represent.
\[ x \times ^t_wy = U2T_w((x\cdot y)\ mod\ 2^w) \]
</p>
</div>
</div>
<div id="outline-container-org384abe7" class="outline-4">
<h4 id="org384abe7"><span class="section-number-4">2.1.7</span> Reduce Mutiplication by shift and addition</h4>
<div class="outline-text-4" id="text-2-1-7">
<p>
Motivation Mutiplication requires 10 or more clock cycles. shift and addition requires 1 clock cycle.
\[ x \times ^t_w2^k  = x << k\]
</p>
</div>
<ul class="org-ul">
<li><a id="org9544a36"></a>two forms:<br />
<div class="outline-text-5" id="text-org9544a36">
<p>
\[(x << n) + (x << n-1) + \dots + (x << m)\]
\[(x << n+1) - (x << m)\]
</p>
<ul class="org-ul">
<li>eg: \(14\) can be rewrite as \((x<<4) - (x<<1)\) or \((x<<3) + (x<<2) + (x<<1)\)</li>
</ul>

<p>
Assuming additions and subtractions have comparable cost, then we have:
</p>
<ul class="org-ul">
<li>\(n = m\) , use Form1.</li>
<li>\(n = m+1\) , use either Form1 or Form2.</li>
<li>\(n > m+1\) , use Form2.</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="outline-container-org860dee6" class="outline-4">
<h4 id="org860dee6"><span class="section-number-4">2.1.8</span> Reduce Division by shift</h4>
<div class="outline-text-4" id="text-2-1-8">
<p>
Division require 30 or more clock cycles.
</p>
</div>
<ul class="org-ul">
<li><a id="org72f3507"></a>Logical Shift<br />
<div class="outline-text-5" id="text-org72f3507">
<p>
\(x \div 2^k = x>>k\) where \(0 \le{k} < w\) and \(x\ge 0\)
</p>
</div>
</li>

<li><a id="org084b2a2"></a>Arithmatic Shift<br />
<div class="outline-text-5" id="text-org084b2a2">
<p>
\(x \div 2^k = x>>k\) where \(0\le{k} < w\)
Follow the above, we'll find -7/2 yield -4 not -3, corrected by 'biasing' the value before shifting.
</p>
<ul class="org-ul">
<li>\(x \div 2^k = (x+ 2^k - 1) >> k\) where \(x < 0\)</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-org38b40fb" class="outline-3">
<h3 id="org38b40fb"><span class="section-number-3">2.2</span> Floating Operation</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org6c93378" class="outline-4">
<h4 id="org6c93378"><span class="section-number-4">2.2.1</span> Round</h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li>Round-to-even eg: 1.5 approximate 2, 2.5 approximate 2 (DEFAULT) avoid statistical bias</li>
<li>Round-toward-zero eg:-1.5 approximate -1, 1.5 approximate 1</li>
<li>Round-down eg: 1.5 approximate 1</li>
<li>Round-up eg: 1.5 approximate 2</li>
</ul>
</div>
</div>
<div id="outline-container-org7bee764" class="outline-4">
<h4 id="org7bee764"><span class="section-number-4">2.2.2</span> Arithmatic Operation</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
\[x+^fy=Round(x+y)\]
</p>
<ul class="org-ul">
<li>Compute \(x+y\) first, then round</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org860a929" class="outline-2">
<h2 id="org860a929"><span class="section-number-2">3</span> Program Structure</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgbe2a90c" class="outline-3">
<h3 id="orgbe2a90c"><span class="section-number-3">3.1</span> Processor State</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-orga20b910" class="outline-4">
<h4 id="orga20b910"><span class="section-number-4">3.1.1</span> program counter(%eip)</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Indicates the address in memory of the next instruction to be executed
</p>
</div>
</div>
<div id="outline-container-orgdb4e178" class="outline-4">
<h4 id="orgdb4e178"><span class="section-number-4">3.1.2</span> integer register</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Contain eight named locations storing 32-bit values
</p>
</div>
</div>
<div id="outline-container-orge0ae056" class="outline-4">
<h4 id="orge0ae056"><span class="section-number-4">3.1.3</span> condition code register</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
Hold status information about the most recently executed arithmetic or logical instruction
</p>
</div>
</div>
<div id="outline-container-org7b179e4" class="outline-4">
<h4 id="org7b179e4"><span class="section-number-4">3.1.4</span> floating-point register</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
Store floating-point data
</p>
</div>
</div>
</div>

<div id="outline-container-orga65518f" class="outline-3">
<h3 id="orga65518f"><span class="section-number-3">3.2</span> Asm</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-sh">gcc -Og -S xxx.c <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">c -&gt; asm</span>
objdump -d xxx.o <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">obj -&gt; asm: disassemble</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org989320d" class="outline-3">
<h3 id="org989320d"><span class="section-number-3">3.3</span> Data Formats</h3>
<div class="outline-text-3" id="text-3-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">C declaration</th>
<th scope="col" class="org-left">Intel</th>
<th scope="col" class="org-left">Assembly code suffix</th>
<th scope="col" class="org-right">Size(bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">char</td>
<td class="org-left">Byte</td>
<td class="org-left">b</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">short</td>
<td class="org-left">Word</td>
<td class="org-left">w</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">int</td>
<td class="org-left">Double word</td>
<td class="org-left">l</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">long</td>
<td class="org-left">Quad word</td>
<td class="org-left">q</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">char *</td>
<td class="org-left">Quad word</td>
<td class="org-left">q</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">float</td>
<td class="org-left">Single precision</td>
<td class="org-left">s</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">double</td>
<td class="org-left">Double precision</td>
<td class="org-left">l</td>
<td class="org-right">8</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgc179377" class="outline-3">
<h3 id="orgc179377"><span class="section-number-3">3.4</span> Interger Registers</h3>
<div class="outline-text-3" id="text-3-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">63-32</th>
<th scope="col" class="org-left">31-16</th>
<th scope="col" class="org-left">15&#x2014;8</th>
<th scope="col" class="org-left">7&#x2014;0</th>
<th scope="col" class="org-left">use</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">%rax</td>
<td class="org-left">%eax</td>
<td class="org-left">%ax</td>
<td class="org-left">%al</td>
<td class="org-left">return value</td>
</tr>

<tr>
<td class="org-left">%rbx</td>
<td class="org-left">%ebx</td>
<td class="org-left">%bx</td>
<td class="org-left">%bl</td>
<td class="org-left">callee reserved</td>
</tr>

<tr>
<td class="org-left">%rcx</td>
<td class="org-left">%ecx</td>
<td class="org-left">%cx</td>
<td class="org-left">%cl</td>
<td class="org-left">4th argument</td>
</tr>

<tr>
<td class="org-left">%rdx</td>
<td class="org-left">%edx</td>
<td class="org-left">%dx</td>
<td class="org-left">%dl</td>
<td class="org-left">3th argument</td>
</tr>

<tr>
<td class="org-left">%rsi</td>
<td class="org-left">%esi</td>
<td class="org-left">%si</td>
<td class="org-left">%sil</td>
<td class="org-left">2nd argument</td>
</tr>

<tr>
<td class="org-left">%rdi</td>
<td class="org-left">%edi</td>
<td class="org-left">%di</td>
<td class="org-left">%dil</td>
<td class="org-left">1st argument</td>
</tr>

<tr>
<td class="org-left">%rbp</td>
<td class="org-left">%ebp</td>
<td class="org-left">%bp</td>
<td class="org-left">%bpl</td>
<td class="org-left">callee reserved</td>
</tr>

<tr>
<td class="org-left">%rsp</td>
<td class="org-left">%esp</td>
<td class="org-left">%sp</td>
<td class="org-left">%spl</td>
<td class="org-left">stack pointer</td>
</tr>

<tr>
<td class="org-left">%r8</td>
<td class="org-left">%r8d</td>
<td class="org-left">%r8w</td>
<td class="org-left">%r8b</td>
<td class="org-left">5th argument</td>
</tr>

<tr>
<td class="org-left">%r9</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">6th argument</td>
</tr>

<tr>
<td class="org-left">%r10</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">caller reserved</td>
</tr>

<tr>
<td class="org-left">%r11</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">caller reserved</td>
</tr>

<tr>
<td class="org-left">%r12</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">callee reserved</td>
</tr>

<tr>
<td class="org-left">%r13</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">callee reserved</td>
</tr>

<tr>
<td class="org-left">%r14</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">callee reserved</td>
</tr>

<tr>
<td class="org-left">%r15</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">callee reserved</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org101d708" class="outline-3">
<h3 id="org101d708"><span class="section-number-3">3.5</span> Operand Specifiers</h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-org23eafe1" class="outline-4">
<h4 id="org23eafe1"><span class="section-number-4">3.5.1</span> Access from three sources</h4>
<div class="outline-text-4" id="text-3-5-1">
<ol class="org-ol">
<li>immediate: for constant values</li>
<li>register: denotes the contents of one of the registers. \(R[E_a]\)</li>
<li>memory: memory location. \(M[Addr]\)</li>
</ol>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Form</th>
<th scope="col" class="org-left">Operand Value</th>
<th scope="col" class="org-left">Access way</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(\$Imm\)</td>
<td class="org-left">\(Imm\)</td>
<td class="org-left">Immediate</td>
</tr>

<tr>
<td class="org-left">\(r_a\)</td>
<td class="org-left">\(R[r_a]\)</td>
<td class="org-left">Register</td>
</tr>

<tr>
<td class="org-left">\(Imm\)</td>
<td class="org-left">\(M[Imm]\)</td>
<td class="org-left">Absolute</td>
</tr>

<tr>
<td class="org-left">\((r_a)\)</td>
<td class="org-left">\(M[R[r_a]]\)</td>
<td class="org-left">Indirect</td>
</tr>

<tr>
<td class="org-left">\(Imm(r_b)\)</td>
<td class="org-left">\(M[Imm+R[r_b]]\)</td>
<td class="org-left">Base + displacement</td>
</tr>

<tr>
<td class="org-left">\((r_b,r_i)\)</td>
<td class="org-left">\(M[R[r_b]+R[r_i]]\)</td>
<td class="org-left">Indexed</td>
</tr>

<tr>
<td class="org-left">\(Imm(r_b,r_i)\)</td>
<td class="org-left">\(M[Imm+R[r_b]+R[r_i]]\)</td>
<td class="org-left">Indexed</td>
</tr>

<tr>
<td class="org-left">\((,r_i,s)\)</td>
<td class="org-left">\(M[R[r_i]\cdot s]\)</td>
<td class="org-left">Scaled Indexed</td>
</tr>

<tr>
<td class="org-left">\(Imm(,r_i,s)\)</td>
<td class="org-left">\(M[Imm+R[r_i]\cdot s]\)</td>
<td class="org-left">Scaled Indexed</td>
</tr>

<tr>
<td class="org-left">\((r_b, r_i, s)\)</td>
<td class="org-left">\(M[R[r_b]+R[r_i]\cdot s]\)</td>
<td class="org-left">Scaled Indexed</td>
</tr>

<tr>
<td class="org-left">\(Imm(r_b, r_i, s)\)</td>
<td class="org-left">\(M[Imm+R[r_b]+R[r_i]\cdot s]\)</td>
<td class="org-left">Scaled Indexed</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org0c14404" class="outline-3">
<h3 id="org0c14404"><span class="section-number-3">3.6</span> Basic Operations</h3>
<div class="outline-text-3" id="text-3-6">
</div>
<div id="outline-container-orgac8f5ec" class="outline-4">
<h4 id="orgac8f5ec"><span class="section-number-4">3.6.1</span> Data Movement</h4>
<div class="outline-text-4" id="text-3-6-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><b>MOV</b>  S,D</th>
<th scope="col" class="org-left">D &larr; S</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">movb</td>
<td class="org-left">byte</td>
</tr>

<tr>
<td class="org-left">movw</td>
<td class="org-left">word</td>
</tr>

<tr>
<td class="org-left">movl</td>
<td class="org-left">double word</td>
</tr>

<tr>
<td class="org-left">movq</td>
<td class="org-left">quad word</td>
</tr>

<tr>
<td class="org-left">movabsq</td>
<td class="org-left">abs quad word</td>
</tr>
</tbody>
</table>
</div>

<ul class="org-ul">
<li><a id="org0a3770e"></a>small src \(\to\) large dest<br />
<div class="outline-text-5" id="text-org0a3770e">
<ul class="org-ul">
<li><p>
ZeroExtend
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><b>MOVZ</b>  S, R</td>
<td class="org-left">R&larr; ZeroExtend(S)</td>
</tr>
</tbody>
</table>
<p>
eg: movzbl, movzbw, movzwl, movzbq, movzwq
</p></li>
<li><p>
SignExtend
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><b>MOVS</b>  S, R</td>
<td class="org-left">R&larr; SignExtend(S)</td>
</tr>
</tbody>
</table>
<p>
eg: movsbw, movsbl, movswl, movsbq, movswq, movslq, cltq
</p>
<ul class="org-ul">
<li>cltq: %rax \(\leftarrow\) SignExtend(%eax)</li>
</ul></li>
</ul>
</div>
</li>

<li><a id="orgd5c8bbd"></a>push onto the program stack<br />
<div class="outline-text-5" id="text-orgd5c8bbd">
<p>
<b>pushq S</b>
</p>
<ol class="org-ol">
<li>R[%rsp] \(\leftarrow\) R[%rsp] - 8</li>
<li>M[R[%rsp]] \(\leftarrow\) S</li>
</ol>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #6c3163; font-weight: bold;">subq</span> <span style="color: #3a81c3; font-weight: bold;">$8</span>,<span style="color: #715ab1;">%rsp</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Decrement stack pointer</span>
<span style="color: #6c3163; font-weight: bold;">movq</span> <span style="color: #3a81c3; font-weight: bold;">%rbp</span>,<span style="color: #3a81c3;">(</span><span style="color: #715ab1;">%rsp</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">//</span><span style="color: #2aa1ae; background-color: #ecf3ec;">Store %rbp on stack</span>
</pre>
</div>
</div>
</li>

<li><a id="orgcf03fb3"></a>pop from the program stack<br />
<div class="outline-text-5" id="text-orgcf03fb3">
<p>
<b>popq D</b>
</p>
<ol class="org-ol">
<li>D \(\leftarrow\) M[R[%rsp]]</li>
<li>R[%rsp] \(\leftarrow\) R[%rsp + 8]</li>
</ol>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #6c3163; font-weight: bold;">movq</span> <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">%rsp</span><span style="color: #3a81c3;">)</span>,<span style="color: #715ab1;">%rax</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">//</span><span style="color: #2aa1ae; background-color: #ecf3ec;">Read %rax from stack</span>
<span style="color: #6c3163; font-weight: bold;">addl</span> <span style="color: #3a81c3; font-weight: bold;">$4</span>,<span style="color: #715ab1;">%esp</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;">//</span><span style="color: #2aa1ae; background-color: #ecf3ec;">Increment stack pointer</span>
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgde9f221" class="outline-4">
<h4 id="orgde9f221"><span class="section-number-4">3.6.2</span> Arithmetic &amp; Logical Operations</h4>
<div class="outline-text-4" id="text-3-6-2">
</div>
<ul class="org-ul">
<li><a id="orgde95549"></a>unary operations<br />
<div class="outline-text-5" id="text-orgde95549">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">leaq  S,D</td>
<td class="org-left">D &lt;- &amp;S</td>
</tr>

<tr>
<td class="org-left">inc D</td>
<td class="org-left">D &lt;- D+1</td>
</tr>

<tr>
<td class="org-left">dec D</td>
<td class="org-left">D &lt;- D-1</td>
</tr>

<tr>
<td class="org-left">neg D</td>
<td class="org-left">D &lt;- -D</td>
</tr>

<tr>
<td class="org-left">not D</td>
<td class="org-left">D &lt;- ~D(complement)</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="orge8b414e"></a>binary operations<br />
<div class="outline-text-5" id="text-orge8b414e">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">binary op</td>
<td class="org-left">second operand: src &amp; dest</td>
</tr>

<tr>
<td class="org-left">add S,D</td>
<td class="org-left">D &lt;- D+S</td>
</tr>

<tr>
<td class="org-left">sub S,D</td>
<td class="org-left">D &lt;- D-S</td>
</tr>

<tr>
<td class="org-left">imul S,D</td>
<td class="org-left">D &lt;- D*S</td>
</tr>

<tr>
<td class="org-left">xor S,D</td>
<td class="org-left">D &lt;- D^S</td>
</tr>

<tr>
<td class="org-left">or S,D</td>
<td class="org-left">D &lt;- D&vert;S</td>
</tr>

<tr>
<td class="org-left">and S,D</td>
<td class="org-left">D &lt;- D&amp;S</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="org3512a30"></a>shift operations<br />
<div class="outline-text-5" id="text-org3512a30">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">sal k,D</td>
<td class="org-left">D &lt;- D&lt;&lt;k</td>
</tr>

<tr>
<td class="org-left">shl k,D</td>
<td class="org-left">D &lt;- D&lt;&lt;k(same as sal)</td>
</tr>

<tr>
<td class="org-left">sar k,D</td>
<td class="org-left">D &lt;- D&gt;&gt;k(arithmetic shift)</td>
</tr>

<tr>
<td class="org-left">shr k,D</td>
<td class="org-left">D &lt;- D&gt;&gt;k(logical shift)</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</div>

<div id="outline-container-org83fce24" class="outline-4">
<h4 id="org83fce24"><span class="section-number-4">3.6.3</span> Special Arithmetic Operations</h4>
<div class="outline-text-4" id="text-3-6-3">
<p>
imul also support one-operand operaion.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">imulq S</td>
<td class="org-left">R[%edx]:R[%eax] &lt;- S*R[%eax] (Signed)</td>
</tr>

<tr>
<td class="org-left">mulq S</td>
<td class="org-left">R[%edx]:R[%eax] &lt;- S*R[%eax] (Unsigned)</td>
</tr>

<tr>
<td class="org-left">clto</td>
<td class="org-left">R[%edx]:R[%eax] &lt;- SignExtend(R[%eax]) (-&gt; 16 bytes)</td>
</tr>

<tr>
<td class="org-left">idivq S</td>
<td class="org-left">R[%edx] &lt;- R[%edx]:R[%eax] mod S;(Signed)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">R[%eax] &lt;- R[%edx]:R[%eax] / S;(Signed)</td>
</tr>

<tr>
<td class="org-left">divq S</td>
<td class="org-left">like idivq S (Unsigned)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org5cb42f3" class="outline-3">
<h3 id="org5cb42f3"><span class="section-number-3">3.7</span> Control</h3>
<div class="outline-text-3" id="text-3-7">
</div>
<div id="outline-container-org773ea5e" class="outline-4">
<h4 id="org773ea5e"><span class="section-number-4">3.7.1</span> Condiction Register</h4>
<div class="outline-text-4" id="text-3-7-1">
</div>
<ul class="org-ul">
<li><a id="orge6c3aa9"></a>condiction flags<br />
<div class="outline-text-5" id="text-orge6c3aa9">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">CF</td>
<td class="org-left">carry flag</td>
</tr>

<tr>
<td class="org-left">ZF</td>
<td class="org-left">zero flag</td>
</tr>

<tr>
<td class="org-left">SF</td>
<td class="org-left">sign flag(neg number)</td>
</tr>

<tr>
<td class="org-left">OF</td>
<td class="org-left">overflow flag</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li><p>
Example: For t=a+b,
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">CF</td>
<td class="org-left">(unsigned)t &lt; (unsigned)a</td>
<td class="org-left">Unsigned Overflow</td>
</tr>

<tr>
<td class="org-left">ZF</td>
<td class="org-left">(t == 0)</td>
<td class="org-left">Zero</td>
</tr>

<tr>
<td class="org-left">SF</td>
<td class="org-left">(t &lt; 0)</td>
<td class="org-left">Negative</td>
</tr>

<tr>
<td class="org-left">OF</td>
<td class="org-left">(a&lt;0 <code>= b&lt;0)&amp;&amp;(t&lt;0 !</code> a&lt;0)</td>
<td class="org-left">Signed Overflow</td>
</tr>
</tbody>
</table></li>
</ul>
</div>
</li>
<li><a id="orgad8271a"></a>CMP &amp; TEST instructions<br />
<div class="outline-text-5" id="text-orgad8271a">
<p>
These two instructions that set the condiction code without updating their destination.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">cmp \(S_1,S_2\)</td>
<td class="org-left">\(S_2-S_1\)</td>
<td class="org-left">cmpb, cmpw, cmpl, cmpq</td>
</tr>

<tr>
<td class="org-left">test \(S_1,S_2\)</td>
<td class="org-left">\(S_1\) &amp; \(S_2\)</td>
<td class="org-left">testb, testw, testl, testq</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</div>
<div id="outline-container-org75d5587" class="outline-4">
<h4 id="org75d5587"><span class="section-number-4">3.7.2</span> Accessing the Condition Codes</h4>
<div class="outline-text-4" id="text-3-7-2">
<p>
There are three common ways of using the condition codes.
</p>
</div>
<ul class="org-ul">
<li><a id="org118dd34"></a>SET Instruntions<br />
<div class="outline-text-5" id="text-org118dd34">
<ul class="org-ul">
<li><p>
set directly
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Instruction</th>
<th scope="col" class="org-left">Synonym</th>
<th scope="col" class="org-left">Effect</th>
<th scope="col" class="org-left">Set condition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">sete D</td>
<td class="org-left">setz</td>
<td class="org-left">D &lt;- ZF</td>
<td class="org-left">Equal/zero</td>
</tr>

<tr>
<td class="org-left">setne D</td>
<td class="org-left">setnz</td>
<td class="org-left">D &lt;- ~ZF</td>
<td class="org-left">Not Equal/not zero</td>
</tr>

<tr>
<td class="org-left">sets D</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">D &lt;- SF</td>
<td class="org-left">Negative</td>
</tr>

<tr>
<td class="org-left">setns D</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">D &lt;- ~SF</td>
<td class="org-left">Nonnegative</td>
</tr>
</tbody>
</table></li>
<li><p>
signed group
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">setg D</td>
<td class="org-left">setnle</td>
<td class="org-left">D &lt;- ~(SF^OF) &amp; ~ZF</td>
<td class="org-left">&gt;</td>
</tr>

<tr>
<td class="org-left">setge D</td>
<td class="org-left">setnl</td>
<td class="org-left">D &lt;- ~(SF^OF)</td>
<td class="org-left">&gt;=</td>
</tr>

<tr>
<td class="org-left">setl D</td>
<td class="org-left">setnge</td>
<td class="org-left">D &lt;- SF^OF</td>
<td class="org-left">&lt;</td>
</tr>

<tr>
<td class="org-left">setle D</td>
<td class="org-left">setnge</td>
<td class="org-left">D &lt;- (SF^OF) &vert; ZF</td>
<td class="org-left">&lt;=</td>
</tr>
</tbody>
</table></li>
<li><p>
unsigned group
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">seta D</td>
<td class="org-left">setnbe</td>
<td class="org-left">D &lt;- ~CF &amp; ~ZF</td>
<td class="org-left">&gt;</td>
</tr>

<tr>
<td class="org-left">setae D</td>
<td class="org-left">setnb</td>
<td class="org-left">D &lt;- ~CF</td>
<td class="org-left">&gt;=</td>
</tr>

<tr>
<td class="org-left">setb D</td>
<td class="org-left">setnae</td>
<td class="org-left">D &lt;- CF</td>
<td class="org-left">&lt;</td>
</tr>

<tr>
<td class="org-left">setbe D</td>
<td class="org-left">setna</td>
<td class="org-left">D &lt;- CF &vert;  ZF</td>
<td class="org-left">&lt;=</td>
</tr>
</tbody>
</table></li>
</ul>
</div>
</li>
<li><a id="org95f2a35"></a>JUMP instructions<br />
<div class="outline-text-5" id="text-org95f2a35">
<ul class="org-ul">
<li><p>
jump
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Instruction</th>
<th scope="col" class="org-left">Synonym</th>
<th scope="col" class="org-left">Condition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">jmp Label</td>
<td class="org-left">direct jump</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">jmp *Operand</td>
<td class="org-left">indirect jump</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">je L</td>
<td class="org-left">jz</td>
<td class="org-left">ZF</td>
</tr>

<tr>
<td class="org-left">jne L</td>
<td class="org-left">jnz</td>
<td class="org-left">~ZF</td>
</tr>

<tr>
<td class="org-left">js L</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">SF</td>
</tr>

<tr>
<td class="org-left">jns L</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">~SF</td>
</tr>
</tbody>
</table></li>
<li><p>
signed group
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">jg L</td>
<td class="org-left">jnle</td>
<td class="org-left">~(SF^OF)&amp;~ZF</td>
<td class="org-left">&gt;</td>
</tr>

<tr>
<td class="org-left">jge L</td>
<td class="org-left">jnl</td>
<td class="org-left">~(SF^OF)</td>
<td class="org-left">&gt;=</td>
</tr>

<tr>
<td class="org-left">jl L</td>
<td class="org-left">jnge</td>
<td class="org-left">SF^OF</td>
<td class="org-left">&lt;</td>
</tr>

<tr>
<td class="org-left">jle L</td>
<td class="org-left">jng</td>
<td class="org-left">(SF^OF)&vert;ZF</td>
<td class="org-left">&lt;=</td>
</tr>
</tbody>
</table></li>
<li><p>
unsigned group
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">ja L</td>
<td class="org-left">jnbe</td>
<td class="org-left">~CF &amp; ~ZF</td>
<td class="org-left">&gt;</td>
</tr>

<tr>
<td class="org-left">jae L</td>
<td class="org-left">jnb</td>
<td class="org-left">~CF</td>
<td class="org-left">&gt;=</td>
</tr>

<tr>
<td class="org-left">jb L</td>
<td class="org-left">jnae</td>
<td class="org-left">CF</td>
<td class="org-left">&lt;</td>
</tr>

<tr>
<td class="org-left">jbe L</td>
<td class="org-left">jna</td>
<td class="org-left">CF&vert;ZF</td>
<td class="org-left">&lt;=</td>
</tr>
</tbody>
</table></li>
</ul>
</div>
</li>
<li><a id="org0bf916f"></a>conditional MOVE instructions<br />
<div class="outline-text-5" id="text-org0bf916f">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Instruction</th>
<th scope="col" class="org-left">Synonym</th>
<th scope="col" class="org-left">Condition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">cmove S, R</td>
<td class="org-left">cmovz</td>
<td class="org-left">ZF</td>
</tr>

<tr>
<td class="org-left">cmovne</td>
<td class="org-left">cmovnz</td>
<td class="org-left">~ZF</td>
</tr>

<tr>
<td class="org-left">cmovs</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">SF</td>
</tr>

<tr>
<td class="org-left">cmovns</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">~SF</td>
</tr>

<tr>
<td class="org-left">cmovg</td>
<td class="org-left">cmovnle</td>
<td class="org-left">~(SF^OF)&amp;~ZF</td>
</tr>

<tr>
<td class="org-left">cmovge</td>
<td class="org-left">cmovnl</td>
<td class="org-left">~(SF^OF)</td>
</tr>

<tr>
<td class="org-left">cmovl</td>
<td class="org-left">cmovnge</td>
<td class="org-left">SF^OF</td>
</tr>

<tr>
<td class="org-left">cmovle</td>
<td class="org-left">cmovng</td>
<td class="org-left">(SF^OF)&vert;ZF</td>
</tr>

<tr>
<td class="org-left">cmova</td>
<td class="org-left">cmovnbe</td>
<td class="org-left">~CF&amp;~ZF</td>
</tr>

<tr>
<td class="org-left">cmovae</td>
<td class="org-left">cmovnb</td>
<td class="org-left">~CF</td>
</tr>

<tr>
<td class="org-left">cmovb</td>
<td class="org-left">cmovnae</td>
<td class="org-left">CF</td>
</tr>

<tr>
<td class="org-left">cmovbe</td>
<td class="org-left">cmovna</td>
<td class="org-left">CF&vert;ZF</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgd0088e0" class="outline-4">
<h4 id="orgd0088e0"><span class="section-number-4">3.7.3</span> Statements in C</h4>
<div class="outline-text-4" id="text-3-7-3">
</div>
<ul class="org-ul">
<li><a id="orgb3d818a"></a>if<br />
<div class="outline-text-5" id="text-orgb3d818a">
<ul class="org-ul">
<li><p>
General in C
</p>
<div class="org-src-container">
<pre class="src src-text">if (test-expr)
   then-statement
else
   else-statement
</pre>
</div></li>
<li><p>
normal form with goto statement
</p>
<div class="org-src-container">
<pre class="src src-text">    t = test-expr;
    if (t)
       goto true;
    else-statement
    goto done;
true:
    then-statement
done:
</pre>
</div></li>
<li><p>
assembly form
</p>
<div class="org-src-container">
<pre class="src src-text">    t = test-expr;
    if (!t)
       goto false-label;
    then-statement
    goto done;
false-label:
    else-statement
done:
</pre>
</div></li>
<li><p>
when there is no else-statement.
</p>
<div class="org-src-container">
<pre class="src src-text">    t = test-expr;
    if (!t)
       goto done;
    then-statement
done:
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org8e6a900"></a>? condtion<br />
<div class="outline-text-5" id="text-org8e6a900">
<div class="org-src-container">
<pre class="src src-text">v = test-expr ? then-expr : else-expr;
</pre>
</div>
<ul class="org-ul">
<li><p>
standard form
</p>
<div class="org-src-container">
<pre class="src src-text">    if (!test-expr)
        goto false;
    v = then-expr;
    goto done;
false:
    v = else-expr;
done:
</pre>
</div></li>
</ul>
<ul class="org-ul">
<li><p>
more abstract form
</p>
<div class="org-src-container">
<pre class="src src-text">vt = then-expr;
v = else-expr;
t = test-expr;
if (t) v = vt;
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org063c80f"></a>do&#x2026;while<br />
<div class="outline-text-5" id="text-org063c80f">
<div class="org-src-container">
<pre class="src src-text">do
    body-statement
while (test-expr)
</pre>
</div>
<ul class="org-ul">
<li><p>
goto version
</p>
<div class="org-src-container">
<pre class="src src-text">loop:
    body-statement
    t = test-expr;
    if (t)
       goto loop;
done:
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org10eab65"></a>while<br />
<div class="outline-text-5" id="text-org10eab65">
<div class="org-src-container">
<pre class="src src-text">while (test-expr)
    body-statement
</pre>
</div>
<ul class="org-ul">
<li><p>
goto version
</p>
<div class="org-src-container">
<pre class="src src-text">t = test-expr
if (!t)
   goto done;
loop:
   body-statement
   if (t)
      goto loop;
done:
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org8fab6a4"></a>for<br />
<div class="outline-text-5" id="text-org8fab6a4">
<div class="org-src-container">
<pre class="src src-text">for (init-expr; test-expr; update-expr)
    body-statement
</pre>
</div>
<ul class="org-ul">
<li><p>
Equivalent to while loop
</p>
<div class="org-src-container">
<pre class="src src-text">init-expr;
while (test-expr)
    body-statement
    update-expr;
</pre>
</div></li>
<li><p>
goto vesion:
</p>
<div class="org-src-container">
<pre class="src src-text">init-expr;
t = test-expr;
if (!t)
   goto done;

loop:
   body-statement
   update-expr;
   if (t)
      goto loop;
done:
</pre>
</div></li>
</ul>
</div>
</li>
<li><a id="org1b2c464"></a>switch<br />
<div class="outline-text-5" id="text-org1b2c464">
<p>
Compilers uses the <b>jump table</b> to achieve conditional jumping. Think of jump table as an array of function pointers.
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #3a81c3; font-weight: bold;">switch</span> <span style="color: #3a81c3;">(</span>n<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  <span style="color: #3a81c3; font-weight: bold;">case</span> <span style="color: #4e3163;">100</span>:
    ...;
    <span style="color: #3a81c3; font-weight: bold;">break</span>;
  <span style="color: #3a81c3; font-weight: bold;">case</span> <span style="color: #4e3163;">102</span>:
    ...;
    <span style="color: #3a81c3; font-weight: bold;">break</span>;
  <span style="color: #3a81c3; font-weight: bold;">case</span> <span style="color: #4e3163;">103</span>:
    ...;
    <span style="color: #3a81c3; font-weight: bold;">break</span>;
  <span style="color: #3a81c3; font-weight: bold;">case</span> <span style="color: #4e3163;">105</span>:
    ...;
    <span style="color: #3a81c3; font-weight: bold;">break</span>;
  <span style="color: #3a81c3; font-weight: bold;">default</span>:
    <span style="color: #3a81c3; font-weight: bold;">break</span>;
<span style="color: #3a81c3;">}</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
impl
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #4e3163;">loc_A</span>:
  ...
loc_B:
  ...
...

<span style="color: #3a81c3; font-weight: bold;">static</span> <span style="color: #ba2f59; font-weight: bold;">void</span> *jt<span style="color: #3a81c3;">[</span><span style="color: #4e3163;">5</span><span style="color: #3a81c3;">]</span> = <span style="color: #3a81c3;">{</span>
  &amp;&amp;loc_A, &amp;&amp;Loc_B, &amp;&amp;loc_C, &amp;&amp;loc_def, &amp;&amp;loc_D
<span style="color: #3a81c3;">}</span>;
<span style="color: #ba2f59; font-weight: bold;">unsigned</span> <span style="color: #ba2f59; font-weight: bold;">long</span> <span style="color: #715ab1;">index</span> = n-<span style="color: #4e3163;">100</span>;
<span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #3a81c3;">(</span>index &gt; <span style="color: #4e3163;">4</span><span style="color: #3a81c3;">)</span>
  <span style="color: #3a81c3; font-weight: bold;">goto</span> <span style="color: #4e3163;">loc_def</span>;
<span style="color: #3a81c3; font-weight: bold;">goto</span> *it<span style="color: #3a81c3;">[</span>index<span style="color: #3a81c3;">]</span>;

</pre>
</div></li>

<li><p>
jump table in asm
</p>
<div class="org-src-container">
<pre class="src src-asm">  <span style="color: #3a81c3; font-weight: bold;">.section</span> .rodata
  <span style="color: #3a81c3; font-weight: bold;">.align</span> 8 <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Align address to multiple of 8</span>
<span style="color: #6c3163; font-weight: bold;">.L4</span>:
  <span style="color: #3a81c3; font-weight: bold;">.quad</span> .L3 <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">case 100: loc_A</span>
  <span style="color: #3a81c3; font-weight: bold;">.quad</span> .L8 <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">case 101: default</span>
  <span style="color: #3a81c3; font-weight: bold;">.quad</span> .L5 <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">case 102: loc_B</span>
  <span style="color: #3a81c3; font-weight: bold;">.quda</span> .L6 <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">case 103: loc_C</span>
  <span style="color: #3a81c3; font-weight: bold;">.quda</span> .L7 <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">case 105: loc_D</span>
  <span style="color: #3a81c3; font-weight: bold;">.quda</span> .L8 <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">default</span>
</pre>
</div></li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org66a7787" class="outline-3">
<h3 id="org66a7787"><span class="section-number-3">3.8</span> Procedure</h3>
<div class="outline-text-3" id="text-3-8">
<p>
Suppose procedure P(the caller) calls procedure Q(the callee).
</p>
</div>
<div id="outline-container-orgcb33104" class="outline-4">
<h4 id="orgcb33104"><span class="section-number-4">3.8.1</span> Stack Frame</h4>
<div class="outline-text-4" id="text-3-8-1">
<ul class="org-ul">
<li><p>
caller's frame:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">arg n</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
</tr>

<tr>
<td class="org-left">arg 1</td>
</tr>

<tr>
<td class="org-left">return address(push callee's return address to stack)</td>
</tr>

<tr>
<td class="org-left">callee's frame</td>
</tr>
</tbody>
</table></li>

<li><p>
callee's frame:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Saved %rbp</td>
</tr>

<tr>
<td class="org-left">Saved registers, local var, temporaries</td>
</tr>

<tr>
<td class="org-left">Argument build area (%rsp stack pointer)</td>
</tr>

<tr>
<td class="org-left"><b>-stack top-</b></td>
</tr>
</tbody>
</table></li>
</ul>
</div>
</div>
<div id="outline-container-org354d11e" class="outline-4">
<h4 id="org354d11e"><span class="section-number-4">3.8.2</span> Procedure Call</h4>
<div class="outline-text-4" id="text-3-8-2">
<p>
Instructions:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">call Label</td>
<td class="org-left">procedure call</td>
</tr>

<tr>
<td class="org-left">call *Operand</td>
<td class="org-left">procedure call</td>
</tr>

<tr>
<td class="org-left">ret</td>
<td class="org-left">return from call</td>
</tr>
</tbody>
</table>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-text">400540 &lt;multstore&gt;:
  400540: 53        push %rbx
  400541: 48 89 d3  mov  %rdx,%rbx
  ...
  40054d: c3        retq

.caller:
  400563: e8 d8 ff ff ff      callq   400540 &lt;multstore&gt;
  400568: 48 8b 54 24 08      mov     0x8(%rsp),%rdx
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org4a5f754"></a>call<br />
<div class="outline-text-5" id="text-org4a5f754">
<p>
&lt;before&gt;%rip(PC counter): 0x400563, %rsp: 0x7fffffffe840
</p>
<ol class="org-ol">
<li>push a return address on the P's stack</li>
<li>set %rip to the start of Q</li>
</ol>

<p>
&lt;after&gt;%rip: 0x400540, %rsp: 0x7fffffffe838(-8bytes)
</p>
</div>
</li>

<li><a id="orgabcdc52"></a>ret<br />
<div class="outline-text-5" id="text-orgabcdc52">
<ol class="org-ol">
<li>pop value from return address</li>
</ol>

<p>
&lt;after&gt;%rip: 0x400568, %rsp: 0x7fffffffe840
</p>

<ul class="org-ul">
<li>use 0x8(%rsp) to access return value from callee.</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgee7acff" class="outline-3">
<h3 id="orgee7acff"><span class="section-number-3">3.9</span> Array Allocation</h3>
<div class="outline-text-3" id="text-3-9">
</div>
<div id="outline-container-org9f26535" class="outline-4">
<h4 id="org9f26535"><span class="section-number-4">3.9.1</span> 1d-array</h4>
<div class="outline-text-4" id="text-3-9-1">
<p>
\[\&A[i] = \&A[0] + i\cdot sizeof(type)\]
</p>
</div>
</div>
<div id="outline-container-org17b765f" class="outline-4">
<h4 id="org17b765f"><span class="section-number-4">3.9.2</span> 2d-array</h4>
<div class="outline-text-4" id="text-3-9-2">
<p>
for an array declare as D[R][C],
\[\&D[i][j] = \&D[0] + sizeof(type)\cdot (C\cdot i + j)\]
</p>
<ul class="org-ul">
<li><p>
Example
s: start address  t: type size  declaration: A[R][C]
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">A[0][0]</td>
<td class="org-left">s</td>
</tr>

<tr>
<td class="org-left">A[0][1]</td>
<td class="org-left">s+t</td>
</tr>

<tr>
<td class="org-left">A[1][0]</td>
<td class="org-left">s+Ct</td>
</tr>

<tr>
<td class="org-left">A[1][2]</td>
<td class="org-left">s+(C+2)t</td>
</tr>

<tr>
<td class="org-left">A[3][4]</td>
<td class="org-left">s+(3C+4)t</td>
</tr>
</tbody>
</table></li>
</ul>
</div>
</div>
<div id="outline-container-org5a64cad" class="outline-4">
<h4 id="org5a64cad"><span class="section-number-4">3.9.3</span> variable-size array</h4>
<div class="outline-text-4" id="text-3-9-3">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #6c3163; font-weight: bold;">var_ele</span><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">long</span> <span style="color: #715ab1;">n</span>, <span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #715ab1;">A</span><span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">][</span>n<span style="color: #6c3163;">]</span>, <span style="color: #ba2f59; font-weight: bold;">long</span> <span style="color: #715ab1;">i</span>, <span style="color: #ba2f59; font-weight: bold;">long</span> <span style="color: #715ab1;">j</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  <span style="color: #3a81c3; font-weight: bold;">return</span> A<span style="color: #6c3163;">[</span>i<span style="color: #6c3163;">][</span>j<span style="color: #6c3163;">]</span>;
<span style="color: #3a81c3;">}</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #2aa1ae; background-color: #ecf3ec;">//</span><span style="color: #2aa1ae; background-color: #ecf3ec;">n in %rdi, A in %rsi, i in %rdx, j in %rcx</span>
<span style="color: #6c3163; font-weight: bold;">var_ele</span>:
  <span style="color: #3a81c3; font-weight: bold;">imulq</span> <span style="color: #715ab1;">%rdx</span>, <span style="color: #715ab1;">%rdi</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Compute n*i -&gt; %rdi</span>
  <span style="color: #3a81c3; font-weight: bold;">leaq</span>  <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">%rsi</span>,<span style="color: #715ab1;">%rdi</span>,4<span style="color: #3a81c3;">)</span>, <span style="color: #715ab1;">%rax</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Compute &amp;A[0]+4(n*i) -&gt; %rax</span>
  <span style="color: #3a81c3; font-weight: bold;">movl</span>  <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">%rax</span>,<span style="color: #715ab1;">%rcx</span>,4<span style="color: #3a81c3;">)</span>, <span style="color: #715ab1;">%eax</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Read from M[&amp;A[0]+4(n*i)+4j] -&gt; %eax</span>
  <span style="color: #3a81c3; font-weight: bold;">ret</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4f7bb04" class="outline-3">
<h3 id="org4f7bb04"><span class="section-number-3">3.10</span> Float Operations</h3>
<div class="outline-text-3" id="text-3-10">
</div>
<div id="outline-container-org9c7732b" class="outline-4">
<h4 id="org9c7732b"><span class="section-number-4">3.10.1</span> Move</h4>
<div class="outline-text-4" id="text-3-10-1">
<p>
vmovss, vmovsd
</p>
</div>
</div>

<div id="outline-container-orga867a59" class="outline-4">
<h4 id="orga867a59"><span class="section-number-4">3.10.2</span> Conversion</h4>
<div class="outline-text-4" id="text-3-10-2">
<ul class="org-ul">
<li>vcvtsi2ss, vcvtsi2sd</li>
<li>vcvtsi2ssq(64bit int to single), vcvsi2sdq(64bit int to double)</li>
</ul>
</div>
</div>

<div id="outline-container-org2201642" class="outline-4">
<h4 id="org2201642"><span class="section-number-4">3.10.3</span> In Procedure</h4>
<div class="outline-text-4" id="text-3-10-3">
<ul class="org-ul">
<li>%xmm0~%xmm7: store float args</li>
<li>%xmm0: return float</li>
</ul>
</div>
</div>

<div id="outline-container-org0d4d28e" class="outline-4">
<h4 id="org0d4d28e"><span class="section-number-4">3.10.4</span> Operand</h4>
<div class="outline-text-4" id="text-3-10-4">
<ul class="org-ul">
<li>vaddss, vsubss, vmulss, vdivss, vmaxss, vminss, sqrtss</li>
<li>XOR&amp;AND: vxorps, vandps, vorpd(double), andpd(double)</li>
<li>Comparation: ucomiss, ucomisd(double)</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org2df7119" class="outline-2">
<h2 id="org2df7119"><span class="section-number-2">4</span> Optimizing Program Performance</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org42e3063" class="outline-3">
<h3 id="org42e3063"><span class="section-number-3">4.1</span> Limits of Optimizing Compilers</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-org742802c" class="outline-4">
<h4 id="org742802c"><span class="section-number-4">4.1.1</span> memory aliasing</h4>
<div class="outline-text-4" id="text-4-1-1">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163; font-weight: bold;">twiddle1</span><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">int</span> *<span style="color: #715ab1;">xp</span>, <span style="color: #ba2f59; font-weight: bold;">int</span> *<span style="color: #715ab1;">yp</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  *xp += *yp;
  *xp += *yp;
<span style="color: #3a81c3;">}</span>
<span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163; font-weight: bold;">twiddle2</span><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">int</span> *<span style="color: #715ab1;">xp</span>, <span style="color: #ba2f59; font-weight: bold;">int</span> *<span style="color: #715ab1;">yp</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span> *xp += <span style="color: #4e3163;">2</span> * *yp; <span style="color: #3a81c3;">}</span>
</pre>
</div>
<p>
The results will be different when xp == yp. Compilers can't optimize <b>twiddle1</b>
</p>
</div>
</div>
<div id="outline-container-orgaa78831" class="outline-4">
<h4 id="orgaa78831"><span class="section-number-4">4.1.2</span> function calls</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #ba2f59; font-weight: bold;">long</span> <span style="color: #6c3163; font-weight: bold;">f</span><span style="color: #3a81c3;">()</span>;
<span style="color: #ba2f59; font-weight: bold;">long</span> <span style="color: #6c3163; font-weight: bold;">func1</span><span style="color: #3a81c3;">()</span> <span style="color: #3a81c3;">{</span> <span style="color: #3a81c3; font-weight: bold;">return</span> f<span style="color: #6c3163;">()</span> + f<span style="color: #6c3163;">()</span> + f<span style="color: #6c3163;">()</span> + f<span style="color: #6c3163;">()</span>; <span style="color: #3a81c3;">}</span>
<span style="color: #ba2f59; font-weight: bold;">long</span> <span style="color: #6c3163; font-weight: bold;">func2</span><span style="color: #3a81c3;">()</span> <span style="color: #3a81c3;">{</span> <span style="color: #3a81c3; font-weight: bold;">return</span> <span style="color: #4e3163;">4</span> * f<span style="color: #6c3163;">()</span>; <span style="color: #3a81c3;">}</span>
</pre>
</div>
<p>
Compilers don't know if f() has a <i>side effect</i>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb3df4c6" class="outline-3">
<h3 id="orgb3df4c6"><span class="section-number-3">4.2</span> Expressing Program Performance</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-org65e480f" class="outline-4">
<h4 id="org65e480f"><span class="section-number-4">4.2.1</span> CPE(Cycles Per Element)</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
4GHz means \(4.0\times 10^9\) cycles per second.
The period of a 4GHz clock is 0.25 nanoseconds.
</p>
</div>
</div>
</div>

<div id="outline-container-orga768c7b" class="outline-3">
<h3 id="orga768c7b"><span class="section-number-3">4.3</span> Optimizing Performance</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-org1703843" class="outline-4">
<h4 id="org1703843"><span class="section-number-4">4.3.1</span> Eliminating Loop Inefficiencies</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
e.g.: invoke unnecessary <b>strlen</b> in the loop
</p>
</div>
</div>

<div id="outline-container-orgfa65389" class="outline-4">
<h4 id="orgfa65389"><span class="section-number-4">4.3.2</span> Reducing Procedure Calls</h4>
</div>
<div id="outline-container-orgc06b50f" class="outline-4">
<h4 id="orgc06b50f"><span class="section-number-4">4.3.3</span> Eliminating Unneeded Memory References</h4>
<div class="outline-text-4" id="text-4-3-3">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #715ab1;">i</span>;
<span style="color: #ba2f59; font-weight: bold;">int</span> *<span style="color: #715ab1;">result</span> = <span style="color: #4e3163;">0</span>;
<span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>i = <span style="color: #4e3163;">0</span>; i &lt; MAXIMUM; ++i<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  *result = *result + i; <span style="color: #2aa1ae; background-color: #ecf3ec;">//</span><span style="color: #2aa1ae; background-color: #ecf3ec;">just use int instead of int*</span>
<span style="color: #3a81c3;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgba74267" class="outline-3">
<h3 id="orgba74267"><span class="section-number-3">4.4</span> CPU related Optimization</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-orgcfb57eb" class="outline-4">
<h4 id="orgcfb57eb"><span class="section-number-4">4.4.1</span> Two Lower Bounds Characterize the Max Performance</h4>
<div class="outline-text-4" id="text-4-4-1">
<ul class="org-ul">
<li>latency bound: is encountered when a series of operations</li>
</ul>
<p>
must be performed in strict sequence, because the result of one operation is
required before the next one can begin.
</p>

<ul class="org-ul">
<li>throughput bound: characterizes the raw computing capacity of the processor’s functional units.</li>
</ul>
</div>
</div>
<div id="outline-container-orgec8fdbd" class="outline-4">
<h4 id="orgec8fdbd"><span class="section-number-4">4.4.2</span> modern CPU</h4>
<div class="outline-text-4" id="text-4-4-2">

<div class="figure">
<p><img src="../resources/os/CpuBlockDiagram.png" alt="CpuBlockDiagram.png" />
</p>
</div>
</div>
<ul class="org-ul">
<li><a id="org556b992"></a>Branch Prediction &amp; Speculative Execution<br />
<div class="outline-text-5" id="text-org556b992">
<p>
Misprediction incurs a significant cost in performance
</p>
</div>
</li>
<li><a id="org2a92189"></a>Instruction Decoding<br />
<div class="outline-text-5" id="text-org2a92189">
<p>
<b>Instruction decoding</b> logic takes the actual program instructions and converts
them into a set of primitive operations
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #6c3163; font-weight: bold;">addq</span> <span style="color: #3a81c3; font-weight: bold;">%rax</span>, 8<span style="color: #3a81c3;">(</span><span style="color: #715ab1;">%rdx</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
<p>
yields multiple operations, separating the memory references from the arithmetic
operations.
</p>
</div>
</li>

<li><a id="org00312f2"></a>EU<br />
<div class="outline-text-5" id="text-org00312f2">
<p>
The EU receives operations from the instruction fetch unit. Operations are dispatched to
a set of functional units that perform the actual operations.
</p>
</div>
</li>

<li><a id="org4265782"></a>Retirement Unit<br />
<div class="outline-text-5" id="text-org4265782">
<p>
The retirement unit keeps track of the ongoing processing and
makes sure that it obeys the sequential semantics of the machine-level program.
</p>
<ul class="org-ul">
<li>once the operations for the instruction have completed and any branch points</li>
</ul>
<p>
leading to this instruction are confirmed as having been correctly predicted,
the instruction can be <b>retired</b>
</p>
<ul class="org-ul">
<li>If some branch point leading to this instruction was mispredicted, the instruction</li>
</ul>
<p>
will be <b>flushed</b>, discarding any results that may have been computed.
</p>
</div>
</li>

<li><a id="org391f521"></a>Operation Results<br />
<div class="outline-text-5" id="text-org391f521">
<p>
the <b>execution units</b> can send results directly to each other.
</p>
<ul class="org-ul">
<li>The most common mechanism for controlling the communication of operands</li>
</ul>
<p>
among the execution units is called <b>register renaming</b>
</p>
</div>
</li>

<li><a id="org5cecfeb"></a>Functional Unit Performance<br />
<div class="outline-text-5" id="text-org5cecfeb">
<ul class="org-ul">
<li>Latency: the total time required to perform the operation</li>
<li>Issue time: the minimum number of clock cycles between two successive operations of the same type</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Operation</td>
<td class="org-right">Latency</td>
<td class="org-right">Issue</td>
</tr>

<tr>
<td class="org-left">Add(Int)</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Mul(Int)</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Div(Int)</td>
<td class="org-right">3~30</td>
<td class="org-right">3~30</td>
</tr>

<tr>
<td class="org-left">Add(Float)</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Mul(Float)</td>
<td class="org-right">5</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Div(Float)</td>
<td class="org-right">3~15</td>
<td class="org-right">3~15</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>Functional units with issue times of 1 cycle are said to be fully pipelined</li>
<li>Thoughput: \(\frac{number\ of\ function\ unit}{issue\ time}\) cycles per operation</li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-org99057a1" class="outline-4">
<h4 id="org99057a1"><span class="section-number-4">4.4.3</span> <b>Data Flow Analysis</b></h4>
<div class="outline-text-4" id="text-4-4-3">
<p>
Keypoint is finding <b>critical path</b>
</p>
</div>
</div>

<div id="outline-container-org8ff7b2b" class="outline-4">
<h4 id="org8ff7b2b"><span class="section-number-4">4.4.4</span> Loop Unrolling</h4>
<div class="outline-text-4" id="text-4-4-4">
<p>
Loop unrolling is a program transformation that reduces the number of iterations
for a loop by increasing the number of elements computed on each iteration.
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>i = <span style="color: #4e3163;">0</span>; i &lt; n; i++<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  acc = acc * data<span style="color: #6c3163;">[</span>i<span style="color: #6c3163;">]</span>;
<span style="color: #3a81c3;">}</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">--&gt; 2 * 1 loop unrolling</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>i = <span style="color: #4e3163;">0</span>; i &lt; n-<span style="color: #4e3163;">1</span>; i+=<span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">reassociation transformation: better than (acc * data[i]) * data[i+1]</span>
  acc = acc * <span style="color: #6c3163;">(</span>data<span style="color: #2d9574;">[</span>i<span style="color: #2d9574;">]</span> * data<span style="color: #2d9574;">[</span>i+<span style="color: #4e3163;">1</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span>;
<span style="color: #3a81c3;">}</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>; i &lt; n; i++<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">finish any remaining elements</span>
  acc = acc * data<span style="color: #6c3163;">[</span>i<span style="color: #6c3163;">]</span>;
<span style="color: #3a81c3;">}</span>
</pre>
</div>
<ul class="org-ul">
<li>GCC -O3 will perform loop unrolling and reassociations of int operations.</li>
</ul>
</div>
</div>

<div id="outline-container-orgccc8556" class="outline-4">
<h4 id="orgccc8556"><span class="section-number-4">4.4.5</span> Parallelism</h4>
<div class="outline-text-4" id="text-4-4-5">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>i = <span style="color: #4e3163;">0</span>; i &lt; n-<span style="color: #4e3163;">1</span>; i+=<span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  acc0 = acc0 * data<span style="color: #6c3163;">[</span>i<span style="color: #6c3163;">]</span>;
  acc1 = acc1 * data<span style="color: #6c3163;">[</span>i+<span style="color: #4e3163;">1</span><span style="color: #6c3163;">]</span>;
<span style="color: #3a81c3;">}</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>; i &lt; n ; ++<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  acc0 = acc0 * data<span style="color: #6c3163;">[</span>i<span style="color: #6c3163;">]</span>;
<span style="color: #3a81c3;">}</span>
result = acc0 * acc1
</pre>
</div>
<ul class="org-ul">
<li>parallelize <code>map</code> op in <code>mapreduce</code> mechanism</li>
</ul>
</div>
</div>
<div id="outline-container-orgc0e5ffe" class="outline-4">
<h4 id="orgc0e5ffe"><span class="section-number-4">4.4.6</span> Limiting Factors</h4>
<div class="outline-text-4" id="text-4-4-6">
</div>
<ul class="org-ul">
<li><a id="orgbf4983a"></a>Register Spilling<br /></li>
<li><a id="org24ebc51"></a>Branch Prediction and Misprediction Penalties<br />
<div class="outline-text-5" id="text-org24ebc51">
<p>
Branch prediction is only reliable for regular patterns.
</p>

<p>
Principles to avoid branch misprediction penalties
</p>
<ul class="org-ul">
<li>Do not be overly concerned about predictable branches</li>
<li><p>
Write code <b>suitable</b> for implementation with <b>conditional moves</b> (depends on compiler, write and check <b>asm</b>)
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>i = <span style="color: #4e3163;">0</span>; i &lt; N; ++i<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  <span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #6c3163;">(</span>a &lt; b<span style="color: #6c3163;">)</span>
    min = b; <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">not predictable, cost of misprediction penalties is high</span>
<span style="color: #3a81c3;">}</span>

<span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>i = <span style="color: #4e3163;">0</span>; i &lt; N; ++i<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  min = a &lt; b ? a : b; <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">CPE is steady</span>
<span style="color: #3a81c3;">}</span>
</pre>
</div></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-org3f60a2b" class="outline-4">
<h4 id="org3f60a2b"><span class="section-number-4">4.4.7</span> CPU caches</h4>
<div class="outline-text-4" id="text-4-4-7">
<p>
Modern processors have dedicated functional units to perform load and store operations,
and these units have internal buffers to hold sets of outstanding requests for
memory operations.
</p>
</div>
<ul class="org-ul">
<li><a id="orge1f074a"></a>Load Performance<br />
<div class="outline-text-5" id="text-orge1f074a">
<p>
Depends on the pipelining capability and the latency of the load unit.
</p>
</div>
</li>
<li><a id="org9968e36"></a>Store Performance<br />
<div class="outline-text-5" id="text-org9968e36">
<p>
The store operation can operate in a fully pipelined mode, beginning a new store on every cycle.
Because the store operation does not affect any register values.
</p>

<ul class="org-ul">
<li>interaction with load operation</li>
</ul>

<p>
The load operation will check the entries in the store buffer for matching addresses.
If it finds a match, it retrieves the corresponding data entry as the result
of the load operation.
</p>

<p>
<b>When the load and store addresses match, these two operations can't be parallelized.</b>
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org6ee909b" class="outline-3">
<h3 id="org6ee909b"><span class="section-number-3">4.5</span> Basic strategies for Optimization in the Real World</h3>
<div class="outline-text-3" id="text-4-5">
</div>
<div id="outline-container-org832cc58" class="outline-4">
<h4 id="org832cc58"><span class="section-number-4">4.5.1</span> High-level Design</h4>
<div class="outline-text-4" id="text-4-5-1">
<p>
Choose appropriate algorithms and data structures
</p>
</div>
</div>
<div id="outline-container-org897cde1" class="outline-4">
<h4 id="org897cde1"><span class="section-number-4">4.5.2</span> Basic Coding Principles</h4>
<div class="outline-text-4" id="text-4-5-2">
<p>
Avoid optimization blockers so that a compiler can generate efficient code.
</p>
<ul class="org-ul">
<li>Eliminate excessive function calls</li>
<li>Eliminate unnecessary memory references</li>
</ul>
</div>
</div>
<div id="outline-container-orgbcfe644" class="outline-4">
<h4 id="orgbcfe644"><span class="section-number-4">4.5.3</span> Low-level Optimizations</h4>
<div class="outline-text-4" id="text-4-5-3">
<ul class="org-ul">
<li>Unroll loops</li>
<li>Find ways to increase instruction-level parallelism by techniques such as</li>
</ul>
<p>
multiple accumulators and reassociation
</p>
<ul class="org-ul">
<li>Rewrite conditional operations in a functional style to enable compilation</li>
</ul>
<p>
via conditional data transfers
</p>
</div>
</div>
</div>
<div id="outline-container-org7154bbd" class="outline-3">
<h3 id="org7154bbd"><span class="section-number-3">4.6</span> Profiling</h3>
<div class="outline-text-3" id="text-4-6">
</div>
<div id="outline-container-org574cff2" class="outline-4">
<h4 id="org574cff2"><span class="section-number-4">4.6.1</span> Limitation of GPROF</h4>
<div class="outline-text-4" id="text-4-6-1">
<ul class="org-ul">
<li>For programs that run for less than around 1 second, the timing is not very precise</li>
<li>Not work for inline function</li>
<li>By default, the timings for library functions are not shown.</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org7e9fac8" class="outline-2">
<h2 id="org7e9fac8"><span class="section-number-2">5</span> Storage</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org306632c" class="outline-3">
<h3 id="org306632c"><span class="section-number-3">5.1</span> Storage Hierarchy</h3>
<div class="outline-text-3" id="text-5-1">

<div class="figure">
<p><img src="../resources/os/MemoryHierarchy.png" alt="MemoryHierarchy.png" />
</p>
</div>
</div>
<div id="outline-container-org45ad237" class="outline-4">
<h4 id="org45ad237"><span class="section-number-4">5.1.1</span> Static RAM</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
CPU cache
</p>
</div>
</div>
<div id="outline-container-org04b1330" class="outline-4">
<h4 id="org04b1330"><span class="section-number-4">5.1.2</span> Dynamic RAM</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
Main memory
</p>
</div>
</div>
<div id="outline-container-org73d3830" class="outline-4">
<h4 id="org73d3830"><span class="section-number-4">5.1.3</span> Conventional DRAMs</h4>
<div class="outline-text-4" id="text-5-1-3">
</div>
<ul class="org-ul">
<li><a id="org9385ade"></a>memory controller<br /></li>
<li><a id="org3f87665"></a>memory modules<br /></li>
<li><a id="org97a20f8"></a>DRAM supercell<br />
<div class="outline-text-5" id="text-org97a20f8">
<ul class="org-ul">
<li><i>d</i> supercells</li>
<li><i>w</i> DRAM cells in each supercell</li>
<li>A \(d\times w\) DRAM stores <i>dw</i> bits of information</li>
</ul>
</div>
</li>

<li><a id="orgdb246c4"></a>DRAM cells<br />
<div class="outline-text-5" id="text-orgdb246c4">
<ul class="org-ul">
<li>RAS: Row Access Strobe</li>
<li>CAS: Column Access Strobe</li>
<li>Use internal row buffer to cache</li>
</ul>
</div>
</li>

<li><a id="orgd2df434"></a>Data Flow<br />
<div class="outline-text-5" id="text-orgd2df434">
<p>
To retrieve a 64-bit doubleword at memory address A, the memory controller
converts A to a supercell address (i, j ) and sends it to the memory module, which
then broadcasts i and j to each DRAM. In response, each DRAM outputs the 8-
bit contents of its (i, j ) supercell. Circuitry in the module collects these outputs and
forms them into a 64-bit doubleword, which it returns to the memory controller.
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org0090a20" class="outline-4">
<h4 id="org0090a20"><span class="section-number-4">5.1.4</span> Enhanced DRAMs</h4>
<div class="outline-text-4" id="text-5-1-4">
</div>
<ul class="org-ul">
<li><a id="orge13ca36"></a>FPM DRAM<br />
<div class="outline-text-5" id="text-orge13ca36">
<p>
Fast page mode DRAM, allowing consecutive accesses to the same row to be served
directly from the row buffer
</p>
</div>
</li>
<li><a id="org29f6820"></a>EDO DRAM<br />
<div class="outline-text-5" id="text-org29f6820">
<p>
Extended data out DRAM, allows the individual CAS signals to be spaced closer together in time.
</p>
</div>
</li>
<li><a id="org62c93a6"></a>SDRAM<br />
<div class="outline-text-5" id="text-org62c93a6">
<p>
Synchronous DRAM, SDRAM can output the contents of its supercells at a faster rate than its asynchronous counterparts(FPM DRAM &amp; EDO DRAM).
</p>
</div>
</li>
<li><a id="org2dc24fc"></a>DDR SDRAM<br />
<div class="outline-text-5" id="text-org2dc24fc">
<p>
An enhancement of SDRAM that doubles the speed of the DRAM by using both clock edges as control signals. Different types of DDR SDRAMs are
characterized by the size of a small prefetch buffer that increases the effective
bandwidth: DDR (2 bits), DDR2 (4 bits), and DDR3 (8 bits).
</p>
</div>
</li>
<li><a id="org7c39a0c"></a>VRAM<br />
<div class="outline-text-5" id="text-org7c39a0c">
<p>
Used in the frame buffers of graphics systems. VRAM is similar in spirit to FPM DRAM.
Differences are: 1) VRAM output is produced by shifting the entire contents of the
internal buffer in sequence 2) VRAM allows concurrent reads and writes to the memory.
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org4c66d38" class="outline-4">
<h4 id="org4c66d38"><span class="section-number-4">5.1.5</span> Nonvolatile Memory</h4>
<div class="outline-text-4" id="text-5-1-5">
<ul class="org-ul">
<li>programmable ROM (PROM)</li>
<li>erasable programmable ROM (EPROM)</li>
<li>Flash memory</li>
</ul>

<ul class="org-ul">
<li>Programs stored in ROM devices are called <i>firmware</i>. e.g. BIOS</li>
</ul>
</div>
</div>

<div id="outline-container-org2fe3633" class="outline-4">
<h4 id="org2fe3633"><span class="section-number-4">5.1.6</span> Disk</h4>
<div class="outline-text-4" id="text-5-1-6">

<div class="figure">
<p><img src="../resources/os/DiskStructure.png" alt="DiskStructure.png" />
</p>
</div>
<ul class="org-ul">
<li>terms: platter, surface, track, cylinder(vertical), sector(horizontal)</li>
<li>reading information from disk is a 100,000 times longer than from DRAM and 1,000,000 times longer than from SRAM</li>
</ul>
</div>
<ul class="org-ul">
<li><a id="orgad09278"></a>Capacity<br />
<div class="outline-text-5" id="text-orgad09278">
<ul class="org-ul">
<li>recording density: bits/inch</li>
<li>track density: tracks/inch</li>
<li>areal density: \(recording\times track\)</li>
</ul>

<p>
\[Capacity=\frac{\#\ bytes}{sector}\times\frac{average\ \#\ sectors}{track}\times\frac{\#\ track}{surface}\times\frac{\#\ surfaces}{platter}\times\frac{\#\ platters}{disk}\]
</p>
</div>
</li>

<li><a id="orgf4e0571"></a>Access time<br />
<div class="outline-text-5" id="text-orgf4e0571">
<p>
The access time for a sector has three main components
</p>
<ul class="org-ul">
<li>seek time avg 3~9ms (seek track)</li>
<li>rotational latency (seek sector)</li>
</ul>
<p>
\[T_{max}=\frac{1}{RPM}\ minutes\]
\[T_{avg}=\frac{T_{max}}{2}\ minutes\]
</p>
<ul class="org-ul">
<li>transfer time</li>
</ul>
<p>
\[T{avg}=\frac{1}{RPM}\times\frac{1}{avg\ \#\ sectors/track}\ minutes\]
</p>
</div>
</li>
<li><a id="org833cb60"></a>Logical Disk Blocks<br />
<div class="outline-text-5" id="text-org833cb60">
<ul class="org-ul">
<li>number of blocks is equal to number of sectors, numbered 0, 1, &#x2026;, B-1</li>
<li>A firmware device in the disk, called the <i>disk controller</i>,</li>
</ul>
<p>
maintains the mapping between logical block numbers and actual (physical) disk sectors.
</p>
</div>
</li>

<li><a id="org2e7fe11"></a>Accessing Disks<br />
<div class="outline-text-5" id="text-org2e7fe11">
<p>
Uses a technique called <b>memory-mapped I/O</b>. In a system with memory-mapped I/O,
a block of addresses in the address space is reserved for communicating with I/O devices.
Each of these addresses is known as an I/O port. Each device is mapped to one or more
<b>I/O ports</b> when it is attached to the bus.
</p>

<p>
e.g. Reading from disk. Suppose that the <i>disk controller</i> is mapped to port 0xa0
</p>
<ol class="org-ol">
<li>sends a command word that tells the disk to initiate a read</li>
<li>indicates the logical block number that should be read</li>
<li>indicates the main memory address where the contents of the disk sector should be stored.</li>
</ol>

<p>
<i>Disk controller</i> finishes the <b>direct memory access(DMA)</b> transfer, then notify CPU the I/O is done.
</p>
</div>
</li>

<li><a id="org20266b1"></a>SSD<br />
<div class="outline-text-5" id="text-org20266b1">
<p>
Based on flash memory
</p>

<div class="figure">
<p><img src="../resources/os/SSDStructure.png" alt="SSDStructure.png" />
</p>
</div>
<ul class="org-ul">
<li><i>flash translation layer</i>: plays the same role as a <i>disk controller</i> (translating blocks)</li>
<li>B blocks</li>
<li>Each block consists of P pages</li>
<li>Data is read and written in units of pages</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org80e77f5" class="outline-3">
<h3 id="org80e77f5"><span class="section-number-3">5.2</span> BUS</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>system bus</li>
<li>memory bus</li>
<li>I/O bus: independent of the CPU, PCIe(Peripheral Component Interconnect express)</li>
<li>I/O bus connects USB devices, graphics adapter, host bus adapter(SATA, SCSI), network adapter, etc.</li>
</ul>
</div>
</div>

<div id="outline-container-org805cd60" class="outline-3">
<h3 id="org805cd60"><span class="section-number-3">5.3</span> Locality</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<div id="outline-container-org625e1ac" class="outline-4">
<h4 id="org625e1ac"><span class="section-number-4">5.3.1</span> Principle of Locality</h4>
<div class="outline-text-4" id="text-5-3-1">
<dl class="org-dl">
<dt>Good temporal locality</dt><dd></dd>
</dl>
<p>
A memory location that is referenced once is likely to be referenced again multiple times in the near future
</p>

<dl class="org-dl">
<dt>Good Spatial Locality</dt><dd></dd>
</dl>
<p>
If a memory location is referenced once, then the program is likely to reference a nearby memory location in the near future.
</p>
</div>
</div>

<div id="outline-container-org5907c8c" class="outline-4">
<h4 id="org5907c8c"><span class="section-number-4">5.3.2</span> Reference Patterns</h4>
<div class="outline-text-4" id="text-5-3-2">
<ul class="org-ul">
<li>sequential(stride-1) reference pattern enjoys good <i>spatial locality</i></li>
</ul>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">a[M][N]</span>
<span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #715ab1;">sum</span> = <span style="color: #4e3163;">0</span>;
<span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>i = <span style="color: #4e3163;">0</span>; i &lt; N; i++<span style="color: #3a81c3;">)</span>
  <span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #3a81c3;">(</span>j = <span style="color: #4e3163;">0</span>; j &lt; M; j++<span style="color: #3a81c3;">)</span>
    sum += a<span style="color: #3a81c3;">[</span>j<span style="color: #3a81c3;">][</span>i<span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">bad, stride-N</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org21fd3cd" class="outline-4">
<h4 id="org21fd3cd"><span class="section-number-4">5.3.3</span> Locality of Instruction Fetches</h4>
<div class="outline-text-4" id="text-5-3-3">
<p>
Loops have good temporal and spatial locality with respect to instruction fetches.
The smaller the loop body and the greater the number of loop iterations, the better the locality.
</p>
</div>
</div>

<div id="outline-container-org4cf96c8" class="outline-4">
<h4 id="org4cf96c8"><span class="section-number-4">5.3.4</span> Cache Hit</h4>
</div>
<div id="outline-container-org01582d2" class="outline-4">
<h4 id="org01582d2"><span class="section-number-4">5.3.5</span> Cache Miss</h4>
<div class="outline-text-4" id="text-5-3-5">
</div>
<ul class="org-ul">
<li><a id="orge4733ef"></a>Placement Policy<br />
<div class="outline-text-5" id="text-orge4733ef">
<p>
Randomly placed blocks are expensive to locate. Restricts a particular block at level k+1
to a small subset of the blocks at level k.
</p>
</div>
</li>

<li><a id="org6461c8c"></a>Replacement Policy<br />
<div class="outline-text-5" id="text-org6461c8c">
<ul class="org-ul">
<li>random replacement policy</li>
<li>least-recently used(LRU)</li>
</ul>
</div>
</li>

<li><a id="orge0c7e55"></a>Kinds of Cache Misses<br />
<div class="outline-text-5" id="text-orge0c7e55">
<ul class="org-ul">
<li>cold miss(compulsory miss): miss on cold cache(empty cache)</li>
<li>conflict miss: placement policy lead to conflict miss</li>
<li>capacity miss: when the size of the working set exceeds the size of the cache</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgd58d42b" class="outline-3">
<h3 id="orgd58d42b"><span class="section-number-3">5.4</span> Cache Memories</h3>
<div class="outline-text-3" id="text-5-4">

<div class="figure">
<p><img src="../resources/os/CacheOrganization.png" alt="CacheOrganization.png" />
</p>
</div>

<div class="figure">
<p><img src="../resources/os/MemoryAddress.png" alt="MemoryAddress.png" />
</p>
</div>
<ul class="org-ul">
<li>i-cache: A cache that holds instructions, often read-only</li>
<li>d-cache: A cache that holds program data</li>
</ul>

<div class="figure">
<p><img src="../resources/os/ProcessorPackage.png" alt="ProcessorPackage.png" />
</p>
</div>
</div>
<div id="outline-container-org7fff116" class="outline-4">
<h4 id="org7fff116"><span class="section-number-4">5.4.1</span> Terms</h4>
<div class="outline-text-4" id="text-5-4-1">
<dl class="org-dl">
<dt>block</dt><dd></dd>
</dl>
<p>
a fixed-sized packet of information that moves back and forth between a cache and main memory
</p>
<dl class="org-dl">
<dt>line</dt><dd></dd>
</dl>
<p>
a container in a cache that stores a block, as well as other information such as the valid bit and the tag bits
</p>
<dl class="org-dl">
<dt>set</dt><dd></dd>
</dl>
<p>
a collection of one or more lines.
</p>
</div>
</div>

<div id="outline-container-org2a7040a" class="outline-4">
<h4 id="org2a7040a"><span class="section-number-4">5.4.2</span> Parameters</h4>
<div class="outline-text-4" id="text-5-4-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">\(S=2^s\)</td>
<td class="org-left">Number of sets</td>
</tr>

<tr>
<td class="org-left">\(E\)</td>
<td class="org-left">Number of lines per set</td>
</tr>

<tr>
<td class="org-left">\(B=2^b\)</td>
<td class="org-left">Block size(bytes)</td>
</tr>

<tr>
<td class="org-left">\(m=\log_2(M)\)</td>
<td class="org-left">Number of memory address bits</td>
</tr>

<tr>
<td class="org-left">\(M=2^m\)</td>
<td class="org-left">Maximum number of unique memory addresses</td>
</tr>

<tr>
<td class="org-left">\(s=\log_2(S)\)</td>
<td class="org-left">Number of <i>set index bits</i></td>
</tr>

<tr>
<td class="org-left">\(b=\log_2(B)\)</td>
<td class="org-left">Number of <i>block offset bits</i></td>
</tr>

<tr>
<td class="org-left">\(t=m-(s-b)\)</td>
<td class="org-left">Number of <i>tag bits</i></td>
</tr>

<tr>
<td class="org-left">\(C=B\times E \times S\)</td>
<td class="org-left">Cache size exclude valid and tag bits</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li><i>valid bit</i>: indicates whether or not the line contains meaningful information</li>
<li><i>tag bits</i>: a subset of the bits from the current block’s memory address, uniquely</li>
</ul>
<p>
identify the block stored in the cache line.
</p>
<ul class="org-ul">
<li><i>set</i> is like hash table, <i>set index bits</i> as hash code, E indicates the number of buckets.</li>
</ul>
</div>
</div>

<div id="outline-container-orgd61a74a" class="outline-4">
<h4 id="orgd61a74a"><span class="section-number-4">5.4.3</span> Direct-Mapped Caches(\(E=1\))</h4>
<div class="outline-text-4" id="text-5-4-3">
<ol class="org-ol">
<li>Set Selection(set index bits)</li>
<li>Line Matching: if the valid bit is set and the tag in the cache line matches the tag in the address.
<ul class="org-ul">
<li>Cache Hit: Word Selection(block offset bits)</li>
<li>Cache Miss: retrieve from memory</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-orgc3a795f" class="outline-4">
<h4 id="orgc3a795f"><span class="section-number-4">5.4.4</span> Set Associative Caches(\(1<E<C/B\))</h4>
<div class="outline-text-4" id="text-5-4-4">
<ul class="org-ul">
<li>Line Matching Key: tag bits</li>
<li>Cache Miss: use replacement policy, e.g. LFU(least-frequently-used), LRU(least-recently-used)</li>
</ul>
</div>
</div>

<div id="outline-container-orgb79f9d6" class="outline-4">
<h4 id="orgb79f9d6"><span class="section-number-4">5.4.5</span> Fully Associative Caches(\(E=C/B, S=1\))</h4>
<div class="outline-text-4" id="text-5-4-5">
<ul class="org-ul">
<li><p>
no set index bits
</p>

<div class="figure">
<p><img src="../resources/os/FullCacheAddress.png" alt="FullCacheAddress.png" />
</p>
</div></li>
<li>Line Matching: same as Set Associative Caches</li>
<li>only appropriate for small caches, e.g. translation lookaside buffers (TLB)s</li>
</ul>
</div>
</div>
<div id="outline-container-orgcbd680a" class="outline-4">
<h4 id="orgcbd680a"><span class="section-number-4">5.4.6</span> Write Issues</h4>
<div class="outline-text-4" id="text-5-4-6">
</div>
<ul class="org-ul">
<li><a id="org10377fd"></a>Write Hit<br />
<div class="outline-text-5" id="text-org10377fd">
<ul class="org-ul">
<li>write-through: immediately write w’s cache block to the next lower level</li>
<li><b>write-back</b>: updated block to the low level when it is evicted from the cache</li>
</ul>
<p>
by the replacement algorithm. Maintains an additional dirty(modify) bit for each cache line.
</p>
</div>
</li>
<li><a id="org612c6c7"></a>Write Miss<br />
<div class="outline-text-5" id="text-org612c6c7">
<ul class="org-ul">
<li><b>write-allocate</b>: loads the corresponding block from the lower level into the cache</li>
</ul>
<p>
and then updates the cache block
</p>
<ul class="org-ul">
<li>not-write-allocate</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="outline-container-org960d2e3" class="outline-4">
<h4 id="org960d2e3"><span class="section-number-4">5.4.7</span> <b>Performance Impact of Cache Parameters</b></h4>
<div class="outline-text-4" id="text-5-4-7">
</div>
<ul class="org-ul">
<li><a id="org65f56b8"></a>Indicators<br />
<div class="outline-text-5" id="text-org65f56b8">
<ul class="org-ul">
<li>Miss rate: \(\frac{\#\ misses}{\#\ references}\)</li>
<li>Hit rate: \(1-Miss\ rate\)</li>
<li>Hit time: the time to deliver a word in the cache to the CPU</li>
<li>Miss penaly: any additional time required because of a miss</li>
</ul>
</div>
</li>
<li><a id="org1792938"></a>Impacts<br />
<div class="outline-text-5" id="text-org1792938">
<ul class="org-ul">
<li>Cache size</li>
<li>Block size: The larger blocks can help increase the hit rate by exploiting any spatial locality, but expensive</li>
<li>Associativity(E): The larger E decreases the vulnerability of the cache to thrashing due to conflict misses</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="outline-container-org96322e5" class="outline-4">
<h4 id="org96322e5"><span class="section-number-4">5.4.8</span> Writing Cache-friendly Code</h4>
<div class="outline-text-4" id="text-5-4-8">
<ol class="org-ol">
<li>Make the common case go fast</li>
<li>Minimize the number of cache misses in each inner loop(step=1 is the best)</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-org6d33b70" class="outline-2">
<h2 id="org6d33b70"><span class="section-number-2">6</span> Link</h2>
<div class="outline-text-2" id="text-6">
<ol class="org-ol">
<li>preprocesser(cpp for C -&gt; xxx.i)</li>
<li>compiler(cc1 -&gt; xxx.s)</li>
<li>assembler(as -&gt; xxx.o)</li>
<li>linker(ld -&gt; executable)</li>

<li>loader(executable -&gt; memory)</li>
</ol>
</div>

<div id="outline-container-orge5ccad0" class="outline-3">
<h3 id="orge5ccad0"><span class="section-number-3">6.1</span> Object Files</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-orgbc8119c" class="outline-4">
<h4 id="orgbc8119c"><span class="section-number-4">6.1.1</span> Relocatable object file</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
Contains binary code and data in a form that can be combined
with other relocatable object files at compile time to create an
executable object file.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">ELF header(16bytes)</td>
</tr>

<tr>
<td class="org-left">.text</td>
</tr>

<tr>
<td class="org-left">.rodata</td>
</tr>

<tr>
<td class="org-left">.data</td>
</tr>

<tr>
<td class="org-left">.bss</td>
</tr>

<tr>
<td class="org-left">.symtab</td>
</tr>

<tr>
<td class="org-left">.rel.text</td>
</tr>

<tr>
<td class="org-left">.rel.data</td>
</tr>

<tr>
<td class="org-left">.debug</td>
</tr>

<tr>
<td class="org-left">.line</td>
</tr>

<tr>
<td class="org-left">.strtab</td>
</tr>

<tr>
<td class="org-left">Section header table</td>
</tr>
</tbody>
</table>
</div>

<ul class="org-ul">
<li><a id="orgc69fb37"></a>ELF header<br />
<div class="outline-text-5" id="text-orgc69fb37">
<p>
Describes the word size and byte ordering of the system that generated the file
</p>
</div>
</li>

<li><a id="org663583c"></a>.text<br />
<div class="outline-text-5" id="text-org663583c">
<p>
The machine code of the compiled program.
</p>
</div>
</li>

<li><a id="orga72381a"></a>.rodata<br />
<div class="outline-text-5" id="text-orga72381a">
<p>
Read-only data such as the format strings in printf statements, and jump tables for switch statements
</p>
</div>
</li>

<li><a id="org54e5e4f"></a>.data<br />
<div class="outline-text-5" id="text-org54e5e4f">
<p>
Initialized global C variables.
</p>
</div>
</li>

<li><a id="orgf96e193"></a>.bss<br />
<div class="outline-text-5" id="text-orgf96e193">
<p>
Uninitialized global C variables.
</p>
</div>
</li>

<li><a id="orga7ff737"></a>.symtab<br />
<div class="outline-text-5" id="text-orga7ff737">
<p>
A symbol table with information about functions and global variables
that are defined and referenced in the program.
</p>
</div>
</li>

<li><a id="orgab6b119"></a>.rel.text<br />
<div class="outline-text-5" id="text-orgab6b119">
<p>
A list of locations in the .text section that will need to be modified
when the linker combines this object file with others.
</p>
</div>
</li>

<li><a id="org070633a"></a>.rel.data<br />
<div class="outline-text-5" id="text-org070633a">
<p>
Relocation information for any global variables that are refer-
enced or defined by the module.
</p>
</div>
</li>

<li><a id="orgd22bf0c"></a>.debug<br />
<div class="outline-text-5" id="text-orgd22bf0c">
<p>
A debugging symbol table with entries for <b>local variables</b> and <b>typedefs</b>
defined in the program.
</p>
</div>
</li>

<li><a id="orgf825140"></a>.line<br />
<div class="outline-text-5" id="text-orgf825140">
<p>
A mapping between line numbers in the original C source program
and machine code instructions in the .text section.(<code>-g</code> only)
</p>
</div>
</li>

<li><a id="orgfb2381b"></a>.strtab<br />
<div class="outline-text-5" id="text-orgfb2381b">
<p>
A string table for the symbol tables in the .symtab and .debug
sections, and for the section names in the section headers.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org024eb0b" class="outline-4">
<h4 id="org024eb0b"><span class="section-number-4">6.1.2</span> Excutable object file</h4>
<div class="outline-text-4" id="text-6-1-2">
<p>
Contains binary code and data in a form that can be copied
directly into memory and executed.
</p>
</div>
</div>

<div id="outline-container-org8edf48d" class="outline-4">
<h4 id="org8edf48d"><span class="section-number-4">6.1.3</span> Shared object file</h4>
<div class="outline-text-4" id="text-6-1-3">
<p>
A special type of relocatable object file that can be loaded
into memory and linked dynamically, at either load time or run time.
</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<!-- 2018-08-16 Thu 09:36 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python Cookbook</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="ChrisChen" />
<meta name="keywords" content="python" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../styles/demo/css/demo.css"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Python Cookbook</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org45dab28">1. Data Structures and Algorithms</a>
<ul>
<li><a href="#orgd1a139f">1.1. Unpacking from Iterables</a></li>
<li><a href="#org61a71df">1.2. Keeping the Last N Items</a></li>
<li><a href="#org7f53c37">1.3. Finding the Largest N Items</a></li>
<li><a href="#org551ad2a">1.4. PriorityQueue Implemention</a></li>
<li><a href="#org3487ccc">1.5. defaultdict</a>
<ul>
<li><a href="#org84c195f">1.5.1. alternative</a></li>
</ul>
</li>
<li><a href="#orgd2f8279">1.6. OrderedDict</a></li>
<li><a href="#org3cc2a93">1.7. sortedcontainers</a></li>
<li><a href="#org9a10bd8">1.8. Calculating with Dictionaries</a></li>
<li><a href="#orgd2992f0">1.9. keys-view</a></li>
<li><a href="#org68c7fe2">1.10. Naming a Slice</a></li>
<li><a href="#org1eefcdb">1.11. Counting</a></li>
<li><a href="#org022c7e4">1.12. Sorting a List of Dictionaries</a></li>
<li><a href="#orgf67ab97">1.13. Sorting Objects Without Native Comparison</a></li>
<li><a href="#org4f5b6fa">1.14. groupby</a></li>
<li><a href="#org76a21b0">1.15. compress</a></li>
<li><a href="#orge1682e6">1.16. namedtuple&amp;namedlist</a></li>
<li><a href="#org9028366">1.17. sum, min,&#x2026;</a></li>
<li><a href="#org90ca7ef">1.18. ChainMap</a>
<ul>
<li><a href="#org906b84d">1.18.1. store scoped values</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org06112a0">2. Network&amp;Web</a>
<ul>
<li><a href="#org2fbf52b">2.1. RESTful API Query</a>
<ul>
<li><a href="#orga0fedf0">2.1.1. Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5eae2c4">3. Interface</a>
<ul>
<li><a href="#org168177a">3.1. Properties</a></li>
<li><a href="#org87013ad">3.2. Sequences</a></li>
<li><a href="#org413ccc7">3.3. Monkey Patching</a></li>
</ul>
</li>
<li><a href="#orgf341138">4. asyncio</a>
<ul>
<li><a href="#org32555dc">4.1. coroutine</a>
<ul>
<li><a href="#orgb3e2476">4.1.1. states</a></li>
<li><a href="#orgfec6cd3">4.1.2. generator methods</a></li>
<li><a href="#org40eb49d">4.1.3. auto priming</a></li>
<li><a href="#orgd006217">4.1.4. Termination &amp; Exception</a></li>
<li><a href="#org543933e">4.1.5. return value</a></li>
<li><a href="#org1661075">4.1.6. <b>yield from</b></a></li>
<li><a href="#org017e649">4.1.7. example</a></li>
</ul>
</li>
<li><a href="#org3abcb76">4.2. asyncio</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org45dab28" class="outline-2">
<h2 id="org45dab28"><span class="section-number-2">1</span> Data Structures and Algorithms</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgd1a139f" class="outline-3">
<h3 id="orgd1a139f"><span class="section-number-3">1.1</span> Unpacking from Iterables</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-python">x, *<span style="color: #715ab1;">middle</span>, <span style="color: #715ab1;">y</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>, <span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">3</span>, <span style="color: #4e3163;">4</span>, <span style="color: #4e3163;">5</span><span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">middle can be replaced by placeholder '_'</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">x =&gt; 1</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">y =&gt; 5</span>

<span style="color: #715ab1;">data</span> = <span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'ACME'</span>, <span style="color: #4e3163;">50</span>, <span style="color: #4e3163;">91</span>.<span style="color: #4e3163;">1</span>, <span style="color: #6c3163;">(</span><span style="color: #4e3163;">2012</span>, <span style="color: #4e3163;">12</span>, <span style="color: #4e3163;">21</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span>
name, shares, price, <span style="color: #3a81c3;">(</span>year, mon, day<span style="color: #3a81c3;">)</span> = data
</pre>
</div>
</div>
</div>

<div id="outline-container-org61a71df" class="outline-3">
<h3 id="org61a71df"><span class="section-number-3">1.2</span> Keeping the Last N Items</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> deque
<span style="color: #715ab1;">d</span>=deque<span style="color: #3a81c3;">(</span>maxlen=N<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f53c37" class="outline-3">
<h3 id="org7f53c37"><span class="section-number-3">1.3</span> Finding the Largest N Items</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> heapq
heapq.nlargest<span style="color: #3a81c3;">(</span>N, items<span style="color: #3a81c3;">)</span>
heapq.nsmallest<span style="color: #3a81c3;">(</span>N, items<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">heapq.nlargest(N, data, key=lambda function)</span>
</pre>
</div>
<p>
Underneath the covers, they work by first converting the data into a list
where items are ordered as a heap.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">nums</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>, <span style="color: #4e3163;">8</span>, <span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">23</span>, <span style="color: #4e3163;">7</span>, -<span style="color: #4e3163;">4</span>, <span style="color: #4e3163;">18</span>, <span style="color: #4e3163;">23</span>, <span style="color: #4e3163;">42</span>, <span style="color: #4e3163;">37</span>, <span style="color: #4e3163;">2</span><span style="color: #3a81c3;">]</span>
heapq.heapify<span style="color: #3a81c3;">(</span>nums<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">inplace function</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nums =&gt; [-4, 2, 1, 23, 7, 2, 18, 23, 42, 37, 8] heap[0] is the smallest</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org551ad2a" class="outline-3">
<h3 id="org551ad2a"><span class="section-number-3">1.4</span> PriorityQueue Implemention</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> heapq

<span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">PriorityQueue</span>:
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">__init__</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">self</span>._queue = <span style="color: #3a81c3;">[]</span>
        <span style="color: #3a81c3; font-weight: bold;">self</span>._index = <span style="color: #4e3163;">0</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">use index to properly order items with the same priority level</span>

    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">push</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>, item, priority<span style="color: #3a81c3;">)</span>:
        heapq.heappush<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>._queue, <span style="color: #6c3163;">(</span>-priority, <span style="color: #3a81c3; font-weight: bold;">self</span>._index, item<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">self</span>._index += <span style="color: #4e3163;">1</span>

    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">pop</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">return</span> heapq.heappop<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>._queue<span style="color: #3a81c3;">)[</span>-<span style="color: #4e3163;">1</span><span style="color: #3a81c3;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3487ccc" class="outline-3">
<h3 id="org3487ccc"><span class="section-number-3">1.5</span> defaultdict</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> defaultdict
<span style="color: #715ab1;">d</span> = defaultdict<span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">list</span><span style="color: #3a81c3;">)</span>
d<span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'a'</span><span style="color: #3a81c3;">]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; []</span>
</pre>
</div>
<p>
<b>defaultdict</b> will automatically create dictionary entries for keys accessed later on, alternative:
</p>
<div class="org-src-container">
<pre class="src src-python">d.setdefault<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'a'</span>, <span style="color: #6c3163;">[]</span><span style="color: #3a81c3;">)</span>.append<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org84c195f" class="outline-4">
<h4 id="org84c195f"><span class="section-number-4">1.5.1</span> alternative</h4>
<div class="outline-text-4" id="text-1-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">d</span> = <span style="color: #3a81c3;">{}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">A regular dictionary</span>
d.setdefault<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'a'</span>, <span style="color: #6c3163;">[]</span><span style="color: #3a81c3;">)</span>.append<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd2f8279" class="outline-3">
<h3 id="orgd2f8279"><span class="section-number-3">1.6</span> OrderedDict</h3>
<div class="outline-text-3" id="text-1-6">
<p>
An OrderedDict internally maintains a doubly linked list that orders the keys according to insertion order.
</p>
</div>
</div>

<div id="outline-container-org3cc2a93" class="outline-3">
<h3 id="org3cc2a93"><span class="section-number-3">1.7</span> sortedcontainers</h3>
<div class="outline-text-3" id="text-1-7">
<p>
SortedList, SortedDict, SortedSet
</p>
</div>
</div>

<div id="outline-container-org9a10bd8" class="outline-3">
<h3 id="org9a10bd8"><span class="section-number-3">1.8</span> Calculating with Dictionaries</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">prices</span> = <span style="color: #3a81c3;">{</span>
    <span style="color: #2d9574;">'ACME'</span>: <span style="color: #4e3163;">45</span>.<span style="color: #4e3163;">23</span>,
    <span style="color: #2d9574;">'AAPL'</span>: <span style="color: #4e3163;">612</span>.<span style="color: #4e3163;">78</span>,
    <span style="color: #2d9574;">'IBM'</span>: <span style="color: #4e3163;">205</span>.<span style="color: #4e3163;">55</span>,
    <span style="color: #2d9574;">'HPQ'</span>: <span style="color: #4e3163;">37</span>.<span style="color: #4e3163;">20</span>,
    <span style="color: #2d9574;">'FB'</span>: <span style="color: #4e3163;">10</span>.<span style="color: #4e3163;">75</span>
<span style="color: #3a81c3;">}</span>
<span style="color: #715ab1;">min_price</span> = <span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">zip</span><span style="color: #6c3163;">(</span>prices.values<span style="color: #2d9574;">()</span>, prices.keys<span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">zip to ((value, key)) generator</span>

<span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span>prices, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> k: prices<span style="color: #6c3163;">[</span>k<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns 'FB'</span>
<span style="color: #715ab1;">min_value</span> = prices<span style="color: #3a81c3;">[</span><span style="color: #3a81c3;">min</span><span style="color: #6c3163;">(</span>prices, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> k: prices<span style="color: #2d9574;">[</span>k<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2992f0" class="outline-3">
<h3 id="orgd2992f0"><span class="section-number-3">1.9</span> keys-view</h3>
<div class="outline-text-3" id="text-1-9">
<div class="org-src-container">
<pre class="src src-python">a.keys<span style="color: #3a81c3;">()</span> &amp; b.keys<span style="color: #3a81c3;">()</span>
a.keys<span style="color: #3a81c3;">()</span> - <span style="color: #3a81c3;">{</span><span style="color: #2d9574;">'z'</span>, <span style="color: #2d9574;">'w'</span><span style="color: #3a81c3;">}</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{'z', 'w'} is a set</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68c7fe2" class="outline-3">
<h3 id="org68c7fe2"><span class="section-number-3">1.10</span> Naming a Slice</h3>
<div class="outline-text-3" id="text-1-10">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">a</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>,<span style="color: #4e3163;">2</span>,<span style="color: #4e3163;">3</span>,<span style="color: #4e3163;">4</span>,<span style="color: #4e3163;">5</span><span style="color: #3a81c3;">]</span>
<span style="color: #715ab1;">b</span> = <span style="color: #3a81c3;">slice</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span>,<span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span>

a<span style="color: #3a81c3;">[</span>b<span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [2] slower than a[1]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1eefcdb" class="outline-3">
<h3 id="org1eefcdb"><span class="section-number-3">1.11</span> Counting</h3>
<div class="outline-text-3" id="text-1-11">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> Counter
<span style="color: #715ab1;">word_counts1</span> = Counter<span style="color: #3a81c3;">(</span>words1<span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">word_counts2</span> = Counter<span style="color: #3a81c3;">(</span>words2<span style="color: #3a81c3;">)</span>
word_counts1 + word_counts2
</pre>
</div>
</div>
</div>

<div id="outline-container-org022c7e4" class="outline-3">
<h3 id="org022c7e4"><span class="section-number-3">1.12</span> Sorting a List of Dictionaries</h3>
<div class="outline-text-3" id="text-1-12">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> operator <span style="color: #3a81c3; font-weight: bold;">import</span> itemgetter
<span style="color: #715ab1;">rows_by_fname</span> = <span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>rows, key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'fname'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">rows_by_lfname</span> = <span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>rows, key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'lname'</span>,<span style="color: #2d9574;">'fname'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #715ab1;">g</span> = itemgetter<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">5</span>, <span style="color: #4e3163;">3</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the call g(r) returns (r[2], r[5], r[3])</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf67ab97" class="outline-3">
<h3 id="orgf67ab97"><span class="section-number-3">1.13</span> Sorting Objects Without Native Comparison</h3>
<div class="outline-text-3" id="text-1-13">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>users, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> u: u.user_id<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">from</span> operator <span style="color: #3a81c3; font-weight: bold;">import</span> attrgetter
<span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>users, key=attrgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'user_id'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">by_name</span> = <span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>users, key=attrgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'last_name'</span>, <span style="color: #2d9574;">'first_name'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f5b6fa" class="outline-3">
<h3 id="org4f5b6fa"><span class="section-number-3">1.14</span> groupby</h3>
<div class="outline-text-3" id="text-1-14">
<p>
Since <code>groupby()</code> only examines consecutive items, should sort the groupby key first.
</p>
<div class="org-src-container">
<pre class="src src-python">rows.sort<span style="color: #3a81c3;">(</span>key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'date'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> date, items <span style="color: #3a81c3; font-weight: bold;">in</span> groupby<span style="color: #3a81c3;">(</span>rows, key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'date'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">pass</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">alternative if memory is no concern, and faster than sort+groupby</span>
<span style="color: #715ab1;">rows_by_date</span> = defaultdict<span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">list</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> row <span style="color: #3a81c3; font-weight: bold;">in</span> rows:
    rows_by_date<span style="color: #3a81c3;">[</span>row<span style="color: #6c3163;">[</span><span style="color: #2d9574;">'date'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">]</span>.append<span style="color: #3a81c3;">(</span>row<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org76a21b0" class="outline-3">
<h3 id="org76a21b0"><span class="section-number-3">1.15</span> compress</h3>
<div class="outline-text-3" id="text-1-15">
<p>
Takes an iterable and an accompanying Boolean selector sequence as input.
<code>list(compress(data, mask))</code>
</p>
</div>
</div>

<div id="outline-container-orge1682e6" class="outline-3">
<h3 id="orge1682e6"><span class="section-number-3">1.16</span> namedtuple&amp;namedlist</h3>
<div class="outline-text-3" id="text-1-16">
<p>
optional or missing fields
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">Stock</span> = namedtuple<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'Stock'</span>, <span style="color: #6c3163;">[</span><span style="color: #2d9574;">'name'</span>, <span style="color: #2d9574;">'shares'</span>, <span style="color: #2d9574;">'price'</span>, <span style="color: #2d9574;">'date'</span>, <span style="color: #2d9574;">'time'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">stock_prototype</span> = Stock<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">''</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>.<span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">None</span>, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">dict_to_stock</span><span style="color: #3a81c3;">(</span>s<span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">return</span> stock_prototype._replace<span style="color: #3a81c3;">(</span>**s<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9028366" class="outline-3">
<h3 id="org9028366"><span class="section-number-3">1.17</span> sum, min,&#x2026;</h3>
<div class="outline-text-3" id="text-1-17">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">s</span> = <span style="color: #3a81c3;">sum</span><span style="color: #3a81c3;">(</span><span style="color: #6c3163;">(</span>x * x <span style="color: #3a81c3; font-weight: bold;">for</span> x <span style="color: #3a81c3; font-weight: bold;">in</span> nums<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">s</span> = <span style="color: #3a81c3;">sum</span><span style="color: #3a81c3;">(</span>x * x <span style="color: #3a81c3; font-weight: bold;">for</span> x <span style="color: #3a81c3; font-weight: bold;">in</span> nums<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">same as above</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Original: Returns 20</span>
<span style="color: #715ab1;">min_shares</span> = <span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span>s<span style="color: #6c3163;">[</span><span style="color: #2d9574;">'shares'</span><span style="color: #6c3163;">]</span> <span style="color: #3a81c3; font-weight: bold;">for</span> s <span style="color: #3a81c3; font-weight: bold;">in</span> portfolio<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Alternative: Returns {'name': 'AOL', 'shares': 20}</span>
<span style="color: #715ab1;">min_shares</span> = <span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span>portfolio, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> s: s<span style="color: #6c3163;">[</span><span style="color: #2d9574;">'shares'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org90ca7ef" class="outline-3">
<h3 id="org90ca7ef"><span class="section-number-3">1.18</span> ChainMap</h3>
<div class="outline-text-3" id="text-1-18">
<p>
A ChainMap takes multiple mappings and makes them logically appear as one. If there are duplicate keys,
the values from the first mapping get used.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> ChainMap
<span style="color: #715ab1;">c</span> = ChainMap<span style="color: #3a81c3;">(</span>a,b<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">alternative</span>
<span style="color: #715ab1;">c</span> = b
c.update<span style="color: #3a81c3;">(</span>a<span style="color: #3a81c3;">)</span>
</pre>
</div>
<ul class="org-ul">
<li>but ChainMap keep the reference of a&amp;b</li>
</ul>
</div>


<div id="outline-container-org906b84d" class="outline-4">
<h4 id="org906b84d"><span class="section-number-4">1.18.1</span> store scoped values</h4>
<div class="outline-text-4" id="text-1-18-1">
<p>
A ChainMap is particularly useful when working with scoped values such as variables in
a programming language (i.e., globals, locals, etc.)
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">values</span> = ChainMap<span style="color: #3a81c3;">()</span>
<span style="color: #715ab1;">values</span><span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> = <span style="color: #4e3163;">1</span>
<span style="color: #715ab1;">values</span> = values.new_child<span style="color: #3a81c3;">()</span>
<span style="color: #715ab1;">values</span><span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> = <span style="color: #4e3163;">2</span>
values<span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 2</span>
<span style="color: #715ab1;">values</span> = values.parents
values<span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org06112a0" class="outline-2">
<h2 id="org06112a0"><span class="section-number-2">2</span> Network&amp;Web</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org2fbf52b" class="outline-3">
<h3 id="org2fbf52b"><span class="section-number-3">2.1</span> RESTful API Query</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> urllib <span style="color: #3a81c3; font-weight: bold;">import</span> request, parse
<span style="color: #715ab1;">url</span> = <span style="color: #2d9574;">'http://www.123.com/get'</span>
<span style="color: #715ab1;">params</span> = <span style="color: #3a81c3;">{</span>
    <span style="color: #2d9574;">'name1'</span> : <span style="color: #2d9574;">'value1'</span>,
    <span style="color: #2d9574;">'name2'</span> : <span style="color: #2d9574;">'value2'</span>
<span style="color: #3a81c3;">}</span>
<span style="color: #715ab1;">query_string</span> = parse.urlencode<span style="color: #3a81c3;">(</span>params<span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">headers</span>
<span style="color: #715ab1;">headers</span> = <span style="color: #3a81c3;">{</span>
    <span style="color: #2d9574;">'User-agent'</span> : <span style="color: #2d9574;">'none/ofyourbusiness'</span>,
    <span style="color: #2d9574;">'Spam'</span> : <span style="color: #2d9574;">'Eggs'</span>
<span style="color: #3a81c3;">}</span>

<span style="color: #715ab1;">u</span> = request.urlopen<span style="color: #3a81c3;">(</span>url+<span style="color: #2d9574;">'?'</span> + query_string.encode<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'ascii'</span><span style="color: #6c3163;">)</span>, headers=headers<span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">resp</span> = u.read<span style="color: #3a81c3;">()</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">resp.text(unicode),  resp.content(raw binary), resp.json</span>
</pre>
</div>
<ul class="org-ul">
<li>useful resp data
<ul class="org-ul">
<li><code>resp.status_code</code></li>
<li><code>resp.headers['last-modified']</code></li>
<li><code>resp.headers['content-type']</code></li>
<li><code>resp.headers['content-length']</code></li>
</ul></li>

<li>urlopen useful args
<ul class="org-ul">
<li>headers</li>
<li>cookies</li>
<li>files</li>
<li>auth</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orga0fedf0" class="outline-4">
<h4 id="orga0fedf0"><span class="section-number-4">2.1.1</span> Testing</h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>use <a href="http://httpbin.org/">httpbin</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org5eae2c4" class="outline-2">
<h2 id="org5eae2c4"><span class="section-number-2">3</span> Interface</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org168177a" class="outline-3">
<h3 id="org168177a"><span class="section-number-3">3.1</span> Properties</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">Prop</span>:
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">__init__</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>, x<span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">self</span>.__x = x

    <span style="color: #ba2f59; font-weight: bold;">@property</span>
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">x</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">return</span> <span style="color: #3a81c3; font-weight: bold;">self</span>.__x

    <span style="color: #ba2f59; font-weight: bold;">@x.setter</span>
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">x</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>, value<span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">self</span>.__x = value
</pre>
</div>
</div>
</div>

<div id="outline-container-org87013ad" class="outline-3">
<h3 id="org87013ad"><span class="section-number-3">3.2</span> Sequences</h3>
<div class="outline-text-3" id="text-3-2">

<div class="figure">
<p><img src="../resources/python/SeqInterface.png" alt="SeqInterface.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org413ccc7" class="outline-3">
<h3 id="org413ccc7"><span class="section-number-3">3.3</span> Monkey Patching</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Changing a class or module at runtime, without touching the source code.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">some_obj.__getitem__</span> = some_get_function<span style="color: #3a81c3;">(</span>some_class, position<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf341138" class="outline-2">
<h2 id="orgf341138"><span class="section-number-2">4</span> asyncio</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org32555dc" class="outline-3">
<h3 id="org32555dc"><span class="section-number-3">4.1</span> coroutine</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">simple_coroutine</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'-&gt; coroutine started'</span><span style="color: #3a81c3;">)</span>
    <span style="color: #715ab1;">x</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">received by send(x)</span>
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'-&gt; coroutine received:'</span>, x<span style="color: #3a81c3;">)</span>

<span style="color: #715ab1;">coro</span> = simple_coroutine<span style="color: #3a81c3;">()</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">GEN_CREATED</span>
<span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>coro<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">equivalent to coro.send(None). GEN_CREATED-&gt;GEN_RUNNING-&gt;GEN_SUSPENDED</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">-&gt; coroutine started</span>
coro.send<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">42</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">GEN_SUSPENDED-&gt;GEN_RUNNING-&gt;GEN_CLOSED</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">-&gt; coroutine received: 42</span>
</pre>
</div>
<ul class="org-ul">
<li>next(coro) is often describe as "priming" the coroutine(advancing it to the first yield)</li>
</ul>
</div>

<div id="outline-container-orgb3e2476" class="outline-4">
<h4 id="orgb3e2476"><span class="section-number-4">4.1.1</span> states</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
use <code>inspect.getgeneratorstate()</code> to get state
</p>
<ul class="org-ul">
<li>GEN_CREATED: Waiting to start execution</li>
<li>GEN_RUNNING: Currently being executed by the interpreter</li>
<li>GEN_SUSPENDED: Currently suspended at a yield expression</li>
<li>GEN_CLOSED</li>
</ul>
</div>
</div>

<div id="outline-container-orgfec6cd3" class="outline-4">
<h4 id="orgfec6cd3"><span class="section-number-4">4.1.2</span> generator methods</h4>
<div class="outline-text-4" id="text-4-1-2">
<ul class="org-ul">
<li>send(value): the caller can post data that then becomes the value of the yield expression inside the generator.</li>
<li>throw(): allow the caller to throw an exception to be handled inside the generator.</li>
<li>close()</li>
</ul>
</div>
</div>

<div id="outline-container-org40eb49d" class="outline-4">
<h4 id="org40eb49d"><span class="section-number-4">4.1.3</span> auto priming</h4>
<div class="outline-text-4" id="text-4-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> functools <span style="color: #3a81c3; font-weight: bold;">import</span> wraps
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">coroutine</span><span style="color: #3a81c3;">(</span>func<span style="color: #3a81c3;">)</span>:
    <span style="color: #2d9574;">"""Decorator: primes `func` by advancing to first `yield`"""</span>
    <span style="color: #ba2f59; font-weight: bold;">@wraps</span><span style="color: #3a81c3;">(</span>func<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">primer</span><span style="color: #3a81c3;">(</span>*args,**kwargs<span style="color: #3a81c3;">)</span>:
        <span style="color: #715ab1;">gen</span> = func<span style="color: #3a81c3;">(</span>*args,**kwargs<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>gen<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">return</span> gen
    <span style="color: #3a81c3; font-weight: bold;">return</span> primer

<span style="color: #ba2f59; font-weight: bold;">@coroutine</span>
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">simple_coroutine</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #715ab1;">x</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span>

<span style="color: #715ab1;">coro</span> = simple_coroutine<span style="color: #3a81c3;">()</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">-&gt; GEN_SUSPENDED</span>
</pre>
</div>
<ul class="org-ul">
<li><code>yield from</code> automatically primes the coroutine called by it, making it incompatible with the coroutine decorator above.</li>
<li><code>asyncio.coroutine</code> is designed to work with yield from so it does not prime the coroutine.</li>
</ul>
</div>
</div>

<div id="outline-container-orgd006217" class="outline-4">
<h4 id="orgd006217"><span class="section-number-4">4.1.4</span> Termination &amp; Exception</h4>
<div class="outline-text-4" id="text-4-1-4">
</div>
<ul class="org-ul">
<li><a id="org44cad8c"></a>from generator<br />
<div class="outline-text-5" id="text-org44cad8c">
<p>
An exception within a coroutine propagates to the caller of the next or send that triggered it.
</p>
</div>
</li>
<li><a id="org0b723c2"></a>to generator<br />
<div class="outline-text-5" id="text-org0b723c2">
<ul class="org-ul">
<li><code>throw</code>: Causes the yield expression where the generator was paused to raise the exception given.</li>
<li><code>close</code>: Causes the yield expression where the generator was paused to raise a Generator Exit exception.</li>
</ul>
</div>
</li>
<li><a id="org7a44a2f"></a>cleanup code<br />
<div class="outline-text-5" id="text-org7a44a2f">
<p>
wrap the cleanup code in <code>try/finally</code> block
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org543933e" class="outline-4">
<h4 id="org543933e"><span class="section-number-4">4.1.5</span> return value</h4>
<div class="outline-text-4" id="text-4-1-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">Result</span> = namedtuple<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'Result'</span>, <span style="color: #2d9574;">'count average'</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">averager</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #715ab1;">total</span> = <span style="color: #4e3163;">0</span>.<span style="color: #4e3163;">0</span>
    <span style="color: #715ab1;">count</span> = <span style="color: #4e3163;">0</span>
    <span style="color: #715ab1;">average</span> = <span style="color: #4e3163;">None</span>
    <span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">True</span>:
        <span style="color: #715ab1;">term</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">yield None</span>
        <span style="color: #3a81c3; font-weight: bold;">if</span> term <span style="color: #3a81c3; font-weight: bold;">is</span> <span style="color: #4e3163;">None</span>:
            <span style="color: #3a81c3; font-weight: bold;">break</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">use a sentinel to terminate the coroutine normally</span>
        <span style="color: #715ab1;">total</span> += term
        <span style="color: #715ab1;">count</span> += <span style="color: #4e3163;">1</span>
        <span style="color: #715ab1;">average</span> = total/count
    <span style="color: #3a81c3; font-weight: bold;">return</span> Result<span style="color: #3a81c3;">(</span>count, average<span style="color: #3a81c3;">)</span>

<span style="color: #715ab1;">coro_avg</span> = averager<span style="color: #3a81c3;">()</span>
coro_avg.send<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">10</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">try</span>:
    coro_avg.send<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span> <span style="color: #3a81c3; font-weight: bold;">as</span> exc:
    <span style="color: #715ab1;">result</span> = exc.value <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Result(count=3, average=15.5)</span>
</pre>
</div>
<ul class="org-ul">
<li>in order to return a value, a coroutine must terminate normally</li>
</ul>
</div>
</div>

<div id="outline-container-org1661075" class="outline-4">
<h4 id="org1661075"><span class="section-number-4">4.1.6</span> <b>yield from</b></h4>
<div class="outline-text-4" id="text-4-1-6">
<p>
The main feature of <b>yield from</b> is to open a bidirectional channel from the outermost caller to the innermost subgenerator, so that values
can be sent and yielded back and forth directly from them, and exceptions can be thrown all the way in without adding a lot of exception
handling boilerplate code in the intermediate coroutines.
</p>

<ul class="org-ul">
<li>similar constructs in other languages are called <b>await</b></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">gen</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #3a81c3; font-weight: bold;">from</span> <span style="color: #2d9574;">'abc'</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">shortcut for forloop</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">for x in 'abc':</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;">#     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">yield x</span>
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org61745b9"></a>terms<br />
<div class="outline-text-5" id="text-org61745b9">
<ul class="org-ul">
<li>delegating generator: The generator function that contains the <b>yield from &lt;iterable&gt;</b> expression</li>
<li>subgenerator</li>
<li>caller</li>
</ul>


<div class="figure">
<p><img src="../resources/python/coroutine.png" alt="coroutine.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Coroutine</p>
</div>
</div>
</li>

<li><a id="orgc019f88"></a>meaning of <b>yield from</b><br />
<div class="outline-text-5" id="text-orgc019f88">
<ul class="org-ul">
<li>Any values that the subgenerator yields are passed directly to the caller of the delegating generator</li>
<li>Any values sent to the delegating generator using <b>send()</b> are passed directly to the subgenerator.</li>
</ul>
<p>
If the sent value is <b>None</b>, the subgenerator's <b>__next__()</b> method is called. If the sent value is
not <b>None</b>, the subgenerator's <b>send()</b> method is called. If the call raises <b>StopIteration</b>, the delegating
generator is resumed. Any other exception is propagated to the delegating generator.
</p>
<ul class="org-ul">
<li>return expr in a generator (or subgenerator) causes <b>StopIteration(expr)</b> to be raised upon exit from</li>
</ul>
<p>
the generator.
</p>
<ul class="org-ul">
<li>The value of the <b>yield from</b> expression is the first argument to the <b>StopIteration</b> exception raised by</li>
</ul>
<p>
the subgenerator when it terminates.
</p>
</div>
</li>

<li><a id="orgcd02eb9"></a>pseudocode<br />
<div class="outline-text-5" id="text-orgcd02eb9">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">_i</span> = <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span>EXPR<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">try</span>:
    <span style="color: #715ab1;">_y</span> = <span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>_i<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span> <span style="color: #3a81c3; font-weight: bold;">as</span> _e:
    <span style="color: #715ab1;">_r</span> = _e.value <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the RESULT in the simplest case</span>
<span style="color: #3a81c3; font-weight: bold;">else</span>: <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">channel between the caller and the subgenerator</span>
    <span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">1</span>:
        <span style="color: #715ab1;">_s</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span> _y
        <span style="color: #3a81c3; font-weight: bold;">try</span>:
            <span style="color: #715ab1;">_y</span> = _i.send<span style="color: #3a81c3;">(</span>_s<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span> <span style="color: #3a81c3; font-weight: bold;">as</span> _e:
            <span style="color: #715ab1;">_r</span> = _e.value
            <span style="color: #3a81c3; font-weight: bold;">break</span>
<span style="color: #715ab1;">RESULT</span> = _r
</pre>
</div>
<ul class="org-ul">
<li>_i(iterator): The subgenerator</li>
<li>_y(yielded): A value yielded from the subgenerator</li>
<li>_r(result): The eventual result</li>
<li>_s(sent): A value sent by the caller to the delegating generator, which is forwarded to the subgenerator</li>
<li>_e(exception): An exception</li>
</ul>
</div>
</li>

<li><a id="orge017a50"></a>ipython-yf<br />
<div class="outline-text-5" id="text-orge017a50">
<p>
Enables evaluating yield from directly in the <b>iPython</b> console.
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org017e649" class="outline-4">
<h4 id="org017e649"><span class="section-number-4">4.1.7</span> example</h4>
</div>
</div>
<div id="outline-container-org3abcb76" class="outline-3">
<h3 id="org3abcb76"><span class="section-number-3">4.2</span> asyncio</h3>
</div>
</div>
</div>
</body>
</html>

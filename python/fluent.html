<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<!-- 2018-08-16 Thu 10:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fluent Python</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="ChrisChen" />
<meta name="keywords" content="python, fluent" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../styles/demo/css/demo.css"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Fluent Python</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org225f77d">1. Data Model</a>
<ul>
<li><a href="#org5f799bc">1.1. Special Methods</a></li>
<li><a href="#orgfd117bc">1.2. numeric types</a></li>
</ul>
</li>
<li><a href="#orgadb54ee">2. Network&amp;Web</a>
<ul>
<li><a href="#orgc986716">2.1. RESTful API Query</a>
<ul>
<li><a href="#orgefd850f">2.1.1. Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org66d1789">3. Interface</a>
<ul>
<li><a href="#orgbdf4712">3.1. Properties</a></li>
<li><a href="#orge6ce395">3.2. Sequences</a></li>
<li><a href="#org9b0d25b">3.3. Monkey Patching</a></li>
</ul>
</li>
<li><a href="#orge37ab55">4. asyncio</a>
<ul>
<li><a href="#org7c58d62">4.1. coroutine</a>
<ul>
<li><a href="#org67e2f1c">4.1.1. states</a></li>
<li><a href="#orgeeb1444">4.1.2. generator methods</a></li>
<li><a href="#org8ac85cf">4.1.3. auto priming</a></li>
<li><a href="#org2124c0e">4.1.4. Termination &amp; Exception</a></li>
<li><a href="#org832af09">4.1.5. return value</a></li>
<li><a href="#orgdd2326a">4.1.6. <b>yield from</b></a></li>
<li><a href="#orgd1d26ac">4.1.7. example</a></li>
</ul>
</li>
<li><a href="#orgd8f3be9">4.2. asyncio</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org225f77d" class="outline-2">
<h2 id="org225f77d"><span class="section-number-2">1</span> Data Model</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org5f799bc" class="outline-3">
<h3 id="org5f799bc"><span class="section-number-3">1.1</span> Special Methods</h3>
<div class="outline-text-3" id="text-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Category</th>
<th scope="col" class="org-left">Method names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">String/bytes representation</td>
<td class="org-left"><code>__repr__</code> , <code>__str__</code> , <code>__format__</code> , <code>__bytes__</code></td>
</tr>

<tr>
<td class="org-left">Conversion to number</td>
<td class="org-left"><code>__abs__</code>, <code>__bool__</code>, <code>__complex__</code>, <code>__int__</code>, <code>__float__</code>, <code>__hash__</code>, <code>__index__</code></td>
</tr>

<tr>
<td class="org-left">Emulating collections</td>
<td class="org-left"><code>__len__</code>, <code>__getitem__</code>, <code>__setitem__</code>, <code>__delitem__</code>, <code>__contains__</code></td>
</tr>

<tr>
<td class="org-left">Iteration</td>
<td class="org-left"><code>__iter__</code>, <code>__reversed__</code>, <code>__next__</code></td>
</tr>

<tr>
<td class="org-left">Emulating callables</td>
<td class="org-left"><code>__call__</code></td>
</tr>

<tr>
<td class="org-left">Context management</td>
<td class="org-left"><code>__enter__</code>, <code>__exit__</code></td>
</tr>

<tr>
<td class="org-left">Instance creation and destruction</td>
<td class="org-left"><code>__new__</code>, <code>__init__</code>, <code>__del__</code></td>
</tr>

<tr>
<td class="org-left">Attribute management</td>
<td class="org-left"><code>__getattr__</code>, <code>__getattribute__</code>, <code>__setattr__</code>, <code>__delattr__</code>, <code>__dir__</code></td>
</tr>

<tr>
<td class="org-left">Attribute descriptors</td>
<td class="org-left"><code>__get__</code>, <code>__set__</code>, <code>__delete__</code></td>
</tr>

<tr>
<td class="org-left">Class services</td>
<td class="org-left"><code>__prepare__</code>, <code>__instancecheck__</code>, <code>__subclasscheck__</code></td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>operators</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Category</th>
<th scope="col" class="org-left">Method names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Unary numeric operators</td>
<td class="org-left"><code>__neg__ -</code>, <code>__pos__ +</code>, <code>__abs__ abs()</code></td>
</tr>

<tr>
<td class="org-left">Rich comparison operators</td>
<td class="org-left"><code>__lt__ &gt;</code>, <code>__le__ &lt;=</code>, <code>__eq__ ==</code>, <code>__ne__ !=</code>, <code>__gt__ &gt;</code>, <code>__ge__ &gt;=</code></td>
</tr>

<tr>
<td class="org-left">Arithmetic operators</td>
<td class="org-left"><code>__add__ +</code>, <code>__sub__ -</code>, <code>__mul__ =, =__truediv__ /</code>, <code>__floordiv__ //</code>, <code>__mod__\n%</code>, <code>__divmod__ divmod()</code>, <code>__pow__ ** or pow()</code>, <code>__round__ round()</code></td>
</tr>

<tr>
<td class="org-left">Reversed arithmetic operators</td>
<td class="org-left"><code>__radd__</code>, <code>__rsub__</code>, <code>__rmul__</code>, <code>__rtruediv__</code>, <code>__rfloordiv__</code>, <code>__rmod__</code>, <code>__rdivmod__</code>, <code>__rpow__</code></td>
</tr>

<tr>
<td class="org-left">Augmented assignment  arithmetic operators</td>
<td class="org-left"><code>__iadd__</code>, <code>__isub__</code>, <code>__imul__</code>, <code>__itruediv__</code>, <code>__ifloordiv__</code>, <code>__imod__</code>, <code>__ipow__</code></td>
</tr>

<tr>
<td class="org-left">Bitwise operators</td>
<td class="org-left"><code>__invert__ ~</code>, <code>__lshift__ &lt;&lt;</code>, <code>__rshift__ &gt;&gt;</code>, <code>__and__ &amp;</code>, <code>__or__</code>, <code>__xor__ ^</code></td>
</tr>

<tr>
<td class="org-left">Reversed bitwise operators</td>
<td class="org-left"><code>__rlshift__</code>, <code>__rrshift__</code>, <code>__rand__</code>, <code>__rxor__</code>, <code>__ror__</code></td>
</tr>

<tr>
<td class="org-left">Augmented assignment bitwise operators</td>
<td class="org-left"><code>__ilshift__</code>, <code>__irshift__</code>, <code>__iand__</code>, <code>__ixor__</code>, <code>__ior__</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgfd117bc" class="outline-3">
<h3 id="orgfd117bc"><span class="section-number-3">1.2</span> numeric types</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>decimal.Decimal</li>
<li>fractions.Fraction</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgadb54ee" class="outline-2">
<h2 id="orgadb54ee"><span class="section-number-2">2</span> Network&amp;Web</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgc986716" class="outline-3">
<h3 id="orgc986716"><span class="section-number-3">2.1</span> RESTful API Query</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> urllib <span style="color: #3a81c3; font-weight: bold;">import</span> request, parse
<span style="color: #715ab1;">url</span> = <span style="color: #2d9574;">'http://www.123.com/get'</span>
<span style="color: #715ab1;">params</span> = <span style="color: #3a81c3;">{</span>
    <span style="color: #2d9574;">'name1'</span> : <span style="color: #2d9574;">'value1'</span>,
    <span style="color: #2d9574;">'name2'</span> : <span style="color: #2d9574;">'value2'</span>
<span style="color: #3a81c3;">}</span>
<span style="color: #715ab1;">query_string</span> = parse.urlencode<span style="color: #3a81c3;">(</span>params<span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">headers</span>
<span style="color: #715ab1;">headers</span> = <span style="color: #3a81c3;">{</span>
    <span style="color: #2d9574;">'User-agent'</span> : <span style="color: #2d9574;">'none/ofyourbusiness'</span>,
    <span style="color: #2d9574;">'Spam'</span> : <span style="color: #2d9574;">'Eggs'</span>
<span style="color: #3a81c3;">}</span>

<span style="color: #715ab1;">u</span> = request.urlopen<span style="color: #3a81c3;">(</span>url+<span style="color: #2d9574;">'?'</span> + query_string.encode<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'ascii'</span><span style="color: #6c3163;">)</span>, headers=headers<span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">resp</span> = u.read<span style="color: #3a81c3;">()</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">resp.text(unicode),  resp.content(raw binary), resp.json</span>
</pre>
</div>
<ul class="org-ul">
<li>useful resp data
<ul class="org-ul">
<li><code>resp.status_code</code></li>
<li><code>resp.headers['last-modified']</code></li>
<li><code>resp.headers['content-type']</code></li>
<li><code>resp.headers['content-length']</code></li>
</ul></li>

<li>urlopen useful args
<ul class="org-ul">
<li>headers</li>
<li>cookies</li>
<li>files</li>
<li>auth</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgefd850f" class="outline-4">
<h4 id="orgefd850f"><span class="section-number-4">2.1.1</span> Testing</h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>use <a href="http://httpbin.org/">httpbin</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org66d1789" class="outline-2">
<h2 id="org66d1789"><span class="section-number-2">3</span> Interface</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgbdf4712" class="outline-3">
<h3 id="orgbdf4712"><span class="section-number-3">3.1</span> Properties</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">Prop</span>:
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">__init__</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>, x<span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">self</span>.__x = x

    <span style="color: #ba2f59; font-weight: bold;">@property</span>
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">x</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">return</span> <span style="color: #3a81c3; font-weight: bold;">self</span>.__x

    <span style="color: #ba2f59; font-weight: bold;">@x.setter</span>
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">x</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>, value<span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">self</span>.__x = value
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6ce395" class="outline-3">
<h3 id="orge6ce395"><span class="section-number-3">3.2</span> Sequences</h3>
<div class="outline-text-3" id="text-3-2">

<div class="figure">
<p><img src="../resources/python/SeqInterface.png" alt="SeqInterface.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org9b0d25b" class="outline-3">
<h3 id="org9b0d25b"><span class="section-number-3">3.3</span> Monkey Patching</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Changing a class or module at runtime, without touching the source code.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">some_obj.__getitem__</span> = some_get_function<span style="color: #3a81c3;">(</span>some_class, position<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge37ab55" class="outline-2">
<h2 id="orge37ab55"><span class="section-number-2">4</span> asyncio</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org7c58d62" class="outline-3">
<h3 id="org7c58d62"><span class="section-number-3">4.1</span> coroutine</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">simple_coroutine</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'-&gt; coroutine started'</span><span style="color: #3a81c3;">)</span>
    <span style="color: #715ab1;">x</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">received by send(x)</span>
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'-&gt; coroutine received:'</span>, x<span style="color: #3a81c3;">)</span>

<span style="color: #715ab1;">coro</span> = simple_coroutine<span style="color: #3a81c3;">()</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">GEN_CREATED</span>
<span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>coro<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">equivalent to coro.send(None). GEN_CREATED-&gt;GEN_RUNNING-&gt;GEN_SUSPENDED</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">-&gt; coroutine started</span>
coro.send<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">42</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">GEN_SUSPENDED-&gt;GEN_RUNNING-&gt;GEN_CLOSED</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">-&gt; coroutine received: 42</span>
</pre>
</div>
<ul class="org-ul">
<li>next(coro) is often describe as "priming" the coroutine(advancing it to the first yield)</li>
</ul>
</div>

<div id="outline-container-org67e2f1c" class="outline-4">
<h4 id="org67e2f1c"><span class="section-number-4">4.1.1</span> states</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
use <code>inspect.getgeneratorstate()</code> to get state
</p>
<ul class="org-ul">
<li>GEN_CREATED: Waiting to start execution</li>
<li>GEN_RUNNING: Currently being executed by the interpreter</li>
<li>GEN_SUSPENDED: Currently suspended at a yield expression</li>
<li>GEN_CLOSED</li>
</ul>
</div>
</div>

<div id="outline-container-orgeeb1444" class="outline-4">
<h4 id="orgeeb1444"><span class="section-number-4">4.1.2</span> generator methods</h4>
<div class="outline-text-4" id="text-4-1-2">
<ul class="org-ul">
<li>send(value): the caller can post data that then becomes the value of the yield expression inside the generator.</li>
<li>throw(): allow the caller to throw an exception to be handled inside the generator.</li>
<li>close()</li>
</ul>
</div>
</div>

<div id="outline-container-org8ac85cf" class="outline-4">
<h4 id="org8ac85cf"><span class="section-number-4">4.1.3</span> auto priming</h4>
<div class="outline-text-4" id="text-4-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> functools <span style="color: #3a81c3; font-weight: bold;">import</span> wraps
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">coroutine</span><span style="color: #3a81c3;">(</span>func<span style="color: #3a81c3;">)</span>:
    <span style="color: #2d9574;">"""Decorator: primes `func` by advancing to first `yield`"""</span>
    <span style="color: #ba2f59; font-weight: bold;">@wraps</span><span style="color: #3a81c3;">(</span>func<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">primer</span><span style="color: #3a81c3;">(</span>*args,**kwargs<span style="color: #3a81c3;">)</span>:
        <span style="color: #715ab1;">gen</span> = func<span style="color: #3a81c3;">(</span>*args,**kwargs<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>gen<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">return</span> gen
    <span style="color: #3a81c3; font-weight: bold;">return</span> primer

<span style="color: #ba2f59; font-weight: bold;">@coroutine</span>
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">simple_coroutine</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #715ab1;">x</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span>

<span style="color: #715ab1;">coro</span> = simple_coroutine<span style="color: #3a81c3;">()</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">-&gt; GEN_SUSPENDED</span>
</pre>
</div>
<ul class="org-ul">
<li><code>yield from</code> automatically primes the coroutine called by it, making it incompatible with the coroutine decorator above.</li>
<li><code>asyncio.coroutine</code> is designed to work with yield from so it does not prime the coroutine.</li>
</ul>
</div>
</div>

<div id="outline-container-org2124c0e" class="outline-4">
<h4 id="org2124c0e"><span class="section-number-4">4.1.4</span> Termination &amp; Exception</h4>
<div class="outline-text-4" id="text-4-1-4">
</div>
<ul class="org-ul">
<li><a id="org05a4bc4"></a>from generator<br />
<div class="outline-text-5" id="text-org05a4bc4">
<p>
An exception within a coroutine propagates to the caller of the next or send that triggered it.
</p>
</div>
</li>
<li><a id="org6dcd1b2"></a>to generator<br />
<div class="outline-text-5" id="text-org6dcd1b2">
<ul class="org-ul">
<li><code>throw</code>: Causes the yield expression where the generator was paused to raise the exception given.</li>
<li><code>close</code>: Causes the yield expression where the generator was paused to raise a Generator Exit exception.</li>
</ul>
</div>
</li>
<li><a id="org25cc5b6"></a>cleanup code<br />
<div class="outline-text-5" id="text-org25cc5b6">
<p>
wrap the cleanup code in <code>try/finally</code> block
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org832af09" class="outline-4">
<h4 id="org832af09"><span class="section-number-4">4.1.5</span> return value</h4>
<div class="outline-text-4" id="text-4-1-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">Result</span> = namedtuple<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'Result'</span>, <span style="color: #2d9574;">'count average'</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">averager</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #715ab1;">total</span> = <span style="color: #4e3163;">0</span>.<span style="color: #4e3163;">0</span>
    <span style="color: #715ab1;">count</span> = <span style="color: #4e3163;">0</span>
    <span style="color: #715ab1;">average</span> = <span style="color: #4e3163;">None</span>
    <span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">True</span>:
        <span style="color: #715ab1;">term</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">yield None</span>
        <span style="color: #3a81c3; font-weight: bold;">if</span> term <span style="color: #3a81c3; font-weight: bold;">is</span> <span style="color: #4e3163;">None</span>:
            <span style="color: #3a81c3; font-weight: bold;">break</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">use a sentinel to terminate the coroutine normally</span>
        <span style="color: #715ab1;">total</span> += term
        <span style="color: #715ab1;">count</span> += <span style="color: #4e3163;">1</span>
        <span style="color: #715ab1;">average</span> = total/count
    <span style="color: #3a81c3; font-weight: bold;">return</span> Result<span style="color: #3a81c3;">(</span>count, average<span style="color: #3a81c3;">)</span>

<span style="color: #715ab1;">coro_avg</span> = averager<span style="color: #3a81c3;">()</span>
coro_avg.send<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">10</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">try</span>:
    coro_avg.send<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span> <span style="color: #3a81c3; font-weight: bold;">as</span> exc:
    <span style="color: #715ab1;">result</span> = exc.value <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Result(count=3, average=15.5)</span>
</pre>
</div>
<ul class="org-ul">
<li>in order to return a value, a coroutine must terminate normally</li>
</ul>
</div>
</div>

<div id="outline-container-orgdd2326a" class="outline-4">
<h4 id="orgdd2326a"><span class="section-number-4">4.1.6</span> <b>yield from</b></h4>
<div class="outline-text-4" id="text-4-1-6">
<p>
The main feature of <b>yield from</b> is to open a bidirectional channel from the outermost caller to the innermost subgenerator, so that values
can be sent and yielded back and forth directly from them, and exceptions can be thrown all the way in without adding a lot of exception
handling boilerplate code in the intermediate coroutines.
</p>

<ul class="org-ul">
<li>similar constructs in other languages are called <b>await</b></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">gen</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #3a81c3; font-weight: bold;">from</span> <span style="color: #2d9574;">'abc'</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">shortcut for forloop</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">for x in 'abc':</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;">#     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">yield x</span>
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org331d710"></a>terms<br />
<div class="outline-text-5" id="text-org331d710">
<ul class="org-ul">
<li>delegating generator: The generator function that contains the <b>yield from &lt;iterable&gt;</b> expression</li>
<li>subgenerator</li>
<li>caller</li>
</ul>


<div class="figure">
<p><img src="../resources/python/coroutine.png" alt="coroutine.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Coroutine</p>
</div>
</div>
</li>

<li><a id="orgf6d2065"></a>meaning of <b>yield from</b><br />
<div class="outline-text-5" id="text-orgf6d2065">
<ul class="org-ul">
<li>Any values that the subgenerator yields are passed directly to the caller of the delegating generator</li>
<li>Any values sent to the delegating generator using <b>send()</b> are passed directly to the subgenerator.</li>
</ul>
<p>
If the sent value is <b>None</b>, the subgenerator's <b>__next__()</b> method is called. If the sent value is
not <b>None</b>, the subgenerator's <b>send()</b> method is called. If the call raises <b>StopIteration</b>, the delegating
generator is resumed. Any other exception is propagated to the delegating generator.
</p>
<ul class="org-ul">
<li>return expr in a generator (or subgenerator) causes <b>StopIteration(expr)</b> to be raised upon exit from</li>
</ul>
<p>
the generator.
</p>
<ul class="org-ul">
<li>The value of the <b>yield from</b> expression is the first argument to the <b>StopIteration</b> exception raised by</li>
</ul>
<p>
the subgenerator when it terminates.
</p>
</div>
</li>

<li><a id="org57add76"></a>pseudocode<br />
<div class="outline-text-5" id="text-org57add76">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">_i</span> = <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span>EXPR<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">try</span>:
    <span style="color: #715ab1;">_y</span> = <span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>_i<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span> <span style="color: #3a81c3; font-weight: bold;">as</span> _e:
    <span style="color: #715ab1;">_r</span> = _e.value <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the RESULT in the simplest case</span>
<span style="color: #3a81c3; font-weight: bold;">else</span>: <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">channel between the caller and the subgenerator</span>
    <span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">1</span>:
        <span style="color: #715ab1;">_s</span> = <span style="color: #3a81c3; font-weight: bold;">yield</span> _y
        <span style="color: #3a81c3; font-weight: bold;">try</span>:
            <span style="color: #715ab1;">_y</span> = _i.send<span style="color: #3a81c3;">(</span>_s<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span> <span style="color: #3a81c3; font-weight: bold;">as</span> _e:
            <span style="color: #715ab1;">_r</span> = _e.value
            <span style="color: #3a81c3; font-weight: bold;">break</span>
<span style="color: #715ab1;">RESULT</span> = _r
</pre>
</div>
<ul class="org-ul">
<li>_i(iterator): The subgenerator</li>
<li>_y(yielded): A value yielded from the subgenerator</li>
<li>_r(result): The eventual result</li>
<li>_s(sent): A value sent by the caller to the delegating generator, which is forwarded to the subgenerator</li>
<li>_e(exception): An exception</li>
</ul>
</div>
</li>

<li><a id="orga31d5b5"></a>ipython-yf<br />
<div class="outline-text-5" id="text-orga31d5b5">
<p>
Enables evaluating yield from directly in the <b>iPython</b> console.
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgd1d26ac" class="outline-4">
<h4 id="orgd1d26ac"><span class="section-number-4">4.1.7</span> example</h4>
</div>
</div>
<div id="outline-container-orgd8f3be9" class="outline-3">
<h3 id="orgd8f3be9"><span class="section-number-3">4.2</span> asyncio</h3>
</div>
</div>
</div>
</body>
</html>

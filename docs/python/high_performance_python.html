<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<!-- 2021-04-16 Fri 14:50 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>High Performance Python</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="ChrisChen" />
<meta name="keywords" content="python, performance" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
	     margin-bottom: .2em; }
  .subtitle { text-align: center;
	      font-size: medium;
	      font-weight: bold;
	      margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
	    padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
	displayAlign: "left",
	displayIndent: "2em",

	"HTML-CSS": { scale: 100,
			linebreaks: { automatic: "false" },
			webFont: "TeX"
		       },
	SVG: {scale: 100,
	      linebreaks: { automatic: "false" },
	      font: "TeX"},
	NativeMML: {scale: 100},
	TeX: { equationNumbers: {autoNumber: "AMS"},
	       MultLineWidth: "85%",
	       TagSide: "left",
	       TagIndent: ".8em"
	     }
});
</script>
<script type="text/javascript"
	src="https://cdn.bootcdn.net/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">High Performance Python</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5392558">1. Hardware Resources</a>
<ul>
<li><a href="#org2aa7c0b">1.1. Computing Unit</a></li>
<li><a href="#org173eae7">1.2. Memory Unit</a></li>
<li><a href="#orga557b09">1.3. Communications Layers</a></li>
<li><a href="#orge3ba622">1.4. GPU</a></li>
<li><a href="#org2e52313">1.5. Performance Issues of Python</a></li>
</ul>
</li>
<li><a href="#org2fecdba">2. Profiling</a>
<ul>
<li><a href="#orgf85aa16">2.1. Tools</a></li>
<li><a href="#orgecee3e0">2.2. Practical Points</a></li>
</ul>
</li>
<li><a href="#orgef284c6">3. Lists and Tuples</a>
<ul>
<li><a href="#org144986f">3.1. Lists</a></li>
<li><a href="#org15010ea">3.2. Tuples</a></li>
</ul>
</li>
<li><a href="#orgbf88063">4. Dictionaries and Sets</a>
<ul>
<li><a href="#orgef15e16">4.1. Hashable Type</a></li>
<li><a href="#org296677b">4.2. Key to Array Index</a></li>
<li><a href="#org7b2f393">4.3. Dictionary</a></li>
<li><a href="#org551615d">4.4. Namespace Management</a></li>
</ul>
</li>
<li><a href="#orgc3bf9f0">5. Iterators and Generators</a>
<ul>
<li><a href="#orgcda3df8">5.1. Iterator</a></li>
<li><a href="#org701da4f">5.2. Lazy Generator Evaluation</a></li>
<li><a href="#org40a0400">5.3. Useful Itertools</a></li>
</ul>
</li>
<li><a href="#org83a7d8c">6. Vectorization</a></li>
<li><a href="#orgd871692">7. Compiling to C</a>
<ul>
<li><a href="#orgfee8f60">7.1. All Routes</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org5392558" class="outline-2">
<h2 id="org5392558"><span class="section-number-2">1</span> Hardware Resources</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org2aa7c0b" class="outline-3">
<h3 id="org2aa7c0b"><span class="section-number-3">1.1</span> Computing Unit</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The main properties of interest in a computing unit are the number of operations
it can do in one cycle and the number of cycles it can do in one second. The first
value is measured by its instructions per cycle(IPC), while the latter value is
measured by its clock speed.
</p>
<ul class="org-ul">
<li><b>SIMD</b>: Single instruction, multiple data. Efficient with high IPC. (CPU vectorization instruction)</li>
<li><b>Hyperthreading</b> presents a virtual second CPU to the host OS, and clever hardware logic tries</li>
</ul>
<p>
to interleave two threads of instructions into the execution units on a single CPU. When successful,
gains of up to 30% over a single thread can be achieved.
</p>
</div>
</div>

<div id="outline-container-org173eae7" class="outline-3">
<h3 id="org173eae7"><span class="section-number-3">1.2</span> Memory Unit</h3>
<div class="outline-text-3" id="text-1-2">
<p>
When trying to optimize the memory patterns of a program, we are simply optimizing
which data is placed where, how it is laid out (in order to increase the number of
sequential reads), and how many times it is moved among the various locations.
</p>
</div>
</div>

<div id="outline-container-orga557b09" class="outline-3">
<h3 id="orga557b09"><span class="section-number-3">1.3</span> Communications Layers</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>The <i>frontside</i> bus is the connection between the RAM and the L1/L2 cache</li>
<li>Two main properties of a bus:
<ul class="org-ul">
<li>how much data can be moved in one transfer (bus width)</li>
<li>how many transfers the bus can do per second (bus frequency).</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orge3ba622" class="outline-3">
<h3 id="orge3ba622"><span class="section-number-3">1.4</span> GPU</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>Drawbacks: Communicates through the PCI bus, which is much slower than the frontside bus</li>
</ul>
</div>
</div>

<div id="outline-container-org2e52313" class="outline-3">
<h3 id="org2e52313"><span class="section-number-3">1.5</span> Performance Issues of Python</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>Memory Fragmentation: due to garbage-collected</li>
<li>Dynamic Types: Using Cython to mitigate this problem</li>
<li>GIL: Using Cython or foreign functions</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2fecdba" class="outline-2">
<h2 id="org2fecdba"><span class="section-number-2">2</span> Profiling</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgf85aa16" class="outline-3">
<h3 id="orgf85aa16"><span class="section-number-3">2.1</span> Tools</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org4ba26e3" class="outline-4">
<h4 id="org4ba26e3"><span class="section-number-4">2.1.1</span> <code>/usr/bin/time</code></h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>Using <code>--verbose</code> flag to get more details.</li>
<li>Most useful indicator is <code>Major (requiring I/O) page faults</code>, as it indicates cache misses.</li>
</ul>
</div>
</div>
<div id="outline-container-orgcb495e9" class="outline-4">
<h4 id="orgcb495e9"><span class="section-number-4">2.1.2</span> <code>timefn</code> decorator</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">timefn</span><span style="color: #3a81c3;">(</span>fn<span style="color: #3a81c3;">)</span>:
    <span style="color: #ba2f59; font-weight: bold;">@wraps</span><span style="color: #3a81c3;">(</span>fn<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">measure_time</span><span style="color: #3a81c3;">(</span>*args, **kwargs<span style="color: #3a81c3;">)</span>:
	<span style="color: #715ab1;">t1</span> = time.time<span style="color: #3a81c3;">()</span>
	<span style="color: #715ab1;">result</span> = fn<span style="color: #3a81c3;">(</span>*args, **kwargs<span style="color: #3a81c3;">)</span>
	<span style="color: #715ab1;">t2</span> = time.time<span style="color: #3a81c3;">()</span>
	<span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>f<span style="color: #2d9574;">"@timefn: {fn.__name__} took {t2 - t1} seconds"</span><span style="color: #3a81c3;">)</span>
	<span style="color: #3a81c3; font-weight: bold;">return</span> result
    <span style="color: #3a81c3; font-weight: bold;">return</span> measure_time
</pre>
</div>
</div>
</div>

<div id="outline-container-org477c8fe" class="outline-4">
<h4 id="org477c8fe"><span class="section-number-4">2.1.3</span> bulit-in <code>timeit</code> module</h4>
<div class="outline-text-4" id="text-2-1-3">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/timeit.html">Documentation</a></li>
<li>The <code>timeit</code> module temporarily disables the garbage collector.</li>
<li>More useful approach: IPython magic <code>%timeit</code></li>
</ul>
</div>
</div>

<div id="outline-container-org8749aaf" class="outline-4">
<h4 id="org8749aaf"><span class="section-number-4">2.1.4</span> CProfile</h4>
<div class="outline-text-4" id="text-2-1-4">
<div class="org-src-container">
<pre class="src src-sh">python -m cProfile -s cumulative test.py
python -m cProfile -o profile.stats test.py
</pre>
</div>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> pstats
<span style="color: #715ab1;">p</span> = pstats.Stats<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"profile.stats"</span><span style="color: #3a81c3;">)</span>
p.sort_stats<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"cumulative"</span><span style="color: #3a81c3;">)</span>
p.print_stats<span style="color: #3a81c3;">()</span>
p.print_callers<span style="color: #3a81c3;">()</span>
p.print_callees<span style="color: #3a81c3;">()</span>
</pre>
</div>
<ul class="org-ul">
<li><code>snakeviz</code> for visualization</li>
</ul>
</div>
</div>

<div id="outline-container-org3d248d6" class="outline-4">
<h4 id="org3d248d6"><span class="section-number-4">2.1.5</span> <code>line_profiler</code></h4>
<div class="outline-text-4" id="text-2-1-5">
<ol class="org-ol">
<li><code>pip install ~line_profiler~</code></li>
<li>Use <code>@profile</code> to mark the chosen function</li>
<li><code>kernprof -l -v test.py</code></li>
<li>See report: <code>python -m line_profiler test.py.lprof</code></li>
</ol>
</div>
</div>

<div id="outline-container-org9357c8f" class="outline-4">
<h4 id="org9357c8f"><span class="section-number-4">2.1.6</span> <code>memory_profiler</code></h4>
<div class="outline-text-4" id="text-2-1-6">
<ol class="org-ol">
<li><code>pip install psutil</code> (recommended)</li>
<li><code>pip install memory_profiler</code></li>
<li>Use <code>@profile</code> to mark the chosen function</li>
<li><code>python -m memory_profiler test.py</code> or <code>mprof run test.py</code></li>
</ol>

<p>
Other Hints:
</p>
<ul class="org-ul">
<li>using <code>with profile.timestamp("scope1")</code> to add label</li>
<li><code>memory_profiler</code> offers an interesting aid to debugging a large process via the <code>--pdb-mmem=XXX</code> flag</li>
</ul>
</div>
</div>

<div id="outline-container-orgbd76a32" class="outline-4">
<h4 id="orgbd76a32"><span class="section-number-4">2.1.7</span> <code>perf</code></h4>
<div class="outline-text-4" id="text-2-1-7">
<ol class="org-ol">
<li><code>sudo apt install linux-tools-generic</code></li>
<li>Tweeking <code>/proc/sys/kernel/perf_event_paranoid</code> to -1</li>
<li><code>perf stat -e cycles,instructions,cache-references,cache-misses,... python test.py</code></li>
</ol>

<p>
Performance Counter Descriptions:
</p>
<ul class="org-ul">
<li><code>task-clock</code> tells us how many clock cycles our task. (all CPUs)</li>
<li>The difference between <code>instructions</code> and <code>cycles</code> gives us an indication of how well our code is vectorizing and pipelining.</li>
<li><code>cs</code>: context switches</li>
<li><code>migrations</code>: tell us about how the program is halted in order to wait for a kernel operation to finish (such as I/O).</li>
<li><code>migrations</code> happen when the program is halted and resumed on a different CPU than the one it was on before</li>
<li><code>faults</code>: page-fault.</li>
</ul>

<p>
Terms:
</p>

<dl class="org-dl">
<dt><b>Pipelining</b></dt><dd>With pipelining, the CPU is able to run the current operation while fetching and preparing the next one. When memory is allocated, the kernel doesn’t do much except give the program a reference to memory.</dd>
<dt><b>minor page fault interrupt</b></dt><dd>When memory is allocated, the kernel doesn’t do much except give the program a reference to memory. Later, however, when the memory is first used, the operating system throws a minor page fault interrupt, which pauses the program that is being run and properly allocates the memory.</dd>
</dl>
</div>
</div>

<div id="outline-container-org1845549" class="outline-4">
<h4 id="org1845549"><span class="section-number-4">2.1.8</span> ipython magic <code>%memit</code></h4>
<div class="outline-text-4" id="text-2-1-8">
<ul class="org-ul">
<li><code>%load_ext memory_profiler</code></li>
</ul>
</div>
</div>

<div id="outline-container-org76da794" class="outline-4">
<h4 id="org76da794"><span class="section-number-4">2.1.9</span> No-op @profile</h4>
<div class="outline-text-4" id="text-2-1-9">
<p>
Add it to the start of our module while unit testing
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">'line_profiler'</span> <span style="color: #3a81c3; font-weight: bold;">not</span> <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">dir</span><span style="color: #3a81c3;">()</span> <span style="color: #3a81c3; font-weight: bold;">and</span> <span style="color: #2d9574;">'profile'</span> <span style="color: #3a81c3; font-weight: bold;">not</span> <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">dir</span><span style="color: #3a81c3;">()</span>:
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">profile</span><span style="color: #3a81c3;">(</span>func<span style="color: #3a81c3;">)</span>:
	<span style="color: #3a81c3; font-weight: bold;">return</span> func
</pre>
</div>
</div>
</div>

<div id="outline-container-org83aad13" class="outline-4">
<h4 id="org83aad13"><span class="section-number-4">2.1.10</span> Introspecting an Existing Process with <code>PySpy</code></h4>
<div class="outline-text-4" id="text-2-1-10">
<ul class="org-ul">
<li><code>pip install py-spy</code></li>
<li><code>sudo py-spy top --pid 2046</code>: top-like view.</li>
<li><code>py-spy record -o profile.svg python test.py</code></li>
</ul>
</div>
</div>

<div id="outline-container-org38d52cd" class="outline-4">
<h4 id="org38d52cd"><span class="section-number-4">2.1.11</span> Bytecode: <code>dis</code> module</h4>
<div class="outline-text-4" id="text-2-1-11">
<p>
<code>dis.dis(func)</code>
</p>
</div>
</div>
<div id="outline-container-org60677d5" class="outline-4">
<h4 id="org60677d5"><span class="section-number-4">2.1.12</span> For Web Servers</h4>
<div class="outline-text-4" id="text-2-1-12">
<ul class="org-ul">
<li><code>dowser</code></li>
<li><code>dozer</code></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgecee3e0" class="outline-3">
<h3 id="orgecee3e0"><span class="section-number-3">2.2</span> Practical Points</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>Disable Turbo Boost in the BIOS.</li>
<li>Disable the operating system’s ability to override the SpeedStep(in BIOS).</li>
<li>Use only AC power (never battery power).</li>
<li>Disable background tools like backups and Dropbox while running experiments.</li>
<li>Run the experiments many times to obtain a stable measurement.</li>
<li>Possibly drop to run level 1 (Unix) so that no other tasks are running.</li>
<li>Reboot and rerun the experiments to double-confirm the results.</li>
<li>Unit testing a complicated section of code that generates a large numerical output may be</li>
</ul>
<p>
difficult. Do not be afraid to output a text file of results to run through <code>diff</code> or to use
a pickled object.
</p>
</div>
</div>
</div>

<div id="outline-container-orgef284c6" class="outline-2">
<h2 id="orgef284c6"><span class="section-number-2">3</span> Lists and Tuples</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>Python array stores data in buckets by reference, opposed to numpy arrays.</li>
</ul>
</div>

<div id="outline-container-org144986f" class="outline-3">
<h3 id="org144986f"><span class="section-number-3">3.1</span> Lists</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>lists also store how large they are, so of the six allocated blocks, only five are usable.</li>
<li><code>bisect</code> gives easy methods to add elements into a list while maintaining its sorting</li>
<li>List pre-allocation equation in Python 3.7: <code>M = (N &gt;&gt; 3) + (3 if N &lt; 9 else 6)</code></li>
</ul>
</div>

<div id="outline-container-orgb244948" class="outline-4">
<h4 id="orgb244948"><span class="section-number-4">3.1.1</span> Bulit-in Tim Sort</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Python lists have a built-in sorting algorithm that uses <b>Tim sort</b>.
O(n) in the best case, <code>O(n log n)</code> in the worst case. It hybridizes
insertion and merge sort algorithms.
</p>
</div>
</div>
</div>

<div id="outline-container-org15010ea" class="outline-3">
<h3 id="org15010ea"><span class="section-number-3">3.2</span> Tuples</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Python process will have some extra memory overhead for resource caching.
For tuples of sizes 1–20, however, when they are no longer in use, the space isn't
immediately given back to the system, which reduced system calls for memory allocation.
</p>
<div class="org-src-container">
<pre class="src src-text">In [1]: %timeit l = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
62 ns &#177; 0.714 ns per loop (mean &#177; std. dev. of 7 runs, 10000000 loops each)

In [2]: %timeit t = (0, 1, 2, 3, 4, 5, 6, 7, 8, 9)
9.41 ns &#177; 0.113 ns per loop (mean &#177; std. dev. of 7 runs, 100000000 loops each)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbf88063" class="outline-2">
<h2 id="orgbf88063"><span class="section-number-2">4</span> Dictionaries and Sets</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgef15e16" class="outline-3">
<h3 id="orgef15e16"><span class="section-number-3">4.1</span> Hashable Type</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>should implement <code>__hash__</code>, <code>__eq__</code>, <code>__cmp_-</code></li>
<li>User-defined classes have default hash and comparison functions using the object's placement in memory.(given by <code>id</code> function)</li>
</ul>
</div>
</div>

<div id="outline-container-org296677b" class="outline-3">
<h3 id="org296677b"><span class="section-number-3">4.2</span> Key to Array Index</h3>
<div class="outline-text-3" id="text-4-2">
<ol class="org-ol">
<li><b>hashing</b>: turn key into an integer number</li>
<li><b>masking</b>: fits the allocated number of buckets</li>
<li>Using <b>probing</b> to find a new place if collision happens</li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">pseudocode of finding index</span>
<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">index_sequence</span><span style="color: #3a81c3;">(</span>key, mask=0b111, PERTURB_SHIFT=5<span style="color: #3a81c3;">)</span>:
    <span style="color: #715ab1;">perturb</span> = <span style="color: #3a81c3;">hash</span><span style="color: #3a81c3;">(</span>key<span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">hashing</span>
    <span style="color: #715ab1;">i</span> = perturb &amp; mask  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">masking</span>
    <span style="color: #3a81c3; font-weight: bold;">yield</span> i
    <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">probing</span>
    <span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">True</span>:
	<span style="color: #715ab1;">perturb</span> &gt;&gt;= PERTURB_SHIFT  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">use high-order bits</span>
	<span style="color: #715ab1;">i</span> = <span style="color: #3a81c3;">(</span>i * 5 + perturb + 1<span style="color: #3a81c3;">)</span> &amp; mask  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">simple linear function and masking again</span>
	<span style="color: #3a81c3; font-weight: bold;">yield</span> i
</pre>
</div>
</div>

<div id="outline-container-orgcfea5ff" class="outline-4">
<h4 id="orgcfea5ff"><span class="section-number-4">4.2.1</span> Finding a Element</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
If we hit an empty bucket, we can conclude that the data does not exist in the table.
</p>
</div>
</div>

<div id="outline-container-org6834a69" class="outline-4">
<h4 id="org6834a69"><span class="section-number-4">4.2.2</span> Deleting a Element</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
We will write a special value that signifies that the bucket is empty, but there still
may be values after it to consider when resolving a hash collision. These empty slots can
be written to in the future and are removed when the hash table is resized.
</p>
</div>
</div>

<div id="outline-container-orgee1a520" class="outline-4">
<h4 id="orgee1a520"><span class="section-number-4">4.2.3</span> Entropy of a Hash Function</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
\[S = -\sum_i p(i)\cdot\log(p(i))\]
</p>
<ul class="org-ul">
<li>\(p(i)\) is the probability that the hash function gives hash i</li>
<li>It is maximized when every hash value has equal probability of being chosen</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> math
<span style="color: #715ab1;">p1</span> = <span style="color: #3a81c3;">[</span>0.25, 0.25, 0.25, 0.25<span style="color: #3a81c3;">]</span>
-<span style="color: #3a81c3;">sum</span><span style="color: #3a81c3;">(</span>i * math.log<span style="color: #6c3163;">(</span>i<span style="color: #6c3163;">)</span> <span style="color: #3a81c3; font-weight: bold;">for</span> i <span style="color: #3a81c3; font-weight: bold;">in</span> p1<span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1.3862943611198906</span>

<span style="color: #715ab1;">p2</span> = <span style="color: #3a81c3;">[</span>0.1, 0.3, 0.5, 0.1<span style="color: #3a81c3;">]</span>
-<span style="color: #3a81c3;">sum</span><span style="color: #3a81c3;">(</span>i * math.log<span style="color: #6c3163;">(</span>i<span style="color: #6c3163;">)</span> <span style="color: #3a81c3; font-weight: bold;">for</span> i <span style="color: #3a81c3; font-weight: bold;">in</span> p2<span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1.1682824501765625</span>
</pre>
</div>
<ul class="org-ul">
<li>Knowing up front <b>what range of values will be used</b> and <b>how large the dictionary will be</b> helps in making a good selection</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org7b2f393" class="outline-3">
<h3 id="org7b2f393"><span class="section-number-3">4.3</span> Dictionary</h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li>Optimization: Python first appends the key/value data into a standard array and</li>
</ul>
<p>
then stores only the index into this array in the hash table. The array also helps
keep the insertion order of items.
</p>
<ul class="org-ul">
<li>How well distributed the data is throughout the hash table is called the <b>load factor</b> and is related to the <b>entropy</b> of the hash function</li>
<li>By default, the smallest size of a dictionary or set is 8, and it will resize by 3x if the dictionary is more than two-thirds full. (possible sizes: 8-&gt;18-&gt;39-&gt;81-&gt;165-&gt;&#x2026;)</li>
</ul>
</div>
</div>

<div id="outline-container-org551615d" class="outline-3">
<h3 id="org551615d"><span class="section-number-3">4.4</span> Namespace Management</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li><b>Namespace Management</b> heavily uses dictionaries to do its lookups.</li>
</ul>

<p>
The steps to look for a variable/function/module
</p>

<ol class="org-ol">
<li>Searching <code>locals()</code>: which has entries for all local variables, and this is the only part of the chain that doesn't require a dictionary lookup</li>
<li>Searching <code>globals()</code></li>
<li>Searching <code>__builtin__</code> objects: <code>__builtin__</code> is technically a module object</li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> math


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">test1</span><span style="color: #3a81c3;">(</span>x<span style="color: #3a81c3;">)</span>:
    <span style="color: #da8b55;">"""</span>
<span style="color: #da8b55;">    &gt;&gt;&gt; %timeit test1(123456)</span>
<span style="color: #da8b55;">    94 &#181;s &#177; 387 ns per loop (mean &#177; std. dev. of 7 runs, 10000 loops each)</span>

<span style="color: #da8b55;">    18 LOAD_GLOBAL              1 (math)</span>
<span style="color: #da8b55;">    20 LOAD_METHOD              2 (sin)</span>
<span style="color: #da8b55;">    22 LOAD_FAST                0 (x)</span>
<span style="color: #da8b55;">    24 CALL_METHOD              1</span>

<span style="color: #da8b55;">    """</span>
    <span style="color: #715ab1;">res</span> = 1
    <span style="color: #3a81c3; font-weight: bold;">for</span> _ <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">range</span><span style="color: #3a81c3;">(</span>1000<span style="color: #3a81c3;">)</span>:
	<span style="color: #715ab1;">res</span> += math.sin<span style="color: #3a81c3;">(</span>x<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">return</span> res


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">test2</span><span style="color: #3a81c3;">(</span>x<span style="color: #3a81c3;">)</span>:
    <span style="color: #da8b55;">"""</span>
<span style="color: #da8b55;">    &gt;&gt;&gt; %timeit test2(123456)</span>
<span style="color: #da8b55;">    72.5 &#181;s &#177; 2.66 &#181;s per loop (mean &#177; std. dev. of 7 runs, 10000 loops each)</span>

<span style="color: #da8b55;">    22 LOAD_FAST                2 (res)</span>
<span style="color: #da8b55;">    24 LOAD_FAST                1 (sin)</span>
<span style="color: #da8b55;">    26 LOAD_FAST                0 (x)</span>
<span style="color: #da8b55;">    28 CALL_FUNCTION            1</span>

<span style="color: #da8b55;">    """</span>
    <span style="color: #715ab1;">sin</span> = math.sin
    <span style="color: #715ab1;">res</span> = 1
    <span style="color: #3a81c3; font-weight: bold;">for</span> _ <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">range</span><span style="color: #3a81c3;">(</span>1000<span style="color: #3a81c3;">)</span>:
	<span style="color: #715ab1;">res</span> += sin<span style="color: #3a81c3;">(</span>x<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">return</span> res
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc3bf9f0" class="outline-2">
<h2 id="orgc3bf9f0"><span class="section-number-2">5</span> Iterators and Generators</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgcda3df8" class="outline-3">
<h3 id="orgcda3df8"><span class="section-number-3">5.1</span> Iterator</h3>
<div class="outline-text-3" id="text-5-1">
<ol class="org-ol">
<li>first, get an iterator through <code>iter(iterable)</code></li>
<li>call <code>iterator.next()</code> to get new values until a <code>StopIteration</code> is raised.</li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">The Python loop</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> i <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">object</span>:
    do_work<span style="color: #3a81c3;">(</span>i<span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Is equivalent to</span>
<span style="color: #715ab1;">object_iterator</span> = <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">object</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">True</span>:
    <span style="color: #3a81c3; font-weight: bold;">try</span>:
	<span style="color: #715ab1;">i</span> = <span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>object_iterator<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span>:
	<span style="color: #3a81c3; font-weight: bold;">break</span>
    <span style="color: #3a81c3; font-weight: bold;">else</span>:
	do_work<span style="color: #3a81c3;">(</span>i<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org701da4f" class="outline-3">
<h3 id="org701da4f"><span class="section-number-3">5.2</span> Lazy Generator Evaluation</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> datetime <span style="color: #3a81c3; font-weight: bold;">import</span> datetime
<span style="color: #3a81c3; font-weight: bold;">from</span> itertools <span style="color: #3a81c3; font-weight: bold;">import</span> count, filterfalse, groupby, islice
<span style="color: #3a81c3; font-weight: bold;">from</span> random <span style="color: #3a81c3; font-weight: bold;">import</span> normalvariate, randint
<span style="color: #3a81c3; font-weight: bold;">from</span> typing <span style="color: #3a81c3; font-weight: bold;">import</span> Generator, Iterable, List, Tuple

<span style="color: #3a81c3; font-weight: bold;">from</span> scipy.stats <span style="color: #3a81c3; font-weight: bold;">import</span> normaltest

<span style="color: #715ab1;">_ENTRY_TYPE</span> = Tuple<span style="color: #3a81c3;">[</span>datetime, <span style="color: #3a81c3;">int</span><span style="color: #3a81c3;">]</span>


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">read_fake_data</span><span style="color: #3a81c3;">(</span>filename: <span style="color: #3a81c3;">str</span> = <span style="color: #2d9574;">"fake"</span><span style="color: #3a81c3;">)</span> -&gt; Generator<span style="color: #3a81c3;">[</span>_ENTRY_TYPE, <span style="color: #4e3163;">None</span>, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">]</span>:
    <span style="color: #3a81c3; font-weight: bold;">for</span> timestamp <span style="color: #3a81c3; font-weight: bold;">in</span> count<span style="color: #3a81c3;">()</span>:
	<span style="color: #3a81c3; font-weight: bold;">if</span> randint<span style="color: #3a81c3;">(</span>0, 7 * 60 * 60 * 24 - 1<span style="color: #3a81c3;">)</span> == 1:
	    <span style="color: #715ab1;">value</span> = normalvariate<span style="color: #3a81c3;">(</span>0, 1<span style="color: #3a81c3;">)</span>
	<span style="color: #3a81c3; font-weight: bold;">else</span>:
	    <span style="color: #715ab1;">value</span> = 100
	    <span style="color: #3a81c3; font-weight: bold;">yield</span> datetime.fromtimestamp<span style="color: #3a81c3;">(</span>timestamp<span style="color: #3a81c3;">)</span>, value


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">groupby_day</span><span style="color: #3a81c3;">(</span>iterable: Iterable<span style="color: #6c3163;">[</span>_ENTRY_TYPE<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span> -&gt; Generator<span style="color: #3a81c3;">[</span>List<span style="color: #6c3163;">[</span>_ENTRY_TYPE<span style="color: #6c3163;">]</span>, <span style="color: #4e3163;">None</span>, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">]</span>:
    <span style="color: #3a81c3; font-weight: bold;">for</span> day, data_group <span style="color: #3a81c3; font-weight: bold;">in</span> groupby<span style="color: #3a81c3;">(</span>iterable, <span style="color: #3a81c3; font-weight: bold;">lambda</span> row: row<span style="color: #6c3163;">[</span>0<span style="color: #6c3163;">]</span>.day<span style="color: #3a81c3;">)</span>:
	<span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #3a81c3;">list</span><span style="color: #3a81c3;">(</span>data_group<span style="color: #3a81c3;">)</span>


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">is_normal</span><span style="color: #3a81c3;">(</span>data: List<span style="color: #6c3163;">[</span>_ENTRY_TYPE<span style="color: #6c3163;">]</span>, threshold: <span style="color: #3a81c3;">float</span> = 1e-3<span style="color: #3a81c3;">)</span> -&gt; <span style="color: #3a81c3;">bool</span>:
    <span style="color: #715ab1;">_</span>, <span style="color: #715ab1;">values</span> = <span style="color: #3a81c3;">zip</span><span style="color: #3a81c3;">(</span>*data<span style="color: #3a81c3;">)</span>
    <span style="color: #715ab1;">k2</span>, <span style="color: #715ab1;">p_value</span> = normaltest<span style="color: #3a81c3;">(</span>values<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">if</span> p_value &lt; threshold:
	<span style="color: #3a81c3; font-weight: bold;">return</span> <span style="color: #4e3163;">False</span>
    <span style="color: #3a81c3; font-weight: bold;">return</span> <span style="color: #4e3163;">True</span>


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">filter_anomalous_groups</span><span style="color: #3a81c3;">(</span>
    data: Iterable<span style="color: #6c3163;">[</span>_ENTRY_TYPE<span style="color: #6c3163;">]</span>,
<span style="color: #3a81c3;">)</span> -&gt; Generator<span style="color: #3a81c3;">[</span>List<span style="color: #6c3163;">[</span>_ENTRY_TYPE<span style="color: #6c3163;">]</span>, <span style="color: #4e3163;">None</span>, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">]</span>:
    <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #3a81c3; font-weight: bold;">from</span> filterfalse<span style="color: #3a81c3;">(</span>is_normal, data<span style="color: #3a81c3;">)</span>


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">filter_anomalous_data</span><span style="color: #3a81c3;">(</span>data: Iterable<span style="color: #6c3163;">[</span>_ENTRY_TYPE<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span> -&gt; Generator<span style="color: #3a81c3;">[</span>List<span style="color: #6c3163;">[</span>_ENTRY_TYPE<span style="color: #6c3163;">]</span>, <span style="color: #4e3163;">None</span>, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">]</span>:
    <span style="color: #715ab1;">data_group</span> = groupby_day<span style="color: #3a81c3;">(</span>data<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #3a81c3; font-weight: bold;">from</span> filter_anomalous_groups<span style="color: #3a81c3;">(</span>data_group<span style="color: #3a81c3;">)</span>


<span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #3a81c3;">__name__</span> == <span style="color: #2d9574;">"__main__"</span>:
    <span style="color: #715ab1;">data</span> = read_fake_data<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"fake"</span><span style="color: #3a81c3;">)</span>
    <span style="color: #715ab1;">anomaly_generator</span> = filter_anomalous_data<span style="color: #3a81c3;">(</span>data<span style="color: #3a81c3;">)</span>
    <span style="color: #715ab1;">first_five_anomalies</span> = islice<span style="color: #3a81c3;">(</span>anomaly_generator, 5<span style="color: #3a81c3;">)</span>

    <span style="color: #3a81c3; font-weight: bold;">for</span> data_anomaly <span style="color: #3a81c3; font-weight: bold;">in</span> first_five_anomalies:
	<span style="color: #715ab1;">start_date</span> = data_anomaly<span style="color: #3a81c3;">[</span>0<span style="color: #3a81c3;">][</span>0<span style="color: #3a81c3;">]</span>
	<span style="color: #715ab1;">end_date</span> = data_anomaly<span style="color: #3a81c3;">[</span>-1<span style="color: #3a81c3;">][</span>0<span style="color: #3a81c3;">]</span>
	<span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>f<span style="color: #2d9574;">"Anomaly from {start_date} - {end_date}"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org40a0400" class="outline-3">
<h3 id="org40a0400"><span class="section-number-3">5.3</span> Useful Itertools</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li><code>cycle</code>, <code>repeat</code>, <code>chain</code>, <code>groupby</code>, <code>islice</code></li>
<li><code>compress</code>: like boolean-index in pandas</li>
<li><code>accumulate</code>: reduce though summation</li>
<li><code>takewhile</code>, <code>dropwhile</code>: add a condition that will end a generator.</li>
<li><code>starmap</code>: Used instead of <code>map()</code> when argument parameters are already grouped in tuples from a single iterable</li>
<li><code>tee(iterable, n)</code>: Return n independent iterators from a single iterable. Useful for splitting one generator into n generators.</li>
<li><code>zip_longest</code>: <code>zip_longest('ABCD', 'xy', fillvalue='-') --&gt; Ax By C- D-</code></li>
<li>Combinatoric iterators: <code>product</code> (cartesian product), <code>permutations</code>, <code>combinations</code></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org83a7d8c" class="outline-2">
<h2 id="org83a7d8c"><span class="section-number-2">6</span> Vectorization</h2>
<div class="outline-text-2" id="text-6">
<p>
Vectorization is the process of converting an algorithm from operating on a single value at a time to
operating on a set of values at one time. Modern CPUs provide direct support for vector operations where
a single instruction is applied to multiple data(SIMD). Python doesn't natively support vectorization for
two reasons:
</p>
<ul class="org-ul">
<li>Python lists store pointers to the actual data.</li>
<li>Python bytecode is not optimized for vectorization.</li>
</ul>
</div>
</div>

<div id="outline-container-orgd871692" class="outline-2">
<h2 id="orgd871692"><span class="section-number-2">7</span> Compiling to C</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgfee8f60" class="outline-3">
<h3 id="orgfee8f60"><span class="section-number-3">7.1</span> All Routes</h3>
<div class="outline-text-3" id="text-7-1">
<ul class="org-ul">
<li>C-based compiling: Cython</li>
<li>LLVM-based compiling: Numba</li>
<li>just-in-time compiler: PyPy</li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>

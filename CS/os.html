<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Operating Systems</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Operating Systems"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-05-04T14:00+0800"/>
<meta name="author" content="ChrisChen"/>
<meta name="description" content=""/>
<meta name="keywords" content="OS"/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="../css/stylesheet.css" type="text/css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js">
/**
 *
 * @source: http://cdn.mathjax.org/mathjax/latest/MathJax.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in http://cdn.mathjax.org/mathjax/latest/MathJax.js.
 *
 * Copyright (C) 2012-2013  MathJax
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in http://cdn.mathjax.org/mathjax/latest/MathJax.js.
 *
 */

/*
@licstart  The following is the entire license notice for the
JavaScript code below.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code below is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code below.
*/
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "left",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:100%;white-space:nowrap;">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div>


<div id="content">
<h1 class="title">Operating Systems</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Represeting Infomation</a>
<ul>
<li><a href="#sec-1-1">1.1 Integer</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1 Integer Limits</a></li>
<li><a href="#sec-1-1-2">1.1.2 Binary2Integer</a></li>
<li><a href="#sec-1-1-3">1.1.3 Transform between signed and unsigned</a></li>
<li><a href="#sec-1-1-4">1.1.4 Summary</a></li>
<li><a href="#sec-1-1-5">1.1.5 Extension</a></li>
</ul>
</li>
<li><a href="#sec-1-2">1.2 Floating Point</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1 Fractional Binary Numbers</a></li>
<li><a href="#sec-1-2-2">1.2.2 IEEE Floating-Point</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-2">2 Manipulating Infomation</a>
<ul>
<li><a href="#sec-2-1">2.1 Integer arithmatic</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1 Unsigned Addition</a></li>
<li><a href="#sec-2-1-2">2.1.2 Unsigned Negation</a></li>
<li><a href="#sec-2-1-3">2.1.3 Two's Complement Addition</a></li>
<li><a href="#sec-2-1-4">2.1.4 Two's Complement Negation</a></li>
<li><a href="#sec-2-1-5">2.1.5 Unsigned Mutliplication</a></li>
<li><a href="#sec-2-1-6">2.1.6 Two's Complement Multiplication</a></li>
<li><a href="#sec-2-1-7">2.1.7 Reduce Mutiplication by shift and addition</a></li>
<li><a href="#sec-2-1-8">2.1.8 Reduce Division by shift</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2 Floating Operation</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1 Round</a></li>
<li><a href="#sec-2-2-2">2.2.2 Arithmatic Operation</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3">3 Program Structure</a>
<ul>
<li><a href="#sec-3-1">3.1 Data Formats</a></li>
<li><a href="#sec-3-2">3.2 Interger Registers</a></li>
<li><a href="#sec-3-3">3.3 Accessing Information</a></li>
<li><a href="#sec-3-4">3.4 Basic Operations</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1 Data Movement</a></li>
<li><a href="#sec-3-4-2">3.4.2 Arithmetic &amp; Logical Operations</a></li>
<li><a href="#sec-3-4-3">3.4.3 About xorl x, x</a></li>
<li><a href="#sec-3-4-4">3.4.4 Special Arithmetic Operations</a></li>
</ul>
</li>
<li><a href="#sec-3-5">3.5 Control</a>
<ul>
<li><a href="#sec-3-5-1">3.5.1 Condiction Register</a></li>
<li><a href="#sec-3-5-2">3.5.2 Accessing the Condition Codes</a></li>
<li><a href="#sec-3-5-3">3.5.3 Jump Instruction</a></li>
<li><a href="#sec-3-5-4">3.5.4 If Statement</a></li>
<li><a href="#sec-3-5-5">3.5.5 Loops</a></li>
<li><a href="#sec-3-5-6">3.5.6 Conditional Move Instructions</a></li>
<li><a href="#sec-3-5-7">3.5.7 Switch Statement</a></li>
</ul>
</li>
<li><a href="#sec-3-6">3.6 Procedure</a>
<ul>
<li><a href="#sec-3-6-1">3.6.1 Stack Frame</a></li>
<li><a href="#sec-3-6-2">3.6.2 Procedure Call</a></li>
<li><a href="#sec-3-6-3">3.6.3 Registers</a></li>
<li><a href="#sec-3-6-4">3.6.4 Example</a></li>
</ul>
</li>
<li><a href="#sec-3-7">3.7 Array Allocation</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Represeting Infomation</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Integer</h3>
<div class="outline-text-3" id="text-1-1">


</div>

<div id="outline-container-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Integer Limits</h4>
<div class="outline-text-4" id="text-1-1-1">


$$TMax_w = 2^{w-1}-1\quad TMin_w = - 2^{w-1}\quad UMax_w = 2^w-1\quad UMin_w = 0$$
</div>

</div>

<div id="outline-container-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> Binary2Integer</h4>
<div class="outline-text-4" id="text-1-1-2">


$$B2U_w(\overrightarrow{x})\doteq\sum_{i=0}^{w-1}x_i2^i$$
<ul>
<li id="sec-1-1-2-1">Twos' Complement<br/>
$$B2T_w(\overrightarrow{x})\doteq-x_{w-1}2^{w-1}+\sum_{i=0}^{w-2}x_i2^i$$
</li>
</ul>
<ul>
<li id="sec-1-1-2-1">extension<br/>
<ul>
<li id="sec-1-1-2-1-1">Ones' Complement<br/>
$$B2O_w(\overrightarrow{x})\doteq-x_{w-1}(2^{w-1}-1)+\sum_{i=0}^{w-2}x_i2^i$$
</li>
</ul>
<ul>
<li id="sec-1-1-2-1-2">Sign-Magnitude<br/>
$$B2S_w(\overrightarrow{x})\doteq(-1)^{x_{w-1}}\cdot(\sum_{i=0}^{w-2}x_i2^i)$$
</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> Transform between signed and unsigned</h4>
<div class="outline-text-4" id="text-1-1-3">

<ul>
<li id="sec-1-1-3-1">\(T2U_w(x)\)<br/>
$$B2U_w(\overrightarrow{x})-B2T_w(\overrightarrow{x})=x_{w-1}(2^{w-1}--2^{w-1})=x_{w-1}2^w$$
Let \(\overrightarrow{x}=T2B_w(x)\) , Then：
$$B2U_w(T2B_w(x)) = x_{w-1}2^w + B2T_w(T2B_w(x)) = x_{w-1}2^w + x=T2U_w(x)$$
bit \(x_{w-1}\) is the sign bit, giving:
\[ T2U_w(x) = \left\{ 
  \begin{array}{l l}
    x+2^w & \quad x<0\\
    x & \quad x\geq0
  \end{array} \right.\]
</li>
</ul>
<ul>
<li id="sec-1-1-3-2">\(U2T_w(x)\)<br/>
$$U2T_w(u)=B2T_w(U2B_w(u))=-u_{w-1}2^w+u$$
\[ U2T_w(u) = \left\{
  \begin{array}{l l}
    u & \quad u<2^{w-1}\\
    u - 2^w & \quad u\ge2^{w-1}
   \end{array} \right.\]
</li>
</ul>
<ul>
<li id="sec-1-1-3-3">Use in C<br/>
<ul>
<li id="sec-1-1-3-3-1">Small size to big size<br/>
<ul>
<li>unsigned:  zero extension(add zero on the left side)
</li>
<li>signed:  sign extension(add sign value on the left side)
  $$B2T_{w+1}([x_{w-1},x_{w-1},x_{w-2},\cdots,x_0])=-x_{w-1}2^w+\sum_{i=0}^{w-1}x_i2^i$$
  $$=-x_{w-1}2^{w-1}+\sum_{i=0}^{w-2}x_i2^i$$
  $$=B2T_w([x_{w-1},x_{w-2},\cdots,x_0])$$
</li>
</ul>

</li>
</ul>
<ul>
<li id="sec-1-1-3-3-2">Convert from short 2 unsigned int<br/>
<ol>
<li>Change the size
</li>
<li>Convert from signed to unsigned
</li>
</ol>

</li>
</ul>
<ul>
<li id="sec-1-1-3-3-3">Big size to small size<br/>
Truncate high bits by mod \(2^k\)
$$B2U_w([x_{w-1},x_{w-2},\cdots,x_0])\mod 2^k=[\sum_{i=0}^{w-1}x_i2^i]\mod 2^k$$
$$=[\sum_{i=0}^{k-1}x_i2^i] \mod 2^k = \sum_{i=0}^{k-1}x_i2^i$$
$$= B2U_k([x_{k-1},x_{k-2},\cdots,x_0])$$
Note that: 
<ol>
<li>\(2^i \mod 2^k = 0 \text{ for any }i \ge k\)
</li>
<li>\(\sum_{i=0}^{k-1}x_i2^i\le\sum_{i=0}^{k-1}2^i=2^k-1&lt;2^k\)
</li>
</ol>


<p>
For two's-complement numbers:
$$B2T_k([x_{k-1}, x_{k-2}, \cdots, x_0])=U2T_k(B2U_w([x_{w-1},x_{w-2},\cdots,x_0])\mod 2^k)$$
</p></li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-1-1-4" class="outline-4">
<h4 id="sec-1-1-4"><span class="section-number-4">1.1.4</span> Summary</h4>
<div class="outline-text-4" id="text-1-1-4">

<ul>
<li>$$B2U_w(\overrightarrow{x})\doteq\sum_{i=0}^{w-1}x_i2^i$$
</li>
<li>$$B2T_w(\overrightarrow{x})\doteq-x_{w-1}2^{w-1}+\sum_{i=0}^{w-2}x_i2^i$$
</li>
<li>\[ T2U_w(x) = \left\{ 
  \begin{array}{l l}
    x+2^w & \quad x<0\\
    x & \quad x\geq0
  \end{array} \right.\]
</li>
<li>\[ U2T_w(u) = \left\{
  \begin{array}{l l}
    u & \quad u<2^{w-1}\\
    u - 2^w & \quad u\ge2^{w-1}
   \end{array} \right.\]
</li>
<li>Unsigned big2small：\(B2U_k([x_{k-1},x_{k-2},\cdots,x_0])=B2U_w([x_{w-1},x_{w-2},\cdots,x_0])\mod 2^k\)
</li>
<li>Signed big2small：\(B2T_k([x_{k-1}, x_{k-2}, \cdots, x_0])=U2T_k(B2U_k([x_{k-1},x_{k-2},\cdots,x_0])\)
</li>
</ul>

</div>

</div>

<div id="outline-container-1-1-5" class="outline-4">
<h4 id="sec-1-1-5"><span class="section-number-4">1.1.5</span> Extension</h4>
<div class="outline-text-4" id="text-1-1-5">

<p>Consider following code:
</p>


<pre class="src src-c"><span style="color: #daa520;">short</span> <span style="color: #008b8b;">sx</span> = -12345;
<span style="color: #daa520;">unsigned</span> <span style="color: #daa520;">int</span> <span style="color: #008b8b;">uy</span> = sx;<span style="color: #8b8989;">//</span><span style="color: #8b8989;">unknow result</span>
</pre>

<p>
C standards: 
</p><ol>
<li>Change the size, short 2 int
</li>
<li>signed 2 unsigned
</li>
</ol>

</div>
</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Floating Point</h3>
<div class="outline-text-3" id="text-1-2">


</div>

<div id="outline-container-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Fractional Binary Numbers</h4>
<div class="outline-text-4" id="text-1-2-1">

<ul>
<li>Fractional Decimal
</li>
</ul>


$$d=\sum_{i=-n}^m10^i\times{d_i}$$
<p>
Consider Fractional decimal \(12.34_{10}\)
$$ 1\times{10^1} + 2\times{10^0} + 3\times{10^{-1}} + 4\times{10^{-2}}=12\frac{34}{100}$$
</p><ul>
<li>Fractional Binary
</li>
</ul>


$$b=\sum_{i=-n}^m2^i\times{b_i}$$
<p>
eg:  \(101.11_2\)
$$ 1\times{2^2} + 0\times{2^1} + 1\times{2^0} + 1\times{2^{-1}} + 1\times{2^{-2}} = 5\frac{3}{4}$$
</p></div>

</div>

<div id="outline-container-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> IEEE Floating-Point</h4>
<div class="outline-text-4" id="text-1-2-2">


$$V=(-1)^{s}\times{M}\times{2^E}$$
<ul>
<li>sign s: negative(s=1) positive(s=0)
</li>
<li>significand M: a fractional binary number
</li>
<li>exponent E: weights the value by a power of 2
</li>
</ul>


<p class="verse">
Three fields represent: 1-bit s, k-bit exp(encode E), n-bit frac(encode M) <br/>
Using in C:<br/>
float(single-precision) s=1, k=8, n=23 yielding a 32-bit representation<br/>
double(double-precision) s=1, k=11, n=52, yielding a 64-bit representation<br/>
</p>


<ul>
<li id="sec-1-2-2-1">Nomalized Values<br/>

<p class="verse">
Condition: exp is not all zeros(0) &amp; not all ones(255 for single, 2047 for double)<br/>
<br/>
Cal: <br/>
E=e-Bias<br/>
e is the unsigned number having bit representation \(e_{k-1}...e_1e_0\)<br/>
Bias is bias value equal to \(2^{k-1}-1\) (127 for single 1023 for double)<br/>
Hance, \(-126\leq{E}\leq{+127}\) for single \(-1022\leq{E}\leq{+1023}\) for double<br/>
M=1+f <br/>
where \(0\leq{f}&lt;1\) having binary representation \(0.f_{n-1}...f_1f_0\)<br/>
so that, M is in the range \(1\leq{M}&lt;2\)<br/>
This implied leading 1 is a trick for getting an additional bit of precision for free.<br/>
</p>


</li>
</ul>
<ul>
<li id="sec-1-2-2-2">Denormalized Values<br/>

<p class="verse">
Condition: exp is all zeros<br/>
Cal: E=1-Bias, M=f<br/>
Serve two purposes:<br/>
</p>


<ul>
<li>represent 0 (all bits are zero)
</li>
<li>represent numbers that are very close to 0.0
</li>
</ul>

</li>
</ul>
<ul>
<li id="sec-1-2-2-3">Spacial Values<br/>

<p class="verse">
Condition: exp is all ones<br/>
</p>


<ul>
<li>frac is all zeros: represent infinity, infinity represent operation overflow or divide by zero.
</li>
<li>frac is nonzero: resulting value called "NaN"(Not a number)
</li>
</ul>


<p class="verse">
When the result can not be given as a real number or as a infinity, use NaN or inf<br/>
eg: <br/>
\(\sqrt{-1}:  NaN\) <br/>
\(1.0/0.0:  +\infty\)
</p>


</li>
</ul>
<ul>
<li id="sec-1-2-2-4">Examples<br/>
8-bit floating-point format
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="right" /><col class="right" /><col class="left" /><col class="left" /><col class="left" /><col class="left" /><col class="left" /><col class="right" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Description</th><th scope="col" class="left">bits</th><th scope="col" class="right">e</th><th scope="col" class="right">E</th><th scope="col" class="left">\(2^E\)</th><th scope="col" class="left">f</th><th scope="col" class="left">M</th><th scope="col" class="left">\(2^E\times{M}\)</th><th scope="col" class="left">V</th><th scope="col" class="right">Decimal</th></tr>
</thead>
<tbody>
<tr><td class="left">Zero</td><td class="left">0 0000 000</td><td class="right">0</td><td class="right">-6</td><td class="left">\(\frac{1}{64}\)</td><td class="left">\(\frac{0}{8}\)</td><td class="left">\(\frac{0}{8}\)</td><td class="left">\(\frac{0}{512}\)</td><td class="left">0</td><td class="right">0.0</td></tr>
<tr><td class="left">Smallest pos.</td><td class="left">0 0000 001</td><td class="right">0</td><td class="right">-6</td><td class="left">\(\frac{1}{64}\)</td><td class="left">\(\frac{1}{8}\)</td><td class="left">\(\frac{1}{8}\)</td><td class="left">\(\frac{1}{512}\)</td><td class="left">\(\frac{1}{512}\)</td><td class="right">0.001953</td></tr>
<tr><td class="left">Largest denorm.</td><td class="left">0 0000 111</td><td class="right">0</td><td class="right">-6</td><td class="left">\(\frac{1}{64}\)</td><td class="left">\(\frac{7}{8}\)</td><td class="left">\(\frac{7}{8}\)</td><td class="left">\(\frac{7}{512}\)</td><td class="left">\(\frac{7}{512}\)</td><td class="right">0.005859</td></tr>
<tr><td class="left">Smallest norm.</td><td class="left">0 0001 000</td><td class="right">1</td><td class="right">-6</td><td class="left">\(\frac{1}{64}\)</td><td class="left">\(\frac{0}{8}\)</td><td class="left">\(\frac{8}{8}\)</td><td class="left">\(\frac{8}{512}\)</td><td class="left">\(\frac{1}{64}\)</td><td class="right">0.013672</td></tr>
<tr><td class="left">One</td><td class="left">0 0111 000</td><td class="right">7</td><td class="right">0</td><td class="left">1</td><td class="left">\(\frac{0}{8}\)</td><td class="left">\(\frac{8}{8}\)</td><td class="left">\(\frac{8}{8}\)</td><td class="left">1</td><td class="right">1.0</td></tr>
<tr><td class="left">Largest norm.</td><td class="left">0 1110 111</td><td class="right">14</td><td class="right">7</td><td class="left">128</td><td class="left">\(\frac{7}{8}\)</td><td class="left">\(\frac{15}{8}\)</td><td class="left">\(\frac{1920}{8}\)</td><td class="left">240</td><td class="right">240.0</td></tr>
<tr><td class="left">Infinity</td><td class="left">0 1111 000</td><td class="right">-</td><td class="right">-</td><td class="left">-</td><td class="left">-</td><td class="left">-</td><td class="left">-</td><td class="left">\(\infty\)</td><td class="right">-</td></tr>
</tbody>
</table>


</li>
</ul>
</div>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Manipulating Infomation</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Integer arithmatic</h3>
<div class="outline-text-3" id="text-2-1">


</div>

<div id="outline-container-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> Unsigned Addition</h4>
<div class="outline-text-4" id="text-2-1-1">


\[ x+^u_wy= \left\{
  \begin{array}{l l}
    x+y & \quad x+y<2^w\\
    x+y-2^w & \quad 2^w\le x+y<2^{w-1}
   \end{array} \right.\]
<p>
Equals,  \(x+^u_wy=(x+y) \mod 2^w\)
</p>
<p class="verse">
When overflow occured, \(sum=x+y-2^w\)<br/>
Because \(y &lt; 2^w\)<br/>
We have \(sum = x +(y-2^w) &lt; x\)<br/>
sum &lt; x means it did overflow.<br/>
</p>


</div>

</div>

<div id="outline-container-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><span class="section-number-4">2.1.2</span> Unsigned Negation</h4>
<div class="outline-text-4" id="text-2-1-2">


\[ -^u_wx= \left\{
  \begin{array}{l l}
    x & \quad x=0\\
    2^w-x & \quad x>0
   \end{array} \right.\]
</div>

</div>

<div id="outline-container-2-1-3" class="outline-4">
<h4 id="sec-2-1-3"><span class="section-number-4">2.1.3</span> Two's Complement Addition</h4>
<div class="outline-text-4" id="text-2-1-3">

<ol>
<li>from signed operand to unsigned
</li>
<li>excute unsigned addition(truncate the overflow)
</li>
</ol>


$$x+^t_wy\doteq U2T_w(T2U_w(x)+^u_wT2U_w(y))$$
$$=U2T_w[(x_{w-1}2^w+x+y_{w-1}2^w+y) \mod 2^w]$$
\[ x+^t_wy= \left\{
  \begin{array}{l l}
    x+y-2^w & \qquad x+y\ge 2^{w-1} \quad Positive \ overflow\\
    x+y & \qquad -2^{w-1}\le x+y<2^{w-1} \quad Normal\\
    x+y+2^w & \qquad x+y<-2^{w-1} \quad Negative \ overflow
   \end{array} \right.\]
<p>
Example:
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">\(x\)</th><th scope="col" class="left">\(y\)</th><th scope="col" class="left">\(x+y\)</th><th scope="col" class="left">\(x+^t_4y\)</th></tr>
</thead>
<tbody>
<tr><td class="left">-8(1000)</td><td class="left">-5(1011)</td><td class="left">-13(10011)</td><td class="left">3(0011)</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-2-1-4" class="outline-4">
<h4 id="sec-2-1-4"><span class="section-number-4">2.1.4</span> Two's Complement Negation</h4>
<div class="outline-text-4" id="text-2-1-4">


\[ -^t_wx= \left\{
  \begin{array}{l l}
    -2^{w-1} & \qquad x=-2^{w-1} \\
    -x & \qquad x>-2^{w-1} \\
   \end{array} \right.\]
<p>
Two Clever Ways:
</p><ul>
<li id="sec-2-1-4-1">One Way<br/>
<ol>
<li>complement the bits
</li>
<li>increment by 1
</li>
</ol>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">x</th><th scope="col" class="left">~x</th><th scope="col" class="left">incr(~x)</th></tr>
</thead>
<tbody>
<tr><td class="left">0101(5)</td><td class="left">1010(-6)</td><td class="left">1011(-5)</td></tr>
</tbody>
</table>

</li>
</ul>
<ul>
<li id="sec-2-1-4-2">Another Way<br/>
Condition: \(x\neq 0\)
<ol>
<li>Split the bit vector into two parts.(the boundary is the rightmost 1)
</li>
<li>Complement each bit on the left part.
</li>
</ol>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">x</th><th scope="col" class="left">-x</th></tr>
</thead>
<tbody>
<tr><td class="left">1 <i>100</i> (-4)</td><td class="left">0 <i>100</i> (4)</td></tr>
</tbody>
</table>

</li>
</ul>
</div>

</div>

<div id="outline-container-2-1-5" class="outline-4">
<h4 id="sec-2-1-5"><span class="section-number-4">2.1.5</span> Unsigned Mutliplication</h4>
<div class="outline-text-4" id="text-2-1-5">


<p class="verse">
Range: \(0\le x,y\le 2^{w-1}\) Hence \(0\le x\cdot y\le2^{2w}-2^{w+1}+1\)<br/>
This could require as many as 2w bits to represent.<br/>
</p>




$$ x \times ^u_wy=(x\cdot y)\ mod\ 2^w$$
</div>

</div>

<div id="outline-container-2-1-6" class="outline-4">
<h4 id="sec-2-1-6"><span class="section-number-4">2.1.6</span> Two's Complement Multiplication</h4>
<div class="outline-text-4" id="text-2-1-6">


<p class="verse">
Range: \(-2^{w-1}\le x,y \le 2^{w-1}-1\) <br/>
Hence:<br/>
The result of \(x\cdot y\) is \(-2^{w-1}\cdot (2^{w-1}-1)=-2^{2w-2}+2^{w-1}\) between \(2^{2w-2}=-2^{w-1}\cdot -2^{w-1}\)<br/>
Also need 2w bits to represent.<br/>
</p>




$$ x \times ^t_wy = U2T_w((x\cdot y)\ mod\ 2^w) $$
<ul>
<li id="sec-2-1-6-1">Extension<br/>

<p class="verse">
The bit-level representation of the product operation is identical for both unsigned and two's complement multiplication.<br/>
</p>


<p>
Let :
$$x = B2U(\overrightarrow{x})\quad y = B2U(\overrightarrow{y})\quad x' = B2T(\overrightarrow{x})\quad y' = B2T(\overrightarrow{y})$$
Then we have : 
$$x' = x-x_{w-1}2^w\quad y' = y-y_{w-1}2^w$$
Result:
$$(x'\cdot y')\ mod\ 2^w = ((x - x_{w-1}2^w)\cdot (y - y_{w-1}2^w))\ mod\ 2$$
$$=(x\cdot y)\ mod\ 2^w$$

</p></li>
</ul>
</div>

</div>

<div id="outline-container-2-1-7" class="outline-4">
<h4 id="sec-2-1-7"><span class="section-number-4">2.1.7</span> Reduce Mutiplication by shift and addition</h4>
<div class="outline-text-4" id="text-2-1-7">

<p>Mutiplication require 10 or more clock cycles.
$$ x \times ^t_w2^k  = x << k$$
eg: \(14 = 2^4-2^1\) rewrite as \((x&lt;&lt;4) - (x &lt;&lt;1)\)
</p>
<p class="verse">
For continuous 1s from bit position n down to m(\(n/beqm\)), we can compute using two forms:<br/>
Form1: \((x&lt;&lt;n) + (x&lt;&lt;n-1) + ... + (x&lt;&lt;m)\)<br/>
Form2: \((x&lt;&lt;n+1)-(x&lt;&lt;m)\)<br/>
<br/>
Assuming additions and subtractions have comparable cost, then we have:<br/>
\(n = m\), use Form1.<br/>
\(n = m+1\), use either Form1 or Form2.<br/>
\(n &gt; m+1\), use Form2.<br/>
</p>


</div>

</div>

<div id="outline-container-2-1-8" class="outline-4">
<h4 id="sec-2-1-8"><span class="section-number-4">2.1.8</span> Reduce Division by shift</h4>
<div class="outline-text-4" id="text-2-1-8">

<p>Division require 30 or more clock cycles.
</p><ul>
<li id="sec-2-1-8-1">Logical Shift<br/>
\(x&gt;&gt;k = x\div2^k\) where \(0\le{k}&lt;w\) and \(x\ge0\)
</li>
</ul>
<ul>
<li id="sec-2-1-8-2">Arithmatic Shift<br/>
\(x&gt;&gt;k = x\div2^k\) where \(0\le{k}&lt;w\)

<p class="verse">
Follow the above, we'll find -7/2 yield -4 not -3.<br/>
Correct by 'biasing' the value before shifting.<br/>
</p>


<p>
\(x\div 2^k = (x+2^k-1)&gt;&gt;k\) where \(x&lt;0\)
</p></li>
</ul>
</div>
</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Floating Operation</h3>
<div class="outline-text-3" id="text-2-2">


</div>

<div id="outline-container-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Round</h4>
<div class="outline-text-4" id="text-2-2-1">


<p class="verse">
4 Modes:<br/>
Round-to-even eg: 1.5 approximate 2, 2.5 approximate 2 (DEFAULT)<br/>
Round-toward-zero eg:-1.5 approximate -1, 1.5 approximate 1<br/>
Round-down eg: 1.5 approximate 1<br/>
Round-up eg: 1.5 approximate 2<br/>
</p>


</div>

</div>

<div id="outline-container-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> Arithmatic Operation</h4>
<div class="outline-text-4" id="text-2-2-2">

<p>Round(x?y)
$$x+^fy=Round(x+y)$$
Floating arithmatic doesn't satisfied associativity, distributivity.
</p></div>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Program Structure</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Data Formats</h3>
<div class="outline-text-3" id="text-3-1">

<p><b>sizes in IA32.</b>
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" /><col class="right" />
</colgroup>
<thead>
<tr><th scope="col" class="left">C declaration</th><th scope="col" class="left">Intel</th><th scope="col" class="left">Assembly code suffix</th><th scope="col" class="right">Size(bytes)</th></tr>
</thead>
<tbody>
<tr><td class="left">char</td><td class="left">Byte</td><td class="left">b</td><td class="right">1</td></tr>
<tr><td class="left">short</td><td class="left">Word</td><td class="left">w</td><td class="right">2</td></tr>
<tr><td class="left">int</td><td class="left">Double word</td><td class="left">l</td><td class="right">4</td></tr>
<tr><td class="left">long int</td><td class="left">Double word</td><td class="left">l</td><td class="right">4</td></tr>
<tr><td class="left">long long int</td><td class="left">—</td><td class="left">—</td><td class="right">4</td></tr>
<tr><td class="left">char *</td><td class="left">Double word</td><td class="left">l</td><td class="right">4</td></tr>
<tr><td class="left">float</td><td class="left">Single precision</td><td class="left">s</td><td class="right">4</td></tr>
<tr><td class="left">double</td><td class="left">Double precision</td><td class="left">l</td><td class="right">8</td></tr>
<tr><td class="left">long double</td><td class="left">Extend precision</td><td class="left">t</td><td class="right">10/12</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Interger Registers</h3>
<div class="outline-text-3" id="text-3-2">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">31</td><td class="left">16</td><td class="left">15&mdash;8</td><td class="left">7&mdash;0</td></tr>
<tr><td class="left">%eax</td><td class="left">%ax</td><td class="left">%ah</td><td class="left">%al</td></tr>
<tr><td class="left">%ecx</td><td class="left">%cx</td><td class="left">%ch</td><td class="left">%cl</td></tr>
<tr><td class="left">%edx</td><td class="left">%dx</td><td class="left">%dh</td><td class="left">%dl</td></tr>
<tr><td class="left">%ebx</td><td class="left">%bx</td><td class="left">%bh</td><td class="left">%bl</td></tr>
<tr><td class="left">%esi</td><td class="left">%si</td><td class="left"></td><td class="left"></td></tr>
<tr><td class="left">%edi</td><td class="left">%di</td><td class="left"></td><td class="left"></td></tr>
<tr><td class="left">%esp</td><td class="left">%sp</td><td class="left"></td><td class="left"></td></tr>
<tr><td class="left">%ebp</td><td class="left">%bp</td><td class="left"></td><td class="left"></td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Accessing Information</h3>
<div class="outline-text-3" id="text-3-3">


<p class="verse">
\(R[E_a]\) indicate the value of register a.<br/>
\(M[Addr]\) indicate the memory location<br/>
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Form</th><th scope="col" class="left">Operand Value</th></tr>
</thead>
<tbody>
<tr><td class="left">\(\textit{\$ Imm}\)</td><td class="left">\(\textit{Imm}\)</td></tr>
<tr><td class="left">\(E_a\)</td><td class="left">\(R[E_a]\)</td></tr>
<tr><td class="left">\(\textit{Imm}\)</td><td class="left">\(M[\textit{Imm}]\)</td></tr>
<tr><td class="left">\((E_a)\)</td><td class="left">\(M[R[E_a]]\)</td></tr>
<tr><td class="left">\(\textit{Imm}(E_b)\)</td><td class="left">\(M[\textit{Imm}+R[E_b]]\)</td></tr>
<tr><td class="left">\((E_b,E_i)\)</td><td class="left">\(M[R[E_b]+R[E_i]]\)</td></tr>
<tr><td class="left">\(\textit{Imm}(E_b,E_i)\)</td><td class="left">\(M[\textit{Imm}+R[E_b]+R[E_i]]\)</td></tr>
<tr><td class="left">\((,E_i,s)\)</td><td class="left">\(M[R[E_i]\cdot{s}]\)</td></tr>
<tr><td class="left">\(\textit{Imm}(E_b,E_i,s)\)</td><td class="left">\(M[\textit{Imm}+R[E_b]+R[E_i]\cdot{s}]\)</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> Basic Operations</h3>
<div class="outline-text-3" id="text-3-4">


</div>

<div id="outline-container-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> Data Movement</h4>
<div class="outline-text-4" id="text-3-4-1">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Instruction</th><th scope="col" class="left">Description</th></tr>
</thead>
<tbody>
<tr><td class="left">mov  S,D</td><td class="left">D &lt;- S</td></tr>
<tr><td class="left">movs S,D</td><td class="left">D &lt;- SignExtend(S)</td></tr>
<tr><td class="left">movz S,D</td><td class="left">D &lt;- ZeroExtend(S)</td></tr>
<tr><td class="left">push &amp; pop</td><td class="left"></td></tr>
<tr><td class="left">pushl S</td><td class="left">R[%esp] &lt;- R[%esp]-4; M[R[%esp]] &lt;- S</td></tr>
<tr><td class="left">popl D</td><td class="left">D &lt;- M[R[%esp]]; R[%esp] &lt;- R[%esp]+4</td></tr>
</tbody>
</table>


<p class="verse">
movs include: movsbw,movsbl,movswl<br/>
the same for movz.<br/>
</p>


<p>
pushl %ebp is equivalent to the following pair of instuctions:
</p>


<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">subl</span> <span style="color: #1e90ff; font-weight: bold;">$4</span>,<span style="color: #008b8b;">%esp</span>
<span style="color: #00008b; font-weight: bold;">movl</span> <span style="color: #1e90ff; font-weight: bold;">%ebp</span>,(<span style="color: #008b8b;">%esp</span>)
</pre>

<p>
popl %eax:
</p>


<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">movl</span> (<span style="color: #008b8b;">%esp</span>),<span style="color: #008b8b;">%esp</span>
<span style="color: #00008b; font-weight: bold;">addl</span> <span style="color: #1e90ff; font-weight: bold;">$4</span>,<span style="color: #008b8b;">%esp</span>
</pre>

</div>

</div>

<div id="outline-container-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> Arithmetic &amp; Logical Operations</h4>
<div class="outline-text-4" id="text-3-4-2">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Instruction</th><th scope="col" class="left">Description</th></tr>
</thead>
<tbody>
<tr><td class="left">lea  S,D</td><td class="left">D &lt;- &amp;S</td></tr>
<tr><td class="left">unary op</td><td class="left"></td></tr>
<tr><td class="left">inc D</td><td class="left">D &lt;- D+1</td></tr>
<tr><td class="left">dec D</td><td class="left">D &lt;- D-1</td></tr>
<tr><td class="left">neg D</td><td class="left">D &lt;- -D</td></tr>
<tr><td class="left">not D</td><td class="left">D &lt;- ~D(complement)</td></tr>
<tr><td class="left">binary op</td><td class="left">second operand: src &amp; dest</td></tr>
<tr><td class="left">add S,D</td><td class="left">D &lt;- D+S</td></tr>
<tr><td class="left">sub S,D</td><td class="left">D &lt;- D-S</td></tr>
<tr><td class="left">imul S,D</td><td class="left">D &lt;- D*S  (use \(*^u_{32} *^t_{32}\))</td></tr>
<tr><td class="left">xor S,D</td><td class="left">D &lt;- D^S</td></tr>
<tr><td class="left">or S,D</td><td class="left">D &lt;- D&#124;S</td></tr>
<tr><td class="left">and S,D</td><td class="left">D &lt;- D&amp;S</td></tr>
<tr><td class="left">shift op</td><td class="left"></td></tr>
<tr><td class="left">sal k,D</td><td class="left">D &lt;- D&lt;&lt;k</td></tr>
<tr><td class="left">shl k,D</td><td class="left">D &lt;- D&lt;&lt;k(same as sal)</td></tr>
<tr><td class="left">sar k,D</td><td class="left">D &lt;- D&gt;&gt;k(arithmetic shift)</td></tr>
<tr><td class="left">shr k,D</td><td class="left">D &lt;- D&gt;&gt;k(logical shift)</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="section-number-4">3.4.3</span> About xorl x, x</h4>
<div class="outline-text-4" id="text-3-4-3">

<p>For c code:
</p>


<pre class="src src-c"><span style="color: #daa520;">int</span> <span style="color: #008b8b;">x</span>=1;
</pre>


<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">GCC</span> -O1:
<span style="color: #00008b; font-weight: bold;">movl</span> <span style="color: #1e90ff; font-weight: bold;">$0x00</span>, <span style="color: #008b8b;">%eax</span> (binary b8 00 00 00 00)

<span style="color: #00008b; font-weight: bold;">GCC</span> -O2:
<span style="color: #00008b; font-weight: bold;">xorl</span> <span style="color: #1e90ff; font-weight: bold;">$edx</span>,<span style="color: #008b8b;">%edx</span> (binary 31 c0)
</pre>

</div>

</div>

<div id="outline-container-3-4-4" class="outline-4">
<h4 id="sec-3-4-4"><span class="section-number-4">3.4.4</span> Special Arithmetic Operations</h4>
<div class="outline-text-4" id="text-3-4-4">

<p>imul also support one-operand operaion.
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Instruction</th><th scope="col" class="left">Description</th></tr>
</thead>
<tbody>
<tr><td class="left">imull S</td><td class="left">R[%edx]:R[%eax] &lt;- S*R[%eax] (Signed)</td></tr>
<tr><td class="left">mull S</td><td class="left">R[%edx]:R[%eax] &lt;- S*R[%eax] (Unsigned)</td></tr>
<tr><td class="left">cltd</td><td class="left">R[%edx]:R[%eax] &lt;- SignExtend(R[%eax])</td></tr>
<tr><td class="left">idivl S</td><td class="left">R[%edx] &lt;- R[%edx]:R[%eax] mod S;(Signed)</td></tr>
<tr><td class="left"></td><td class="left">R[%eax] &lt;- R[%edx]:R[%eax] / S;(Signed)</td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> Control</h3>
<div class="outline-text-3" id="text-3-5">


</div>

<div id="outline-container-3-5-1" class="outline-4">
<h4 id="sec-3-5-1"><span class="section-number-4">3.5.1</span> Condiction Register</h4>
<div class="outline-text-4" id="text-3-5-1">

<p>Four flags:
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">CF</td><td class="left">carry flag</td></tr>
<tr><td class="left">ZF</td><td class="left">zero flag</td></tr>
<tr><td class="left">SF</td><td class="left">sign flag</td></tr>
<tr><td class="left">OF</td><td class="left">overflow flag</td></tr>
</tbody>
</table>

For t=a+b
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">CF</td><td class="left">(unsigned)t &lt; (unsigned)a</td><td class="left">Unsigned Overflow</td></tr>
<tr><td class="left">ZF</td><td class="left">(t == 0)</td><td class="left">Zero</td></tr>
<tr><td class="left">SF</td><td class="left">(t &lt; 0)</td><td class="left">Negative</td></tr>
<tr><td class="left">OF</td><td class="left">(a&lt;0 == b&lt;0)&amp;&amp;(t&lt;0 != a&lt;0)</td><td class="left">Signed Overflow</td></tr>
</tbody>
</table>

instructions that set the condiction code without updating their destination.
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">Instruction</td><td class="left">Effect</td><td class="left">Like</td></tr>
<tr><td class="left">cmp \(S_2, S_1\)</td><td class="left">\(S_1-S_2\)</td><td class="left">sub</td></tr>
<tr><td class="left">test \(S_2,S_1\)</td><td class="left">\(S_1\) &amp; \(S_2\)</td><td class="left">and</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-3-5-2" class="outline-4">
<h4 id="sec-3-5-2"><span class="section-number-4">3.5.2</span> Accessing the Condition Codes</h4>
<div class="outline-text-4" id="text-3-5-2">

<p>Three common ways of using the condition codes:
</p><ol>
<li>set a single byte to 0 or 1 depending on some combination of the condition codes.
</li>
<li>conditionally jump to some other part of the program
</li>
<li>conditionally transfer data.
</li>
</ol>

<p>for (1), we use set instruction:
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">Instruction</td><td class="left">Synonym</td><td class="left">Effect</td><td class="left">Set condition</td></tr>
<tr><td class="left">sete D</td><td class="left">setz</td><td class="left">D &lt;- ZF</td><td class="left">Equal/zero</td></tr>
<tr><td class="left">setne D</td><td class="left">setnz</td><td class="left">D &lt;- ~ZF</td><td class="left">Not Equal/not zero</td></tr>
<tr><td class="left">sets D</td><td class="left"></td><td class="left">D &lt;- SF</td><td class="left">Negative</td></tr>
<tr><td class="left">setns D</td><td class="left"></td><td class="left">D &lt;- ~SF</td><td class="left">Nonnegative</td></tr>
</tbody>
</table>

Signed Group:
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">setg D</td><td class="left">setnle</td><td class="left">D &lt;- ~(SF^OF) &amp; ~ZF</td><td class="left">&gt;</td></tr>
<tr><td class="left">setge D</td><td class="left">setnl</td><td class="left">D &lt;- ~(SF^OF)</td><td class="left">&gt;=</td></tr>
<tr><td class="left">setl D</td><td class="left">setnge</td><td class="left">D &lt;- SF^OF</td><td class="left">&lt;</td></tr>
<tr><td class="left">setle D</td><td class="left">setnge</td><td class="left">D &lt;- (SF^OF) &#124; ZF</td><td class="left">&lt;=</td></tr>
</tbody>
</table>

Unsigned Group:
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">seta D</td><td class="left">setnbe</td><td class="left">D &lt;- ~CF &amp; ~ZF</td><td class="left">&gt;</td></tr>
<tr><td class="left">setae D</td><td class="left">setnb</td><td class="left">D &lt;- ~CF</td><td class="left">&gt;=</td></tr>
<tr><td class="left">setb D</td><td class="left">setnae</td><td class="left">D &lt;- CF</td><td class="left">&lt;</td></tr>
<tr><td class="left">setbe D</td><td class="left">setna</td><td class="left">D &lt;- CF &#124;  ZF</td><td class="left">&lt;=</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-3-5-3" class="outline-4">
<h4 id="sec-3-5-3"><span class="section-number-4">3.5.3</span> Jump Instruction</h4>
<div class="outline-text-4" id="text-3-5-3">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">Instruction</td><td class="left">Synonym</td><td class="left">Condition</td></tr>
<tr><td class="left">jmp Label</td><td class="left">direct jump</td><td class="left">1</td></tr>
<tr><td class="left">jmp *Operand</td><td class="left">indirect jump</td><td class="left">1</td></tr>
<tr><td class="left">je L</td><td class="left">jz</td><td class="left">ZF</td></tr>
<tr><td class="left">jne L</td><td class="left">jnz</td><td class="left">~ZF</td></tr>
<tr><td class="left">js L</td><td class="left"></td><td class="left">SF</td></tr>
<tr><td class="left">jns L</td><td class="left"></td><td class="left">~SF</td></tr>
</tbody>
</table>

Signed Group:  
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">jg L</td><td class="left">jnle</td><td class="left">~(SF^OF)&amp;~ZF</td></tr>
<tr><td class="left">jge L</td><td class="left">jnl</td><td class="left">~(SF^OF)</td></tr>
<tr><td class="left">jl L</td><td class="left">jnge</td><td class="left">SF^OF</td></tr>
<tr><td class="left">jle L</td><td class="left">jng</td><td class="left">(SF^OF)&#124;ZF</td></tr>
</tbody>
</table>

Unsigned Group:
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">ja L</td><td class="left">jnbe</td><td class="left">~CF &amp; ~ZF</td></tr>
<tr><td class="left">jae L</td><td class="left">jnb</td><td class="left">~CF</td></tr>
<tr><td class="left">jb L</td><td class="left">jnae</td><td class="left">CF</td></tr>
<tr><td class="left">jbe L</td><td class="left">jna</td><td class="left">CF&#124;ZF</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-3-5-4" class="outline-4">
<h4 id="sec-3-5-4"><span class="section-number-4">3.5.4</span> If Statement</h4>
<div class="outline-text-4" id="text-3-5-4">

<p>General in C:
</p>


<pre class="example">if (test-expr)
   then-statement
else
   else-statement
</pre>

<p>
nomal form with goto statement:
</p>


<pre class="example">    t = test-expr;
    if (t)
       goto true;
    else-statement
    goto done;
true:
    then-statement
done:
</pre>

<p>
assembly form:
</p>


<pre class="example">    t = test-expr;
    if (!t)
       goto false-label;
    then-statement
    goto done;
false-label:
    else-statement
done:
</pre>

<p>
major difference: when there is no else-statement.
</p>


<pre class="example">    t = test-expr;
    if (!t)
       goto done;
    then-statement
done:
</pre>

<ul>
<li id="sec-3-5-4-1">example<br/>



<pre class="src src-c"><span style="color: #daa520;">int</span> <span style="color: #00008b; font-weight: bold;">test</span>(<span style="color: #daa520;">int</span> <span style="color: #008b8b;">x</span>, <span style="color: #daa520;">int</span> <span style="color: #008b8b;">y</span>)
{
    <span style="color: #daa520;">int</span> <span style="color: #008b8b;">val</span> = x^y;
    <span style="color: #1e90ff; font-weight: bold;">if</span> (x &lt; -3)
    {
        <span style="color: #1e90ff; font-weight: bold;">if</span> (y &lt; x)
            val = x*y;
        <span style="color: #1e90ff; font-weight: bold;">else</span>
            val = x+y;
    }
    <span style="color: #1e90ff; font-weight: bold;">else</span> <span style="color: #1e90ff; font-weight: bold;">if</span> (x &gt; 2)
        val = x-y;
    <span style="color: #1e90ff; font-weight: bold;">return</span> val;
}
</pre>


<pre class="src src-asm">    <span style="color: #1e90ff; font-weight: bold;">movl</span>    12(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span>    8(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%edx</span>
    <span style="color: #1e90ff; font-weight: bold;">cmpl</span>    $-3, <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">jge</span> .L2
    <span style="color: #1e90ff; font-weight: bold;">cmpl</span>    <span style="color: #008b8b;">%edx</span>, <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">jle</span> .L3
    <span style="color: #1e90ff; font-weight: bold;">imull</span>   <span style="color: #008b8b;">%edx</span>, <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">jmp</span> .L4
<span style="color: #00008b; font-weight: bold;">.L3</span>:
    <span style="color: #1e90ff; font-weight: bold;">leal</span>    (<span style="color: #008b8b;">%edx</span>,<span style="color: #008b8b;">%eax</span>), <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">jmp</span> .L4
<span style="color: #00008b; font-weight: bold;">.L2</span>:
    <span style="color: #1e90ff; font-weight: bold;">cmpl</span>    $2, <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">jg</span> .L5
    <span style="color: #1e90ff; font-weight: bold;">xorl</span>    <span style="color: #008b8b;">%edx</span>, <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">jmp</span> .L4
<span style="color: #00008b; font-weight: bold;">.L5</span>:
    <span style="color: #1e90ff; font-weight: bold;">subl</span> <span style="color: #008b8b;">%edx</span>, <span style="color: #008b8b;">%eax</span>
<span style="color: #00008b; font-weight: bold;">.L4</span>:
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-3-5-5" class="outline-4">
<h4 id="sec-3-5-5"><span class="section-number-4">3.5.5</span> Loops</h4>
<div class="outline-text-4" id="text-3-5-5">

<ul>
<li id="sec-3-5-5-1">do&hellip;while<br/>



<pre class="example">do
    body-statement
while (test-expr)
</pre>

<p>
goto version:
</p>


<pre class="example">loop:
    body-statement
    t = test-expr;
    if (t)
       goto loop;
done:
</pre>

</li>
</ul>
<ul>
<li id="sec-3-5-5-2">while<br/>



<pre class="example">while (test-expr)
    body-statement
</pre>

<p>
goto version:
</p>


<pre class="example">t = test-expr
if (!t)
   goto done;
loop:
   body-statement
   if (t)
      goto loop;
done:
</pre>

</li>
</ul>
<ul>
<li id="sec-3-5-5-3">for<br/>



<pre class="example">for (init-expr; test-expr; update-expr)
    body-statement
</pre>

<p>
Equivalent to while loop
</p>


<pre class="example">init-expr;
while (test-expr)
    body-statement
    update-expr;
</pre>

<p>
goto vesion:
</p>


<pre class="example">init-expr;
t = test-expr;
if (!t)
   goto done;

loop:
   body-statement
   update-expr;
   if (t)
      goto loop;
done:
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-3-5-6" class="outline-4">
<h4 id="sec-3-5-6"><span class="section-number-4">3.5.6</span> Conditional Move Instructions</h4>
<div class="outline-text-4" id="text-3-5-6">

<ul>
<li id="sec-3-5-6-1">Why use?<br/>

<p class="verse">
Processors achieve high performance by overlapping the steps of the<br/>
successive instructions, such as fetching one instruction while <br/>
performing the arithmetic operations for a previous instruction.<br/>
</p>


</li>
</ul>
<ul>
<li id="sec-3-5-6-2">Instructions<br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Instruction</th><th scope="col" class="left">Synonym</th><th scope="col" class="left">Condition</th></tr>
</thead>
<tbody>
<tr><td class="left">cmove S, R</td><td class="left">cmovz</td><td class="left">ZF</td></tr>
<tr><td class="left">cmovne</td><td class="left">cmovnz</td><td class="left">~ZF</td></tr>
<tr><td class="left">cmovs</td><td class="left"></td><td class="left">SF</td></tr>
<tr><td class="left">cmovns</td><td class="left"></td><td class="left">~SF</td></tr>
<tr><td class="left">cmovg</td><td class="left">cmovnle</td><td class="left">~(SF^OF)&amp;~ZF</td></tr>
<tr><td class="left">cmovge</td><td class="left">cmovnl</td><td class="left">~(SF^OF)</td></tr>
<tr><td class="left">cmovl</td><td class="left">cmovnge</td><td class="left">SF^OF</td></tr>
<tr><td class="left">cmovle</td><td class="left">cmovng</td><td class="left">(SF^OF)&#124;ZF</td></tr>
<tr><td class="left">cmova</td><td class="left">cmovnbe</td><td class="left">~CF&amp;~ZF</td></tr>
<tr><td class="left">cmovae</td><td class="left">cmovnb</td><td class="left">~CF</td></tr>
<tr><td class="left">cmovb</td><td class="left">cmovnae</td><td class="left">CF</td></tr>
<tr><td class="left">cmovbe</td><td class="left">cmovna</td><td class="left">CF&#124;ZF</td></tr>
</tbody>
</table>


</li>
</ul>
<ul>
<li id="sec-3-5-6-3">example<br/>
Expression:



<pre class="example">v = test-expr ? then-expr : else-expr;
</pre>

<p>
Traditional IA32:
</p>


<pre class="example">    if (!test-expr)
        goto false;
    v = then-expr;
    goto done;
false:
    v = else-expr;
done:
</pre>

<p>
Base the on conditional move:
</p>


<pre class="example">vt = then-expr;
v = else-expr;
t = test-expr;
if (t) v = vt;
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-3-5-7" class="outline-4">
<h4 id="sec-3-5-7"><span class="section-number-4">3.5.7</span> Switch Statement</h4>
<div class="outline-text-4" id="text-3-5-7">

<p>Using the jump table
</p>


<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">.L8</span>:
        <span style="color: #1e90ff; font-weight: bold;">.long</span>   .L3 <span style="color: #8b8989;">//</span><span style="color: #8b8989;">index 0</span>
        <span style="color: #1e90ff; font-weight: bold;">.long</span>   .L2<span style="color: #8b8989;">//</span><span style="color: #8b8989;">1</span>
        <span style="color: #1e90ff; font-weight: bold;">.long</span>   .L4<span style="color: #8b8989;">//</span><span style="color: #8b8989;">2</span>
        <span style="color: #1e90ff; font-weight: bold;">.long</span>   .L5<span style="color: #8b8989;">//</span><span style="color: #8b8989;">3</span>
        <span style="color: #1e90ff; font-weight: bold;">.long</span>   .L6<span style="color: #8b8989;">//</span><span style="color: #8b8989;">4</span>
        <span style="color: #1e90ff; font-weight: bold;">.long</span>   .L6<span style="color: #8b8989;">//</span><span style="color: #8b8989;">5</span>
        <span style="color: #1e90ff; font-weight: bold;">.long</span>   .L7<span style="color: #8b8989;">//</span><span style="color: #8b8989;">6</span>
</pre>


<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">movl</span>    <span style="color: #1e90ff; font-weight: bold;">8</span>(<span style="color: #008b8b;">%ebp</span>),    <span style="color: #008b8b;">%eax</span> <span style="color: #8b8989;">//</span><span style="color: #8b8989;">x at %ebp+8</span>
<span style="color: #00008b; font-weight: bold;">addl</span>    <span style="color: #1e90ff; font-weight: bold;">$2</span>, <span style="color: #008b8b;">%eax</span> <span style="color: #8b8989;">//</span><span style="color: #8b8989;">index = x+2. when index = 0, x(min)=-2.</span>
<span style="color: #00008b; font-weight: bold;">cmpl</span>    <span style="color: #1e90ff; font-weight: bold;">$6</span>, <span style="color: #008b8b;">%eax</span> <span style="color: #8b8989;">//</span><span style="color: #8b8989;">index compare with 6</span>
<span style="color: #00008b; font-weight: bold;">ja</span>      .L2 <span style="color: #8b8989;">//</span><span style="color: #8b8989;">index &gt; 6 goto default. Such that, x(max)=4.</span>
<span style="color: #00008b; font-weight: bold;">jmp</span> *.L8(,<span style="color: #008b8b;">%eax</span>,4)
</pre>

<p>
x case 2, 3 goes to .L6
</p></div>
</div>

</div>

<div id="outline-container-3-6" class="outline-3">
<h3 id="sec-3-6"><span class="section-number-3">3.6</span> Procedure</h3>
<div class="outline-text-3" id="text-3-6">


</div>

<div id="outline-container-3-6-1" class="outline-4">
<h4 id="sec-3-6-1"><span class="section-number-4">3.6.1</span> Stack Frame</h4>
<div class="outline-text-4" id="text-3-6-1">

<p>caller's frame:
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">arg n</td></tr>
<tr><td class="left">&hellip;</td></tr>
<tr><td class="left">arg 1</td></tr>
<tr><td class="left">return address</td></tr>
</tbody>
</table>

callee's frame:
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">Saved %ebp</td></tr>
<tr><td class="left">Saved registers, local var, temporaries</td></tr>
<tr><td class="left">Argument build area    (%esp)</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-3-6-2" class="outline-4">
<h4 id="sec-3-6-2"><span class="section-number-4">3.6.2</span> Procedure Call</h4>
<div class="outline-text-4" id="text-3-6-2">

<p>Instructions:
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">call Label</td><td class="left">procedure call</td></tr>
<tr><td class="left">call *Operand</td><td class="left">procedure call</td></tr>
<tr><td class="left">leave</td><td class="left">prepare stack for return</td></tr>
<tr><td class="left">ret</td><td class="left">return from call</td></tr>
</tbody>
</table>


<ul>
<li>call
</li>
</ul>


<p class="verse">
A <i>call</i> instruction is to push a return address on the stack<br/>
and jump to the start of the called procedure.<br/>
</p>


<ul>
<li>ret
</li>
</ul>


<p class="verse">
The <i>ret</i> instruction pops an address off the stack and jumps<br/>
to return address of the caller procedure.<br/>
</p>


<ul>
<li>leave
</li>
</ul>


<p class="verse">
equilvalent to the following:<br/>
movl %ebp, %esp<br/>
popl %ebp<br/>
</p>


</div>

</div>

<div id="outline-container-3-6-3" class="outline-4">
<h4 id="sec-3-6-3"><span class="section-number-4">3.6.3</span> Registers</h4>
<div class="outline-text-4" id="text-3-6-3">


<p class="verse">
%eax, %edx and %ecx are classified as caller-save registers.<br/>
callee can overwrite them without destroying any data required by P.<br/>
<br/>
%ebx, %esi and %edi : callee-save registers.<br/>
callee must save the values on the stack before overwriting them,<br/>
and restore them before returning.<br/>
Because caller may need them for its future computations.<br/>
</p>


</div>

</div>

<div id="outline-container-3-6-4" class="outline-4">
<h4 id="sec-3-6-4"><span class="section-number-4">3.6.4</span> Example</h4>
<div class="outline-text-4" id="text-3-6-4">




<pre class="src src-c++"><span style="color: #daa520;">int</span> <span style="color: #00008b; font-weight: bold;">swap_add</span>(<span style="color: #daa520;">int</span> *<span style="color: #008b8b;">xp</span>, <span style="color: #daa520;">int</span> *<span style="color: #008b8b;">yp</span>)
{
    <span style="color: #daa520;">int</span> <span style="color: #008b8b;">x</span> = *xp;
    <span style="color: #daa520;">int</span> <span style="color: #008b8b;">y</span> = *yp;

    *xp = y;
    *yp = x;
    <span style="color: #1e90ff; font-weight: bold;">return</span> x + y;
}

<span style="color: #daa520;">int</span> <span style="color: #00008b; font-weight: bold;">caller</span>()
{
    <span style="color: #daa520;">int</span> <span style="color: #008b8b;">arg1</span> = 534;
    <span style="color: #daa520;">int</span> <span style="color: #008b8b;">arg2</span> = 1057;
    <span style="color: #daa520;">int</span> <span style="color: #008b8b;">sum</span> = swap_add(&amp;arg1, &amp;arg2);
    <span style="color: #daa520;">int</span> <span style="color: #008b8b;">diff</span> = arg1 - arg2;

    <span style="color: #1e90ff; font-weight: bold;">return</span> sum * diff;
}
</pre>

<ul>
<li id="sec-3-6-4-1">Caller<br/>



<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">caller</span>:
    <span style="color: #1e90ff; font-weight: bold;">pushl</span> <span style="color: #008b8b;">%ebp</span>              <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Save old %ebp</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span> <span style="color: #008b8b;">%esp</span>, <span style="color: #008b8b;">%ebp</span>         <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Set %ebp as frame pointer</span>
    <span style="color: #1e90ff; font-weight: bold;">subl</span> $24, <span style="color: #008b8b;">%esp</span>          <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Allocate 24 bytes on stack</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span> $534, -4(<span style="color: #008b8b;">%ebp</span>)     <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Set arg1 to 534</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span> $1057, -8(<span style="color: #008b8b;">%ebp</span>)        <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Set arg2 to 1057</span>
    <span style="color: #1e90ff; font-weight: bold;">leal</span> -8(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%eax</span>     <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Compute &amp;arg2</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span> <span style="color: #008b8b;">%eax</span>, 4(<span style="color: #008b8b;">%esp</span>)      <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Store on stack</span>
    <span style="color: #1e90ff; font-weight: bold;">leal</span> -4(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%eax</span>         <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Compute &amp;arg1</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span> <span style="color: #008b8b;">%eax</span>, (<span style="color: #008b8b;">%esp</span>)       <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Store on stack</span>
    <span style="color: #1e90ff; font-weight: bold;">call</span> swap_add               <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Call the swap_add function</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span> -4(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%edx</span>
    <span style="color: #1e90ff; font-weight: bold;">subl</span> -8(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%edx</span>
    <span style="color: #1e90ff; font-weight: bold;">imull</span> <span style="color: #008b8b;">%edx</span>, <span style="color: #008b8b;">%eax</span>
    <span style="color: #1e90ff; font-weight: bold;">leave</span>
    <span style="color: #1e90ff; font-weight: bold;">ret</span> 
</pre>

<p>
Stack Frame:
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">Saved %ebp(%ebp)</td></tr>
<tr><td class="left">arg1</td></tr>
<tr><td class="left">arg2</td></tr>
<tr><td class="left"><i>Unused</i></td></tr>
<tr><td class="left">&amp;arg2</td></tr>
<tr><td class="left">&amp;arg1 (%esp)</td></tr>
</tbody>
</table>

After call:
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">Saved %ebp</td></tr>
<tr><td class="left">arg1</td></tr>
<tr><td class="left">arg2</td></tr>
<tr><td class="left">/Unused</td></tr>
<tr><td class="left">&amp;arg2</td></tr>
<tr><td class="left">&amp;arg1</td></tr>
<tr><td class="left">Return address</td></tr>
<tr><td class="left">Saved %ebp(%ebp)</td></tr>
<tr><td class="left">Saved %ebx(%esp)</td></tr>
</tbody>
</table>

</li>
</ul>
<ul>
<li id="sec-3-6-4-2">Callee<br/>
<ul>
<li>setup
</li>
</ul>




<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">swap_add</span>:
    <span style="color: #1e90ff; font-weight: bold;">pushl</span> <span style="color: #008b8b;">%ebp</span>
    <span style="color: #1e90ff; font-weight: bold;">movl</span> <span style="color: #008b8b;">%esp</span>, <span style="color: #008b8b;">%ebp</span>
    <span style="color: #1e90ff; font-weight: bold;">pushl</span> <span style="color: #008b8b;">%ebx</span>          <span style="color: #8b8989;">//</span><span style="color: #8b8989;">for temporary storage</span>
</pre>

<ul>
<li>body
</li>
</ul>




<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">movl</span>    <span style="color: #1e90ff; font-weight: bold;">8</span>(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%edx</span>   <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Get xp</span>
<span style="color: #00008b; font-weight: bold;">movl</span>    <span style="color: #1e90ff; font-weight: bold;">12</span>(<span style="color: #008b8b;">%ebp</span>), <span style="color: #008b8b;">%ecx</span>  <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Get yp</span>
<span style="color: #00008b; font-weight: bold;">movl</span>    (<span style="color: #008b8b;">%edx</span>), <span style="color: #008b8b;">%ebx</span>        <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Get x</span>
<span style="color: #00008b; font-weight: bold;">movl</span>    (<span style="color: #008b8b;">%ecx</span>), <span style="color: #008b8b;">%eax</span>        <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Get y</span>
<span style="color: #00008b; font-weight: bold;">movl</span>    <span style="color: #1e90ff; font-weight: bold;">%eax</span>, (<span style="color: #008b8b;">%edx</span>)        <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Store y at xp</span>
<span style="color: #00008b; font-weight: bold;">movl</span>    <span style="color: #1e90ff; font-weight: bold;">%ebx</span>, (<span style="color: #008b8b;">%ecx</span>)        <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Store x at yp</span>
<span style="color: #00008b; font-weight: bold;">addl</span>    <span style="color: #1e90ff; font-weight: bold;">%ebx</span>, <span style="color: #008b8b;">%eax</span>      <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Return value = x + y</span>
</pre>

<ul>
<li>finish
</li>
</ul>




<pre class="src src-asm"><span style="color: #00008b; font-weight: bold;">popl</span>    <span style="color: #1e90ff; font-weight: bold;">%ebx</span>        <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Restore %ebx</span>
<span style="color: #00008b; font-weight: bold;">popl</span>    <span style="color: #1e90ff; font-weight: bold;">%ebp</span>        <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Restore %ebp</span>
<span style="color: #00008b; font-weight: bold;">ret</span>                 <span style="color: #8b8989;">//</span><span style="color: #8b8989;">Return</span>
</pre>

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-3-7" class="outline-3">
<h3 id="sec-3-7"><span class="section-number-3">3.7</span> Array Allocation</h3>
<div class="outline-text-3" id="text-3-7">

<ul>
<li>$$\&amp;A[i] = x_a + i\cdot sizeof(type)$$
</li>
<li>for an array declare as D[R][C], 
</li>
</ul>


$$\&D[i][j] = x_d + sizeof(type)\cdot (C\cdot i + j)$$

<pre class="example">s: start address  t: type size  declaration: A[R][C]
A[0]   A[0][0]    s
A[0]   A[0][1]    s+t
A[1]   A[1][0]    s+Ct
A[1]   A[1][2]    s+(C+2)t
A[3]   A[3][4]    s+(3C+4)t
</pre>

</div>
</div>
</div>
</div>

</body>
</html>
